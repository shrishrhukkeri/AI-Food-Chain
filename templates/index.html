<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Supply Chain AI Platform</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f7fa; color: #2c3e50; margin: 0; padding: 0; }
        html, body { height: 100%; overflow-x: hidden; }
        body.security-active { overflow: hidden; height: 100vh; }
        
        /* SVG Icon Styles */
        .icon-svg { display: inline-block; width: 1.2em; height: 1.2em; vertical-align: middle; margin-right: 0.3em; }
        .icon-svg-lg { width: 1.7em; height: 1.7em; }
        .icon-svg-xl { width: 2.2em; height: 2.2em; }
        .icon-svg-sm { width: 1.5em; height: 1.5em; }
        
        /* Farm-specific layout: Cards side by side */
        .farm-stage-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
            align-items: stretch;
        }
        @media (max-width: 1200px) {
            .farm-stage-container {
                grid-template-columns: 1fr;
            }
        }
        .farm-stage-cards {
            display: contents;
        }
        .farm-stage-cards .farm-card,
        .farm-stage-cards .ai-suggestion-box {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        .farm-card {
            min-height: 100%;
        }
        .ai-suggestion-box {
            min-height: 100%;
            display: flex !important;
            flex-direction: column;
        }
        .farm-stage-charts {
            grid-column: 1 / -1;
            width: 100%;
        }
        .header { background: linear-gradient(135deg, #1a5f7a 0%, #0f3a4f 100%); color: white; padding: 15px 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: fixed; top: 0; left: 0; right: 0; z-index: 200; min-height: 120px; display: flex; align-items: center; }
        .header-content { display: flex; justify-content: space-between; align-items: center; flex-wrap: nowrap; width: 100%; }
        .header-left { display: flex; flex-direction: column; gap: 12px; }
        .header h1 { font-size: 22px; margin: 0; white-space: nowrap; }
        .header-right { display: flex; flex-direction: column; align-items: flex-end; gap: 4px; margin-left: auto; position: relative; }
        .header-subtitle { font-size: 14px; opacity: 0.9; white-space: nowrap; font-weight: 500; }
        .ai-badge { background: rgba(255,255,255,0.2); padding: 5px 12px; border-radius: 20px; font-size: 12px; white-space: nowrap; font-weight: 500; }
        .language-switcher { position: relative; display: inline-block; }
        .language-btn { background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.3); color: white; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: 600; transition: all 0.3s; display: flex; align-items: center; gap: 8px; white-space: nowrap; }
        .language-btn:hover { background: rgba(255,255,255,0.3); border-color: rgba(255,255,255,0.5); }
        .language-dropdown { position: absolute; top: 100%; right: 0; margin-top: 8px; background: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); min-width: 150px; z-index: 1000; display: none; overflow: hidden; }
        .language-dropdown.show { display: block; }
        .language-option { padding: 12px 16px; cursor: pointer; color: #2c3e50; font-size: 14px; transition: all 0.2s; display: flex; align-items: center; gap: 10px; }
        .language-option:hover { background: #f5f7fa; }
        .language-option.active { background: #1a5f7a; color: white; font-weight: 600; }
        .language-option.active:hover { background: #0f3a4f; }
        .farm-tabs { display: flex; gap: 8px; align-items: center; }
        .farm-tab { padding: 6px 16px; background: rgba(255,255,255,0.2); border: 2px solid transparent; border-radius: 5px; cursor: pointer; transition: all 0.3s; font-weight: 600; font-size: 12px; white-space: nowrap; }
        .farm-tab:hover { background: rgba(255,255,255,0.3); }
        .farm-tab.active { background: white; color: #1a5f7a; border-color: white; }
        .container { max-width: 100%; margin: 0; padding: 0; padding-top: 140px; }
        body.security-active .container { padding-top: 120px; }
        .sidebar { position: fixed; left: 0; top: 120px; width: 250px; height: calc(100vh - 120px); background: #f5f5f5; border-right: 1px solid #ddd; overflow-y: auto; z-index: 100; }
        .sidebar-item { padding: 15px 20px; cursor: pointer; border-left: 3px solid transparent; transition: all 0.3s; color: #2c3e50; font-weight: 500; }
        .sidebar-item:hover { background: #ecf0f1; border-left-color: #27ae60; }
        .sidebar-item.active { background: #d5dbdb; border-left-color: #1a5f7a; color: #1a5f7a; font-weight: 600; }
        .sidebar-item.active:hover { background: #cacfd2; border-left-color: #1a5f7a; }
        .main-content { margin-left: 250px; padding: 20px; width: calc(100% - 250px); box-sizing: border-box; height: calc(100vh - 140px); overflow-y: auto; }
        body.security-active .main-content { overflow: hidden; height: calc(100vh - 120px); padding: 0; }
        .section { display: none; width: 100%; }
        .section.active { display: block; width: 100%; }
        .section-title { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; }
        .ai-sparkle { animation: sparkle 2s infinite; font-size: 20px; }
        @keyframes sparkle { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .kpi-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-top: 4px solid #1a5f7a; position: relative; }
        .kpi-card.warning { border-top-color: #e74c3c; }
        .kpi-card.success { border-top-color: #27ae60; }
        .kpi-card.danger { border-top-color: #c0392b; }
        .kpi-label { color: #7f8c8d; font-size: 12px; text-transform: uppercase; margin-bottom: 8px; display: flex; align-items: center; gap: 5px; }
        .kpi-value { font-size: 28px; font-weight: bold; color: #1a5f7a; }
        .kpi-unit { font-size: 12px; color: #95a5a6; margin-top: 5px; }
        .ai-insight { font-size: 10px; color: #27ae60; margin-top: 8px; padding-top: 8px; border-top: 1px solid #ecf0f1; font-style: italic; line-height: 1.3; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .insight-icon { font-size: 12px; margin-right: 4px; animation: sparkle 2s infinite; }
        .chart-container { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .chart-container h3 { color: #1a5f7a; margin-bottom: 15px; font-size: 16px; display: flex; align-items: center; gap: 8px; }
        .chart-wrapper { position: relative; height: 220px; }
        .ai-suggestion-box { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 12px; margin-top: 20px; display: flex; gap: 12px; overflow: visible; height: auto; min-height: auto; max-height: none; }
        .overview-single-farm .ai-suggestion-box { margin-top: 0; }
        .farm-stage-container .ai-suggestion-box,
        .farm-stage-cards .ai-suggestion-box { margin-top: 0; }
        /* Hide any AI suggestion boxes that might appear outside containers in farm-specific views (but keep them in farm-stage-cards) */
        .section:not(#overview) > .ai-suggestion-box:not(.farm-stage-cards .ai-suggestion-box):not(.farm-stage-container .ai-suggestion-box) { display: none !important; }
        /* Hide Overview AI Insights box when Overview section is not active */
        #overview:not(.active) #overviewSuggestion { display: none !important; }
        /* Hide Overview AI Insights box by default - will be shown via JavaScript only for "All Farms" in Overview */
        #overviewSuggestion { display: none !important; }
        .ai-suggestion-box .icon { font-size: 24px; flex-shrink: 0; animation: sparkle 2s infinite; }
        .ai-suggestion-box .content { flex: 1; overflow: visible; display: flex; flex-direction: column; min-height: 0; }
        .ai-suggestion-box h4 { font-size: 14px; margin-bottom: 8px; white-space: normal; word-wrap: break-word; }
        .ai-suggestion-box p { font-size: 13px; opacity: 0.9; line-height: 1.6; white-space: pre-line; word-wrap: break-word; overflow-wrap: break-word; flex: 1; }
        .ai-insight-item { margin: 4px 0; padding: 2px 0; white-space: normal; word-wrap: break-word; }
        .ai-suggestion-box .content > div:not(.sections-grid) { flex: 1; display: flex; flex-direction: column; }
        .ai-suggestion-box.side-by-side { flex-direction: row; }
        .ai-suggestion-box.side-by-side .content { 
            display: flex; 
            flex-direction: column; 
            width: 100%; 
            flex: 1;
        }
        .ai-suggestion-box.side-by-side .content h4 {
            margin-bottom: 12px;
            width: 100%;
            flex-shrink: 0;
        }
        .ai-suggestion-box.side-by-side .content .sections-grid {
            display: grid !important;
            grid-template-columns: 1fr 1fr !important;
            gap: 20px;
            width: 100%;
            align-items: flex-start;
            margin-top: 0;
        }
        .ai-suggestion-box.side-by-side .insights-section,
        .ai-suggestion-box.side-by-side .recommendations-section { 
            display: flex !important; 
            flex-direction: column !important; 
            width: 100%;
            min-width: 0;
        }
        .ai-suggestion-box.side-by-side .insights-section h5,
        .ai-suggestion-box.side-by-side .recommendations-section h5 { 
            font-size: 13px; 
            margin-bottom: 8px; 
            margin-top: 0;
            font-weight: 600; 
            opacity: 0.95; 
        }
        .ai-suggestion-box.side-by-side .insights-section > div,
        .ai-suggestion-box.side-by-side .recommendations-section > div {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .details-button { background: #27ae60; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s; margin-top: 20px; display: inline-flex; align-items: center; gap: 8px; }
        .details-button:hover { background: #229954; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .stats-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .farm-comparison { 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap: 20px; 
            margin-bottom: 30px; 
            width: 100%;
            max-width: 100%;
            justify-items: stretch;
            align-items: stretch;
            box-sizing: border-box;
        }
        @media (max-width: 1400px) {
            .farm-comparison { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 768px) {
            .farm-comparison { grid-template-columns: 1fr; }
        }
        .farm-comparison > .farm-card {
            width: 100%;
            max-width: 100%;
            min-width: 0;
            height: 100%;
        }
        .single-farm-card-container {
            display: flex;
            justify-content: center;
            width: 100%;
            margin-bottom: 30px;
        }
        .single-farm-card-container .farm-card {
            max-width: 500px;
            width: 100%;
        }
        .farm-card { 
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%); 
            padding: 0; 
            border-radius: 12px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.1); 
            overflow: hidden; 
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            min-height: auto;
            height: auto;
            width: 100%;
            box-sizing: border-box;
        }
        .farm-card:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 8px 30px rgba(0,0,0,0.15); 
        }
        .farm-card-header { 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            position: relative;
            overflow: visible;
            min-height: auto;
            width: 100%;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .farm-card.excellent .farm-card-header { background: linear-gradient(135deg, #27ae60 0%, #229954 100%); }
        .farm-card.good .farm-card-header { background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); }
        .farm-card.average .farm-card-header { background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); }
        .farm-card.poor .farm-card-header { background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); }
        .farm-card-header h3 { 
            color: white; 
            margin: 0; 
            font-size: 20px; 
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
            white-space: normal;
            word-wrap: break-word;
            overflow-wrap: break-word;
            line-height: 1.4;
            overflow: visible;
            min-width: 0;
            width: 100%;
            flex-shrink: 0;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .farm-card-body { 
            padding: 20px; 
            flex: 1;
            overflow: visible;
            min-height: auto;
            width: 100%;
            box-sizing: border-box;
        }
        .performance-score-container { 
            display: flex; 
            align-items: baseline; 
            gap: 5px; 
            margin: 0;
            flex-shrink: 0;
        }
        .performance-score { 
            font-size: 42px; 
            font-weight: 800; 
            color: white;
            line-height: 1;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .performance-score-label { 
            font-size: 16px; 
            color: rgba(255,255,255,0.95); 
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .status-badge { 
            display: inline-block; 
            padding: 6px 14px; 
            border-radius: 12px; 
            font-size: 12px; 
            font-weight: 700; 
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: rgba(255,255,255,0.3);
            color: white;
            backdrop-filter: blur(10px);
            white-space: nowrap;
            text-align: center;
            margin: 0;
            width: auto;
            max-width: 100%;
            line-height: 1.4;
            overflow: visible;
            flex-shrink: 0;
            align-self: flex-start;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .metric-row { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 12px 0; 
            border-bottom: 1px solid #f0f0f0; 
            min-height: 40px;
            gap: 10px;
            width: 100%;
            box-sizing: border-box;
        }
        .metric-row:last-child { 
            border-bottom: none; 
        }
        .metric-label { 
            color: #2c3e50; 
            font-size: 14px; 
            font-weight: 600;
            white-space: normal;
            word-wrap: break-word;
            overflow-wrap: break-word;
            flex: 1;
            margin-right: 10px;
            min-width: 0;
            overflow: visible;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .metric-value { 
            font-weight: 700; 
            color: #1a5f7a; 
            font-size: 15px;
            white-space: normal;
            word-wrap: break-word;
            overflow-wrap: break-word;
            text-align: right;
            flex-shrink: 0;
            min-width: 0;
            overflow: visible;
        }
        .farm-card .kpi-grid { 
            display: grid; 
            grid-template-columns: 1fr; 
            gap: 10px; 
            margin-top: 10px; 
        }
        .farm-card .kpi-card { 
            padding: 12px; 
            background: #f8f9fa; 
            border-radius: 8px; 
            border: 1px solid #e9ecef;
        }
        .farm-card .kpi-card.success { 
            background: linear-gradient(135deg, #d5f4e6 0%, #c8e6d5 100%); 
            border-color: #27ae60; 
        }
        .farm-card .kpi-card.warning { 
            background: linear-gradient(135deg, #fef5e7 0%, #fdebd0 100%); 
            border-color: #f39c12; 
        }
        .overview-single-farm-container {
            width: 100%;
            display: block;
        }
        .overview-single-farm-container .farm-stage-container {
            width: 100%;
            max-width: 100%;
        }
        .overview-single-farm { 
            display: flex;
            justify-content: center;
            align-items: start;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }
        .overview-single-farm .farm-card { 
            margin: 0; 
            width: 100%;
            max-width: 600px;
        }
        @media (max-width: 768px) {
            .overview-single-farm { 
                max-width: 100%;
            }
        }
        /* Chatbot Styles */
        .chatbot-toggle { position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 1000; transition: transform 0.3s; }
        .chatbot-toggle:hover { transform: scale(1.1); }
        .chatbot-toggle svg { width: 28px; height: 28px; fill: white; pointer-events: none; }
        .chatbot-container { position: fixed; bottom: 90px; right: 20px; width: 380px; height: 500px; background: white; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.2); z-index: 1000; display: none; flex-direction: column; overflow: hidden; }
        .chatbot-container.active { display: flex; }
        .chatbot-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        .chatbot-header h3 { margin: 0; font-size: 16px; display: flex; align-items: center; gap: 8px; }
        .chatbot-header-right { display: flex; align-items: center; gap: 10px; }
        .chatbot-audio-btn { background: rgba(255, 255, 255, 0.2); border: 1px solid rgba(255, 255, 255, 0.3); color: white; padding: 5px 8px; border-radius: 5px; cursor: pointer; font-size: 12px; display: flex; align-items: center; justify-content: center; transition: background 0.3s; width: 32px; height: 28px; }
        .chatbot-audio-btn:hover { background: rgba(255, 255, 255, 0.3); }
        .chatbot-audio-btn.active { background: rgba(255, 255, 255, 0.4); }
        .chatbot-audio-btn svg { width: 16px; height: 16px; }
        .chatbot-language-selector { position: relative; }
        .chatbot-language-btn { background: rgba(255, 255, 255, 0.2); border: 1px solid rgba(255, 255, 255, 0.3); color: white; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 12px; display: flex; align-items: center; gap: 5px; transition: background 0.3s; }
        .chatbot-language-btn:hover { background: rgba(255, 255, 255, 0.3); }
        .chatbot-language-btn::after { content: '‚ñº'; font-size: 8px; margin-left: 3px; }
        .chatbot-language-dropdown { position: absolute; top: 100%; right: 0; margin-top: 5px; background: white; border-radius: 5px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); min-width: 120px; display: none; z-index: 1001; overflow: hidden; }
        .chatbot-language-dropdown.active { display: block; }
        .chatbot-language-option { padding: 10px 15px; cursor: pointer; color: #2c3e50; font-size: 13px; transition: background 0.2s; }
        .chatbot-language-option:hover { background: #f0f0f0; }
        .chatbot-language-option.selected { background: #667eea; color: white; font-weight: 600; }
        .chatbot-close { background: none; border: none; color: white; font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; }
        .chatbot-messages { flex: 1; overflow-y: auto; padding: 15px; background: #f8f9fa; }
        .chatbot-message { margin-bottom: 12px; display: flex; gap: 8px; }
        .chatbot-message.user { flex-direction: row-reverse; }
        .chatbot-message-content { max-width: 75%; padding: 10px 12px; border-radius: 12px; font-size: 13px; line-height: 1.4; }
        .chatbot-message.bot .chatbot-message-content { background: white; color: #2c3e50; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .chatbot-message.user .chatbot-message-content { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .chatbot-message-content strong { font-weight: 600; color: #1a5f7a; }
        .chatbot-message-content ul { margin: 8px 0; padding-left: 20px; }
        .chatbot-message-content li { margin: 4px 0; }
        .chatbot-message-content p { margin: 6px 0; }
        .chatbot-message-content p:first-child { margin-top: 0; }
        .chatbot-message-content p:last-child { margin-bottom: 0; }
        .chatbot-input-container { padding: 15px; background: white; border-top: 1px solid #e0e0e0; display: flex; gap: 10px; }
        .chatbot-input-wrapper { position: relative; flex: 1; display: flex; align-items: center; }
        .chatbot-input { flex: 1; padding: 10px 40px 10px 12px; border: 1px solid #ddd; border-radius: 20px; font-size: 13px; outline: none; }
        .chatbot-input:focus { border-color: #667eea; }
        .chatbot-mic-btn { position: absolute; right: 8px; background: none; border: none; color: #667eea; cursor: pointer; padding: 5px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s; width: 28px; height: 28px; }
        .chatbot-mic-btn:hover { background: rgba(102, 126, 234, 0.1); }
        .chatbot-mic-btn.recording { color: #e74c3c; animation: pulse 1.5s infinite; }
        .chatbot-mic-btn.recording:hover { background: rgba(231, 76, 60, 0.1); }
        @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.7; transform: scale(1.1); } }
        .chatbot-mic-btn svg { width: 18px; height: 18px; }
        .chatbot-send { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; font-size: 13px; font-weight: 600; transition: opacity 0.3s; }
        .chatbot-send:hover { opacity: 0.9; }
        .chatbot-send:disabled { opacity: 0.5; cursor: not-allowed; }
        .chatbot-typing { display: flex; gap: 4px; padding: 10px 12px; }
        .chatbot-typing span { width: 8px; height: 8px; background: #667eea; border-radius: 50%; animation: typing 1.4s infinite; }
        .chatbot-typing span:nth-child(2) { animation-delay: 0.2s; }
        .chatbot-typing span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing { 0%, 60%, 100% { transform: translateY(0); opacity: 0.7; } 30% { transform: translateY(-10px); opacity: 1; } }
        
        /* Price Prediction Crop Buttons */
        .crop-forecast-btn { transition: all 0.3s ease !important; }
        .crop-forecast-btn:hover { 
            transform: translateY(-3px) !important; 
            box-shadow: 0 8px 16px rgba(0,0,0,0.2) !important; 
            background: white !important;
            color: #667eea !important;
        }
        .crop-forecast-btn:active { transform: translateY(-1px) !important; }
        
        @media (max-width: 768px) { 
            .crop-forecast-btn { padding: 14px 16px !important; font-size: 13px !important; }
        }
        
        @media (max-width: 768px) { 
            .header-content { flex-direction: column; gap: 10px; align-items: flex-start; }
            .header-left { flex-direction: column; gap: 10px; width: 100%; }
            .header-right { align-items: flex-start; width: 100%; }
            .farm-tabs { width: 100%; flex-wrap: wrap; }
            .sidebar { width: 100%; height: auto; position: relative; top: 0; border-bottom: 1px solid #ddd; } 
            .main-content { margin-left: 0; } 
            .kpi-grid { grid-template-columns: repeat(2, 1fr); }
            .farm-comparison { grid-template-columns: 1fr; }
        }

        /* Security Section - Large Video Feed Styles */
        #security.section {
            display: none; /* Hide by default - only show when active */
        }
        #security.section.active {
            margin: 0;
            width: 100%;
            height: 100%;
            min-height: 100%;
            max-height: 100%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        #security-container {
            padding: 0 !important;
            margin: 0;
            width: 100%;
            height: 100%;
            flex: 1;
            min-height: 0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        #security .section-title {
            margin: 0;
            padding: 10px 20px 8px 20px;
            flex-shrink: 0;
        }
        #security #security-container > div:first-child {
            margin: 0 20px 8px 20px;
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            flex-shrink: 0;
        }
        #security #security-container > div:first-child h3 {
            margin: 0 0 8px 0;
            font-size: 15px;
            color: #1a5f7a;
        }
        #security #security-container > div:first-child > div {
            margin-bottom: 4px;
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }
        #security #security-container > div:first-child p {
            margin: 4px 0 0 0;
            font-size: 11px;
            color: #7f8c8d;
        }
        #security-feed-wrapper {
            display: flex;
            gap: 20px;
            width: 100%;
            height: 100%;
            flex: 1;
            min-height: 0;
            max-height: 100%;
            padding: 0 20px 20px 20px;
            overflow: hidden;
        }
        #espcam-feed-container {
            position: relative;
            width: 65%;
            background: #f5f7fa;
            border-radius: 12px;
            margin: 0;
            padding: 20px;
            min-height: 0;
            height: 100%;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #notification-center {
            width: 35%;
            background: white;
            border-radius: 12px;
            height: 100%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        #notification-center-header {
            flex-shrink: 0;
            padding: 20px;
            border-bottom: 2px solid #ecf0f1;
            background: white;
            border-radius: 12px 12px 0 0;
        }
        #notification-center h3 {
            color: #1a5f7a;
            margin: 0;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        #notification-center-header svg {
            width: 20px;
            height: 20px;
            fill: #1a5f7a;
            flex-shrink: 0;
        }
        #notifications-list {
            flex: 1;
            overflow-y: auto;
            padding: 15px 20px 20px 20px;
            min-height: 0;
        }
        .notification-item {
            background: #f8f9fa;
            border-left: 4px solid #e74c3c;
            border-radius: 8px;
            padding: 12px 15px;
            margin-bottom: 12px;
            transition: all 0.3s;
            cursor: pointer;
        }
        .notification-item:hover {
            background: #ecf0f1;
            transform: translateX(-2px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .notification-item.motion {
            border-left-color: #e74c3c;
        }
        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .notification-type {
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }
        .notification-time {
            font-size: 11px;
            color: #7f8c8d;
            font-family: 'Courier New', monospace;
        }
        .notification-message {
            font-size: 13px;
            color: #34495e;
            line-height: 1.4;
        }
        .notification-empty {
            text-align: center;
            padding: 40px 20px;
            color: #95a5a6;
        }
        .notification-empty p {
            margin: 10px 0;
            font-size: 14px;
        }
        #espcam-stream {
            width: 90% !important;
            max-width: 100% !important;
            height: 85% !important;
            max-height: 900px !important;
            min-height: 500px !important;
            border: none !important;
            border-radius: 12px;
            background: #000;
            display: none;
            position: relative !important;
            margin: auto !important;
            padding: 0 !important;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }
        #espcam-stream-img {
            width: 90% !important;
            max-width: 1400px !important;
            height: 85% !important;
            max-height: 900px !important;
            min-height: 500px !important;
            object-fit: contain !important;
            object-position: center center !important;
            border-radius: 12px;
            background: #000;
            display: none;
            position: relative !important;
            margin: auto !important;
            padding: 0 !important;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            image-rendering: auto !important;
        }
        #espcam-status {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            color: #2c3e50;
            text-align: center;
            pointer-events: none;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px 40px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        @media (max-width: 1200px) {
            #security.section.active {
                height: 100%;
                min-height: 100%;
                max-height: 100%;
            }
            #espcam-stream,
            #espcam-stream-img {
                width: 85% !important;
                max-width: 1200px !important;
                max-height: 800px !important;
            }
        }
        @media (max-width: 1200px) {
            #security-feed-wrapper {
                gap: 15px;
            }
            #espcam-feed-container {
                width: 60%;
            }
            #notification-center {
                width: 40%;
            }
        }
        @media (max-width: 768px) {
            #security.section.active {
                height: 100%;
                min-height: 100%;
                max-height: 100%;
            }
            #security-feed-wrapper {
                flex-direction: column;
                gap: 15px;
                padding: 0 10px 10px 10px;
            }
            #espcam-feed-container {
                width: 100%;
                height: 50%;
                min-height: 300px;
                padding: 15px;
            }
            #notification-center {
                width: 100%;
                height: 50%;
                min-height: 300px;
            }
            #espcam-stream,
            #espcam-stream-img {
                width: 95% !important;
                max-width: 100% !important;
                max-height: 600px !important;
                border-radius: 8px;
            }
            #security #security-container > div:first-child {
                margin: 0 10px 6px 10px;
                padding: 8px;
            }
            #security .section-title {
                padding: 8px 10px 6px 10px;
            }
            #security #security-container > div:first-child > div {
                gap: 6px;
            }
            #security #security-container > div:first-child input,
            #security #security-container > div:first-child button {
                font-size: 12px;
                padding: 6px 10px;
            }
            #espcam-status {
                padding: 20px 30px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="header-left">
            <h1>üåæ Food Supply Chain AI Platform</h1>
                <div class="farm-tabs">
                    <div class="farm-tab active" onclick="switchFarm('all', this)"><span data-translate="farms.all">All Farms</span></div>
                    <div class="farm-tab" onclick="switchFarm('FarmA', this)"><span data-translate="farms.farmA">Farm A</span></div>
                    <div class="farm-tab" onclick="switchFarm('FarmB', this)"><span data-translate="farms.farmB">Farm B</span></div>
                    <div class="farm-tab" onclick="switchFarm('FarmC', this)"><span data-translate="farms.farmC">Farm C</span></div>
                    <div class="farm-tab" onclick="switchFarm('FarmD', this)"><span data-translate="farms.farmD">Farm D</span></div>
        </div>
            </div>
            <div class="header-right">
                <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap; justify-content: flex-end;">
                    <div class="language-switcher">
                        <button class="language-btn" onclick="toggleLanguageDropdown()" id="language-btn">
                            <span>üåê</span>
                            <span id="current-language">English</span>
                            <span>‚ñº</span>
                        </button>
                        <div class="language-dropdown" id="language-dropdown">
                            <div class="language-option active" onclick="changeLanguage('en')" data-lang="en">
                                <span>üá¨üáß</span> English
                            </div>
                            <div class="language-option" onclick="changeLanguage('hi')" data-lang="hi">
                                <span>üáÆüá≥</span> ‡§π‡§ø‡§Ç‡§¶‡•Ä (Hindi)
                            </div>
                            <div class="language-option" onclick="changeLanguage('kn')" data-lang="kn">
                                <span>üáÆüá≥</span> ‡≤ï‡≤®‡≥ç‡≤®‡≤° (Kannada)
                            </div>
                        </div>
                    </div>
                </div>
                <div class="header-subtitle" data-translate="header.subtitle">AI-Powered Analytics Dashboard</div>
                <div class="ai-badge"><span id="header-ai-icon"></span> <span data-translate="header.aiEnabled">AI Insights Enabled</span></div>
            </div>
        </div>
    </div>

    <div class="sidebar" id="sidebar">
        <div class="sidebar-item active" data-section="overview" onclick="showSection('overview')"><span id="sidebar-overview-icon"></span><span data-translate="sidebar.overview">Overview</span></div>
        <div class="sidebar-item" data-section="production" onclick="showSection('production')"><span id="sidebar-production-icon"></span><span data-translate="sidebar.production">Production</span></div>
        <div class="sidebar-item" data-section="storage" onclick="showSection('storage')"><span id="sidebar-storage-icon"></span><span data-translate="sidebar.storage">Storage</span></div>
        <div class="sidebar-item" data-section="processing" onclick="showSection('processing')"><span id="sidebar-processing-icon"></span><span data-translate="sidebar.processing">Processing</span></div>
        <div class="sidebar-item" data-section="transportation" onclick="showSection('transportation')"><span id="sidebar-transportation-icon"></span><span data-translate="sidebar.transport">Transport</span></div>
        <div class="sidebar-item" data-section="retail" onclick="showSection('retail')"><span id="sidebar-retail-icon"></span><span data-translate="sidebar.retail">Retail</span></div>
        <div class="sidebar-item" data-section="price" onclick="showSection('price')"><span id="sidebar-price-icon"></span><span data-translate="sidebar.price">Price Prediction</span></div>
        <div class="sidebar-item" data-section="recommendation" onclick="showSection('recommendation')" style="display: flex; align-items: center; gap: 10px;"><span id="sidebar-recommendation-icon" style="display: inline-flex; align-items: center;"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="starGrad1" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#FFD700;stop-opacity:1" /><stop offset="50%" style="stop-color:#FFA500;stop-opacity:1" /><stop offset="100%" style="stop-color:#FF6347;stop-opacity:1" /></linearGradient><linearGradient id="badgeGrad1" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#667eea;stop-opacity:1" /><stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" /></linearGradient></defs><circle cx="12" cy="12" r="11" fill="url(#badgeGrad1)"/><path d="M12 2L14.09 8.26L20 9.27L15 13.14L16.18 19.02L12 15.77L7.82 19.02L9 13.14L4 9.27L9.91 8.26L12 2Z" fill="url(#starGrad1)" stroke="#fff" stroke-width="0.5"/><path d="M10 12L11.5 13.5L14 11" stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg></span><span data-translate="sidebar.recommendation">Crop Recommendation</span></div>
        <div class="sidebar-item" data-section="waste" onclick="showSection('waste')"><span id="sidebar-waste-icon"></span><span data-translate="sidebar.waste">Waste</span></div>
        <div class="sidebar-item" data-section="security" onclick="showSection('security')"><span id="sidebar-security-icon"></span><span data-translate="sidebar.security">Security</span></div>
    </div>

    <div class="container">
        <div class="main-content">
            <div id="overview" class="section active">
                <div class="section-title"><h2 style="color: #1a5f7a; display: flex; align-items: center; gap: 8px;"><span id="overview-title-icon"></span><span data-translate="sections.overview">Farm Comparison Overview</span></h2><span id="overview-sparkle-icon"></span></div>
                <div id="farm-comparison-container" class="farm-comparison"></div>
                <div class="ai-suggestion-box" id="overviewSuggestion"></div>
                <div class="stats-row">
                    <div class="chart-container"><h3><span id="chart1-sparkle-icon"></span><span data-translate="charts.yieldComparison">Yield Comparison</span></h3><div class="chart-wrapper"><canvas id="overviewChart1"></canvas></div></div>
                    <div class="chart-container"><h3><span id="chart2-sparkle-icon"></span><span data-translate="charts.spoilageComparison">Spoilage Comparison</span></h3><div class="chart-wrapper"><canvas id="overviewChart2"></canvas></div></div>
                </div>
                <div class="stats-row">
                    <div class="chart-container"><h3><span id="chart3-sparkle-icon"></span><span data-translate="charts.performanceScore">Performance Score</span></h3><div class="chart-wrapper"><canvas id="overviewChart3"></canvas></div></div>
                    <div class="chart-container"><h3><span id="chart4-sparkle-icon"></span><span data-translate="charts.defectRate">Defect Rate Comparison</span></h3><div class="chart-wrapper"><canvas id="overviewChart4"></canvas></div></div>
                </div>
                <div class="row mt-4" id="overview-download-section" style="display: none;">
    <div class="col-12">
        <div class="card shadow-sm" style="text-align: center; padding: 20px;">
            <button class="details-button" onclick="showReportLanguageModal()" id="download-report-btn" style="margin: 0 auto;">
                <span>üìÑ</span> <span data-translate="report.downloadReport">Download Detailed Analysis Report</span>
            </button>
        </div>
    </div>
</div> 
            </div>

            <div id="production" class="section">
                <div class="section-title"><h2 style="color: #1a5f7a; display: flex; align-items: center; gap: 8px;"><span id="production-title-icon"></span><span data-translate="sections.production">Production Stage</span></h2><span id="production-sparkle-icon"></span></div>
                <div id="production-container"></div>
                <div class="chart-container farm-stage-charts"><h3><span id="production-chart-sparkle-icon"></span><span data-translate="charts.averageYield">Average Yield by Crop</span></h3><div class="chart-wrapper"><canvas id="productionChart1"></canvas></div></div>
                <button class="details-button" onclick="viewFarmDetails('production')"><span id="production-button-icon"></span><span data-translate="buttons.viewProduction">View Production Details</span></button>
            </div>

            <div id="storage" class="section">
                <div class="section-title"><h2 style="color: #1a5f7a; display: flex; align-items: center; gap: 8px;"><span id="storage-title-icon"></span><span data-translate="sections.storage">Storage & Post-Harvest</span></h2><span id="storage-sparkle-icon"></span></div>
                <div id="storage-container"></div>
                <div class="chart-container farm-stage-charts"><h3><span id="storage-chart-sparkle-icon"></span><span data-translate="charts.storageMetrics">Storage Metrics</span></h3><div class="chart-wrapper"><canvas id="storageChart1"></canvas></div></div>
                <button class="details-button" onclick="viewFarmDetails('storage')"><span id="storage-button-icon"></span><span data-translate="buttons.viewStorage">View Storage Details</span></button>
            </div>

            <div id="processing" class="section">
                <div class="section-title"><h2 style="color: #1a5f7a; display: flex; align-items: center; gap: 8px;"><span id="processing-title-icon"></span><span data-translate="sections.processing">Processing & Packaging</span></h2><span id="processing-sparkle-icon"></span></div>
                <div id="processing-container"></div>
                <div class="chart-container farm-stage-charts"><h3><span id="processing-chart-sparkle-icon"></span><span data-translate="charts.defectRateByProcess">Defect Rate by Process</span></h3><div class="chart-wrapper"><canvas id="processingChart1"></canvas></div></div>
                <button class="details-button" onclick="viewFarmDetails('processing')"><span id="processing-button-icon"></span><span data-translate="buttons.viewProcessing">View Processing Details</span></button>
            </div>

            <div id="transportation" class="section">
                <div class="section-title"><h2 style="color: #1a5f7a; display: flex; align-items: center; gap: 8px;"><span id="transportation-title-icon"></span><span data-translate="sections.transportation">Distribution & Transportation</span></h2><span id="transportation-sparkle-icon"></span></div>
                <div id="transportation-container"></div>
                <div class="chart-container farm-stage-charts"><h3><span id="transportation-chart-sparkle-icon"></span><span data-translate="charts.transportationMetrics">Transportation Metrics</span></h3><div class="chart-wrapper"><canvas id="transChart1"></canvas></div></div>
                <button class="details-button" onclick="viewFarmDetails('transportation')"><span id="transportation-button-icon"></span><span data-translate="buttons.viewTransportation">View Transportation Details</span></button>
            </div>

            <div id="retail" class="section">
                <div class="section-title"><h2 style="color: #1a5f7a; display: flex; align-items: center; gap: 8px;"><span id="retail-title-icon"></span><span data-translate="sections.retail">Retail Insights</span></h2><span id="retail-sparkle-icon"></span></div>
                <div id="retail-container"></div>
                <div class="chart-container farm-stage-charts"><h3><span id="retail-chart-sparkle-icon"></span><span data-translate="charts.inventorySales">Inventory & Sales</span></h3><div class="chart-wrapper"><canvas id="retailChart1"></canvas></div></div>
                <button class="details-button" onclick="viewFarmDetails('retail')"><span id="retail-button-icon"></span><span data-translate="buttons.viewRetail">View Retail Details</span></button>
            </div>

            <div id="price" class="section">
                <div class="section-title"><h2 style="color: #1a5f7a; display: flex; align-items: center; gap: 8px;"><span id="price-title-icon"></span><span data-translate="sections.price">Price Prediction</span></h2><span id="price-sparkle-icon"></span></div>
                <div style="max-width: 1400px; margin: 0 auto; width: 100%; padding: 0 20px;">
                    <div class="chart-container" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 40px 30px; text-align: center; color: white;">
                        <h3 style="color: white; margin-bottom: 20px; font-size: 20px; display: flex; align-items: center; justify-content: center; gap: 10px;"><span id="price-chart-sparkle-icon"></span><span data-translate="price.forecastTitle">6-Month Crop Price Forecasts</span></h3>
                        <p style="margin-bottom: 30px; font-size: 15px; opacity: 0.95;"><span data-translate="price.forecastDescription">View detailed price predictions with confidence intervals for all trained crops</span></p>
                        
                        <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; margin-bottom: 20px;">
                            <button class="crop-forecast-btn" onclick="window.location.href='/api/prediction/price'" style="background: white; color: #667eea; border: 2px solid white; padding: 18px 20px; border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                                <span style="font-size: 18px;">üìä</span>
                                <span data-translate="buttons.viewAllCrops">View All Crops</span>
                            </button>
                            <button class="crop-forecast-btn" onclick="loadPricePrediction('wheat')" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid white; padding: 18px 20px; border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <span style="font-size: 18px;">üåæ</span>
                                Wheat
                            </button>
                            <button class="crop-forecast-btn" onclick="loadPricePrediction('corn')" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid white; padding: 18px 20px; border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <span style="font-size: 18px;">üåΩ</span>
                                Corn
                            </button>
                            <button class="crop-forecast-btn" onclick="loadPricePrediction('tomato')" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid white; padding: 18px 20px; border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <span style="font-size: 18px;">üçÖ</span>
                                Tomato
                            </button>
                            <button class="crop-forecast-btn" onclick="loadPricePrediction('lettuce')" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid white; padding: 18px 20px; border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <span style="font-size: 18px;">ü•¨</span>
                                Lettuce
                            </button>
                        </div>
                    </div>
                    
                    <div class="chart-container" style="margin-top: 20px; width: 100%;">
                        <div class="chart-wrapper" style="height: 380px; width: 100%;">
                            <canvas id="pricePredictionChart"></canvas>
                        </div>
                        <div class="text-center mt-3" style="padding-top: 15px; border-top: 1px solid #ecf0f1;">
                            <span class="badge bg-primary" style="background: #667eea !important; padding: 6px 12px; font-size: 12px; margin-right: 10px;">‚Çπ/quintal</span>
                            <strong id="aiPriceInsight" style="color: #1a5f7a; font-size: 14px;" data-translate="price.selectCrop">Select a crop to view the 6-month price forecast with confidence intervals.</strong>
                        </div>
                    </div>
                </div>
            </div>

            <div id="recommendation" class="section">
                <div class="section-title"><h2 style="color: #1a5f7a; display: flex; align-items: center; gap: 8px;"><span id="recommendation-title-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="starGrad2" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#FFD700;stop-opacity:1" /><stop offset="50%" style="stop-color:#FFA500;stop-opacity:1" /><stop offset="100%" style="stop-color:#FF6347;stop-opacity:1" /></linearGradient><linearGradient id="badgeGrad2" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#667eea;stop-opacity:1" /><stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" /></linearGradient></defs><circle cx="12" cy="12" r="11" fill="url(#badgeGrad2)"/><path d="M12 2L14.09 8.26L20 9.27L15 13.14L16.18 19.02L12 15.77L7.82 19.02L9 13.14L4 9.27L9.91 8.26L12 2Z" fill="url(#starGrad2)" stroke="#fff" stroke-width="0.5"/><path d="M10 12L11.5 13.5L14 11" stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg></span><span data-translate="sections.recommendation">Crop Recommendation</span></h2><span id="recommendation-sparkle-icon"></span></div>
                <div id="recommendation-container"></div>
            </div>

            <div id="waste" class="section">
                <div class="section-title"><h2 style="color: #1a5f7a; display: flex; align-items: center; gap: 8px;"><span id="waste-title-icon"></span><span data-translate="sections.waste">Waste Management</span></h2><span id="waste-sparkle-icon"></span></div>
                <div id="waste-container"></div>
                <div class="chart-container farm-stage-charts"><h3><span id="waste-chart-sparkle-icon"></span><span data-translate="charts.wasteDistribution">Waste Distribution</span></h3><div class="chart-wrapper"><canvas id="wasteChart1"></canvas></div></div>
                <button class="details-button" onclick="viewFarmDetails('waste')"><span id="waste-button-icon"></span><span data-translate="buttons.viewWaste">View Waste Details</span></button>
            </div>

            <div id="security" class="section">
                <div class="section-title"><h2 style="color: #1a5f7a; display: flex; align-items: center; gap: 8px;"><span id="security-title-icon"></span><span data-translate="sections.security">Security Camera Feed</span></h2><span id="security-sparkle-icon"></span></div>
                <div id="security-container">
                    <div>
                        <h3 data-translate="security.espcamConfig">ESPCam Configuration</h3>
                        <div>
                            <input type="text" id="espcam-ip" data-translate="security.ipAddress" placeholder="ESP32 Camera IP Address" style="padding: 8px 12px; border: 2px solid #ddd; border-radius: 6px; flex: 1; min-width: 180px; font-size: 13px;">
                            <input type="text" id="espcam-port" data-translate="security.port" placeholder="Port" value="81" style="padding: 8px 12px; border: 2px solid #ddd; border-radius: 6px; width: 90px; font-size: 13px;">
                            <button id="espcam-connect-btn" onclick="connectESPCam()" data-translate="buttons.connect" style="padding: 8px 18px; background: #1a5f7a; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 600; transition: all 0.3s;">Connect</button>
                            <button id="espcam-disconnect-btn" onclick="disconnectESPCam()" data-translate="buttons.disconnect" style="padding: 8px 18px; background: #e74c3c; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 600; transition: all 0.3s;">Disconnect</button>
                        </div>
                        <p data-translate="security.enterIP">Enter your ESP32 camera IP address and port to view the live feed.</p>
                    </div>
                    <div id="security-feed-wrapper">
                        <div id="espcam-feed-container">
                            <div id="espcam-status">
                                <p style="font-size: 24px; margin-bottom: 12px;"><span data-translate="security.cameraFeed">üìπ Camera Feed</span></p>
                                <p style="font-size: 16px; color: #7f8c8d;"><span data-translate="security.configureConnect">Configure and connect to view live feed</span></p>
                            </div>
                            <iframe id="espcam-stream" src="" title="ESPCam Live Stream"></iframe>
                            <img id="espcam-stream-img" src="" alt="ESPCam Stream">
                        </div>
                        <div id="notification-center">
                            <div id="notification-center-header">
                                <h3>
                                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M18 8C18 6.4087 17.3679 4.88258 16.2426 3.75736C15.1174 2.63214 13.5913 2 12 2C10.4087 2 8.88258 2.63214 7.75736 3.75736C6.63214 4.88258 6 6.4087 6 8C6 15 3 17 3 17H21C21 17 18 15 18 8Z" fill="#1a5f7a" stroke="#1a5f7a" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M13.73 21C13.5542 21.3031 13.3019 21.5547 12.9982 21.7295C12.6946 21.9044 12.3504 21.9965 12 21.9965C11.6496 21.9965 11.3054 21.9044 11.0018 21.7295C10.6982 21.5547 10.4458 21.3031 10.27 21" stroke="#1a5f7a" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                        <circle cx="16" cy="8" r="2" fill="#e74c3c"/>
                                    </svg>
                                    <span data-translate="security.securityAlerts">Security Alerts</span>
                                </h3>
                            </div>
                            <div id="notifications-list">
                                <!-- Notifications will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // SVG Icon Definitions
        const icons = {
            production: '<svg class="icon-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L2 7L12 12L22 7L12 2Z" fill="#27ae60" stroke="#1e8449" stroke-width="1.5"/><path d="M2 17L12 22L22 17" stroke="#1e8449" stroke-width="1.5" stroke-linecap="round"/><path d="M2 12L12 17L22 12" stroke="#1e8449" stroke-width="1.5" stroke-linecap="round"/></svg>',
            storage: '<svg class="icon-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="8" width="18" height="12" rx="2" fill="#3498db" stroke="#2980b9" stroke-width="1.5"/><path d="M3 10C3 8.89543 3.89543 8 5 8H19C20.1046 8 21 8.89543 21 10V11H3V10Z" fill="#2980b9"/><path d="M8 5L12 2L16 5" stroke="#2980b9" stroke-width="1.5" stroke-linecap="round"/><path d="M12 2V8" stroke="#2980b9" stroke-width="1.5"/></svg>',
            processing: '<svg class="icon-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="8" fill="#e67e22" stroke="#d35400" stroke-width="1.5"/><path d="M12 6V12L16 14" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>',
            transportation: '<svg class="icon-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="6" width="14" height="11" fill="#e74c3c" stroke="#c0392b" stroke-width="1.2" rx="0.5"/><rect x="17" y="8" width="5" height="9" fill="#95a5a6" stroke="#7f8c8d" stroke-width="1.2" rx="0.5"/><path d="M3 16H15V17H3V16Z" fill="#c0392b" opacity="0.8"/><path d="M3 12H15V13H3V12Z" fill="#c0392b" opacity="0.8"/><rect x="18" y="10" width="3" height="4" fill="#3498db" opacity="0.5" rx="0.2"/><path d="M18.5 11H19.5" stroke="#2980b9" stroke-width="0.7" stroke-linecap="round"/><path d="M18.5 13H19.5" stroke="#2980b9" stroke-width="0.7" stroke-linecap="round"/><path d="M2 17H15L16 14H18L19 17H21V18H19.5C19.5 19.1046 18.6046 20 17.5 20C16.3954 20 15.5 19.1046 15.5 18H8.5C8.5 19.1046 7.60457 20 6.5 20C5.39543 20 4.5 19.1046 4.5 18H2V17Z" fill="#95a5a6" stroke="#7f8c8d" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"/><circle cx="6.5" cy="18" r="2" fill="#ecf0f1" stroke="#bdc3c7" stroke-width="1"/><circle cx="6.5" cy="18" r="1.2" fill="#e74c3c"/><circle cx="17.5" cy="18" r="2" fill="#ecf0f1" stroke="#bdc3c7" stroke-width="1"/><circle cx="17.5" cy="18" r="1.2" fill="#e74c3c"/><path d="M16 14L15 10H2" stroke="#7f8c8d" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"/><rect x="19" y="14" width="2.5" height="2.5" fill="#7f8c8d" opacity="0.6" rx="0.2"/></svg>',
            retail: '<svg class="icon-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 21H21" stroke="#9b59b6" stroke-width="2" stroke-linecap="round"/><path d="M5 21V7L12 3L19 7V21" stroke="#9b59b6" stroke-width="1.5"/><path d="M9 9V21" stroke="#9b59b6" stroke-width="1.5"/><path d="M15 9V21" stroke="#9b59b6" stroke-width="1.5"/><rect x="7" y="11" width="10" height="4" fill="#9b59b6" opacity="0.3"/></svg>',
            waste: '<svg class="icon-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 6H5H21" stroke="#16a085" stroke-width="2" stroke-linecap="round"/><path d="M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="#16a085" stroke-width="1.5" stroke-linecap="round"/><path d="M10 11V17" stroke="#16a085" stroke-width="1.5" stroke-linecap="round"/><path d="M14 11V17" stroke="#16a085" stroke-width="1.5" stroke-linecap="round"/></svg>',
            security: '<svg class="icon-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="7" width="18" height="12" rx="2" fill="#2c3e50" stroke="#34495e" stroke-width="1.5"/><circle cx="12" cy="13" r="3" fill="#3498db" stroke="#2980b9" stroke-width="1.5"/><path d="M12 10V13L14 15" stroke="white" stroke-width="1.5" stroke-linecap="round"/><path d="M6 7V5C6 3.89543 6.89543 3 8 3H16C17.1046 3 18 3.89543 18 5V7" stroke="#34495e" stroke-width="1.5"/><circle cx="8" cy="19" r="1" fill="#e74c3c"/><circle cx="16" cy="19" r="1" fill="#27ae60"/></svg>',
            overview: '<svg class="icon-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="3" width="7" height="7" rx="1" fill="#3498db" stroke="#2980b9" stroke-width="1.5"/><rect x="14" y="3" width="7" height="7" rx="1" fill="#27ae60" stroke="#1e8449" stroke-width="1.5"/><rect x="3" y="14" width="7" height="7" rx="1" fill="#e67e22" stroke="#d35400" stroke-width="1.5"/><rect x="14" y="14" width="7" height="7" rx="1" fill="#9b59b6" stroke="#8e44ad" stroke-width="1.5"/></svg>',
            farm: '<svg class="icon-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L2 7L12 12L22 7L12 2Z" fill="#27ae60" stroke="#1e8449" stroke-width="1.5"/><path d="M2 17L12 22L22 17" stroke="#1e8449" stroke-width="1.5" stroke-linecap="round"/><path d="M2 12L12 17L22 12" stroke="#1e8449" stroke-width="1.5" stroke-linecap="round"/></svg>',
            yield: '<svg class="icon-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L2 7L12 12L22 7L12 2Z" fill="#27ae60" stroke="#1e8449" stroke-width="1.5"/><circle cx="12" cy="7" r="2" fill="#1e8449"/></svg>',
            pest: '<svg class="icon-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="9" cy="9" r="6" fill="#e74c3c" stroke="#c0392b" stroke-width="1.5"/><circle cx="9" cy="9" r="2" fill="white"/><path d="M15 15L21 21" stroke="#c0392b" stroke-width="2" stroke-linecap="round"/><path d="M6 6L3 3" stroke="#c0392b" stroke-width="1.5" stroke-linecap="round"/><path d="M12 6L11 3" stroke="#c0392b" stroke-width="1.5" stroke-linecap="round"/><path d="M6 12L3 11" stroke="#c0392b" stroke-width="1.5" stroke-linecap="round"/></svg>',
            machinery: '<svg class="icon-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="8" width="18" height="10" rx="2" fill="#34495e" stroke="#2c3e50" stroke-width="1.5"/><circle cx="8" cy="18" r="2" fill="#2c3e50"/><circle cx="16" cy="18" r="2" fill="#2c3e50"/><path d="M8 13H16" stroke="white" stroke-width="1.5" stroke-linecap="round"/><path d="M10 10H14" stroke="white" stroke-width="1.5" stroke-linecap="round"/></svg>',
            spoilage: '<svg class="icon-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="8" fill="#3498db" stroke="#2980b9" stroke-width="1.5"/><path d="M8 12H16" stroke="white" stroke-width="2" stroke-linecap="round"/><circle cx="9" cy="9" r="1.5" fill="white"/><circle cx="15" cy="9" r="1.5" fill="white"/></svg>',
            temperature: '<svg class="icon-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2V8M12 8C10.8954 8 10 8.89543 10 10C10 11.1046 10.8954 12 12 12C13.1046 12 14 11.1046 14 10C14 8.89543 13.1046 8 12 8Z" stroke="#e74c3c" stroke-width="1.5" stroke-linecap="round"/><path d="M12 12V20C12 21.1046 12.8954 22 14 22C15.1046 22 16 21.1046 16 20V10" stroke="#e74c3c" stroke-width="1.5" stroke-linecap="round"/></svg>',
            defects: '<svg class="icon-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="8" stroke="#e67e22" stroke-width="1.5"/><path d="M12 8V12M12 16H12.01" stroke="#e67e22" stroke-width="2" stroke-linecap="round"/></svg>',
            delays: '<svg class="icon-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="10" stroke="#34495e" stroke-width="1.5"/><path d="M12 6V12L16 14" stroke="#34495e" stroke-width="2" stroke-linecap="round"/></svg>',
            waste_icon: '<svg class="icon-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 6H5H21" stroke="#95a5a6" stroke-width="2" stroke-linecap="round"/><path d="M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="#95a5a6" stroke-width="1.5" stroke-linecap="round"/></svg>',
            fuel: '<svg class="icon-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 18L5 6H19L21 18M3 18H21M3 18V20C3 21.1046 3.89543 22 5 22H19C20.1046 22 21 21.1046 21 20V18" stroke="#f39c12" stroke-width="1.5" stroke-linecap="round"/><path d="M8 10V14M12 10V14M16 10V14" stroke="#f39c12" stroke-width="1.5" stroke-linecap="round"/></svg>',
            distance: '<svg class="icon-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C8.13 2 5 5.13 5 9C5 14.25 12 22 12 22C12 22 19 14.25 19 9C19 5.13 15.87 2 12 2Z" stroke="#3498db" stroke-width="1.5"/><circle cx="12" cy="9" r="3" fill="#3498db"/></svg>',
            inventory: '<svg class="icon-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="7" width="18" height="14" rx="2" fill="#9b59b6" stroke="#8e44ad" stroke-width="1.5"/><path d="M8 7V5C8 3.89543 8.89543 3 10 3H14C15.1046 3 16 3.89543 16 5V7" stroke="#8e44ad" stroke-width="1.5"/><path d="M8 12H16M8 16H16" stroke="white" stroke-width="1.5" stroke-linecap="round"/></svg>',
            sales: '<svg class="icon-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 3H5L7.68 14.39C7.77144 14.8504 8.02191 15.264 8.38755 15.5583C8.75318 15.8526 9.2107 16.009 9.68 16H19.4C19.8693 16.009 20.3268 15.8526 20.6925 15.5583C21.0581 15.264 21.3086 14.8504 21.4 14.39L23 8H6" stroke="#27ae60" stroke-width="1.5" stroke-linecap="round"/><circle cx="9" cy="20" r="1" fill="#27ae60"/><circle cx="20" cy="20" r="1" fill="#27ae60"/></svg>',
            household: '<svg class="icon-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 12L5 10M5 10L12 3L19 10M5 10V20C5 20.5523 5.44772 21 6 21H9M19 10L21 12M19 10V20C19 20.5523 18.5523 21 18 21H15M9 21C9.55228 21 10 20.5523 10 20V16C10 15.4477 10.4477 15 11 15H13C13.5523 15 14 15.4477 14 16V20C14 20.5523 14.4477 21 15 21M9 21H15" stroke="#e74c3c" stroke-width="1.5" stroke-linecap="round"/></svg>',
            ai: '<svg class="icon-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="8" fill="#667eea" stroke="#764ba2" stroke-width="1.5"/><path d="M9 12L11 14L15 10" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',
            sparkle: '<svg class="icon-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L13.5 8.5L20 10L13.5 11.5L12 18L10.5 11.5L4 10L10.5 8.5L12 2Z" fill="#f39c12" stroke="#e67e22" stroke-width="1"/></svg>'
        };
        
        function getIcon(name, size = '') {
            // Return emoji for farm icon
            if (name === 'farm') {
                return 'üåæ';
            }
            const sizeClass = size ? ` icon-svg-${size}` : '';
            return icons[name] ? icons[name].replace('class="icon-svg"', `class="icon-svg${sizeClass}"`) : '';
        }
        
        // Translation System
        let currentLanguage = localStorage.getItem('appLanguage') || 'en';
        
        const translations = {
            en: {
                header: {
                    subtitle: 'AI-Powered Analytics Dashboard',
                    aiEnabled: 'AI Insights Enabled'
                },
                sidebar: {
                    overview: 'Overview',
                    production: 'Production',
                    storage: 'Storage',
                    processing: 'Processing',
                    transport: 'Transport',
                    retail: 'Retail',
                    price: 'Price Prediction',
                    recommendation: 'Crop Recommendation',
                    consumption: 'Consumption',
                    waste: 'Waste',
                    security: 'Security'
                },
                farms: {
                    all: 'All Farms',
                    farmA: 'Farm A',
                    farmB: 'Farm B',
                    farmC: 'Farm C',
                    farmD: 'Farm D'
                },
                sections: {
                    overview: 'Farm Comparison Overview',
                    production: 'Production Stage',
                    storage: 'Storage & Post-Harvest',
                    processing: 'Processing & Packaging',
                    transportation: 'Distribution & Transportation',
                    retail: 'Retail Insights',
                    consumption: 'Consumption & Household',
                    waste: 'Waste Management',
                    security: 'Security Camera Feed',
                    price: 'Price Prediction',
                    recommendation: 'Crop Recommendation'
                },
                buttons: {
                    connect: 'Connect',
                    disconnect: 'Disconnect',
                    viewDetails: 'View Details',
                    viewProduction: 'View Production Details',
                    viewStorage: 'View Storage Details',
                    viewProcessing: 'View Processing Details',
                    viewTransportation: 'View Transportation Details',
                    viewRetail: 'View Retail Details',
                    viewConsumption: 'View Consumption Details',
                    viewWaste: 'View Waste Details',
                    viewAllCrops: 'View All Crops'
                },
                security: {
                    espcamConfig: 'ESPCam Configuration',
                    ipAddress: 'ESP32 Camera IP Address',
                    port: 'Port',
                    cameraFeed: 'Camera Feed',
                    configureConnect: 'Configure and connect to view live feed',
                    securityAlerts: 'Security Alerts',
                    enterIP: 'Enter your ESP32 camera IP address and port to view the live feed.'
                },
                price: {
                    forecastTitle: '6-Month Crop Price Forecasts',
                    forecastDescription: 'View detailed price predictions with confidence intervals for all trained crops',
                    selectCrop: 'Select a crop to view the 6-month price forecast with confidence intervals.'
                },
                charts: {
                    yieldComparison: 'Yield Comparison',
                    spoilageComparison: 'Spoilage Comparison',
                    performanceScore: 'Performance Score',
                    defectRate: 'Defect Rate Comparison',
                    averageYield: 'Average Yield by Crop',
                    storageMetrics: 'Storage Metrics',
                    defectRateByProcess: 'Defect Rate by Process',
                    transportationMetrics: 'Transportation Metrics',
                    inventorySales: 'Inventory & Sales',
                    householdMetrics: 'Household Metrics',
                    wasteDistribution: 'Waste Distribution'
                },
                recommendation: {
                    optimizedAllocation: 'Optimized Crop Allocation',
                    allocationDescription: 'Each farm is assigned a unique crop to maximize profit and prevent market saturation',
                    you: 'You',
                    recommendedCrop: 'RECOMMENDED CROP',
                    profitability: 'Profitability',
                    price: 'Price',
                    perQuintal: '/quintal',
                    viewDetails: 'View Details ‚Üí',
                    backToAll: '‚Üê Back to All Farms',
                    whyThisCrop: 'Why This Crop?',
                    cropComparison: 'Crop Comparison',
                    best: '‚úì BEST',
                    marketStrategy: 'Cross-Farm Market Strategy',
                    marketStrategyDesc: 'To prevent market saturation and maximize prices, farms are allocated different crops:',
                    perHectare: 'per quintal',
                    tonnesPerHectare: 'tonnes/hectare',
                    estProfit: 'Est. Profit/ha'
                },
                metrics: {
                    yield: 'Yield',
                    spoilage: 'Spoilage',
                    defects: 'Defects',
                    delays: 'Delays',
                    waste: 'Waste',
                    pestRisk: 'Pest Risk',
                    machineryUptime: 'Machinery Uptime',
                    harvestUptime: 'Harvest Uptime',
                    carbonFootprint: 'Carbon Footprint',
                    productionCarbon: 'Production Carbon',
                    storageCarbon: 'Storage Carbon',
                    processingCarbon: 'Processing Carbon',
                    transportationCarbon: 'Transportation Carbon',
                    wasteCarbon: 'Waste Carbon',
                    totalProduction: 'Total Production',
                    avgDefectRate: 'Avg Defect Rate',
                    avgSpoilage: 'Avg Spoilage',
                    performanceScore: 'Performance Score'
                },
                status: {
                    excellent: 'Excellent',
                    good: 'Good',
                    average: 'Average',
                    poor: 'Poor'
                },
                units: {
                    tonnesPerHa: 'tonnes/ha',
                    percent: '%',
                    per10: '/10',
                    kgCO2e: 'kg CO2e'
                },
                ai: {
                    insights: 'AI Insights',
                    analysis: 'AI Analysis',
                    comparison: 'AI Comparison',
                    recommendations: 'Recommendations',
                    allMetricsOptimal: 'All metrics within optimal range',
                    allFarmsPerforming: 'All farms performing well'
                },
                report: {
                    downloadReport: 'Download Detailed Analysis Report',
                    selectLanguage: 'Select Language for Report',
                    generating: 'Generating Report...',
                    download: 'Download',
                    cancel: 'Cancel'
                }
            },
            hi: {
                header: {
                    subtitle: 'AI-‡§∏‡§Ç‡§ö‡§æ‡§≤‡§ø‡§§ ‡§è‡§®‡§æ‡§≤‡§ø‡§ü‡§ø‡§ï‡•ç‡§∏ ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°',
                    aiEnabled: 'AI ‡§Ö‡§Ç‡§§‡§∞‡•ç‡§¶‡•É‡§∑‡•ç‡§ü‡§ø ‡§∏‡§ï‡•ç‡§∑‡§Æ'
                },
                sidebar: {
                    overview: '‡§Ö‡§µ‡§≤‡•ã‡§ï‡§®',
                    production: '‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§®',
                    storage: '‡§≠‡§Ç‡§°‡§æ‡§∞‡§£',
                    processing: '‡§™‡•ç‡§∞‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£',
                    transport: '‡§™‡§∞‡§ø‡§µ‡§π‡§®',
                    retail: '‡§ñ‡•Å‡§¶‡§∞‡§æ',
                    price: '‡§Æ‡•Ç‡§≤‡•ç‡§Ø ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø‡§µ‡§æ‡§£‡•Ä',
                    recommendation: '‡§´‡§∏‡§≤ ‡§∏‡§ø‡§´‡§æ‡§∞‡§ø‡§∂',
                    consumption: '‡§â‡§™‡§≠‡•ã‡§ó',
                    waste: '‡§Ö‡§™‡§∂‡§ø‡§∑‡•ç‡§ü',
                    security: '‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ'
                },
                farms: {
                    all: '‡§∏‡§≠‡•Ä ‡§´‡§æ‡§∞‡•ç‡§Æ',
                    farmA: '‡§´‡§æ‡§∞‡•ç‡§Æ A',
                    farmB: '‡§´‡§æ‡§∞‡•ç‡§Æ B',
                    farmC: '‡§´‡§æ‡§∞‡•ç‡§Æ C',
                    farmD: '‡§´‡§æ‡§∞‡•ç‡§Æ D'
                },
                sections: {
                    overview: '‡§´‡§æ‡§∞‡•ç‡§Æ ‡§§‡•Å‡§≤‡§®‡§æ ‡§Ö‡§µ‡§≤‡•ã‡§ï‡§®',
                    production: '‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§® ‡§ö‡§∞‡§£',
                    storage: '‡§≠‡§Ç‡§°‡§æ‡§∞‡§£ ‡§î‡§∞ ‡§ï‡§ü‡§æ‡§à ‡§ï‡•á ‡§¨‡§æ‡§¶',
                    processing: '‡§™‡•ç‡§∞‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£ ‡§î‡§∞ ‡§™‡•à‡§ï‡•á‡§ú‡§ø‡§Ç‡§ó',
                    transportation: '‡§µ‡§ø‡§§‡§∞‡§£ ‡§î‡§∞ ‡§™‡§∞‡§ø‡§µ‡§π‡§®',
                    retail: '‡§ñ‡•Å‡§¶‡§∞‡§æ ‡§Ö‡§Ç‡§§‡§∞‡•ç‡§¶‡•É‡§∑‡•ç‡§ü‡§ø',
                    consumption: '‡§â‡§™‡§≠‡•ã‡§ó ‡§î‡§∞ ‡§ò‡§∞‡•á‡§≤‡•Ç',
                    waste: '‡§Ö‡§™‡§∂‡§ø‡§∑‡•ç‡§ü ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®',
                    security: '‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§ï‡•à‡§Æ‡§∞‡§æ ‡§´‡•Ä‡§°',
                    price: '‡§Æ‡•Ç‡§≤‡•ç‡§Ø ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø‡§µ‡§æ‡§£‡•Ä',
                    recommendation: '‡§´‡§∏‡§≤ ‡§∏‡§ø‡§´‡§æ‡§∞‡§ø‡§∂'
                },
                buttons: {
                    connect: '‡§ï‡§®‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç',
                    disconnect: '‡§°‡§ø‡§∏‡•ç‡§ï‡§®‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç',
                    viewDetails: '‡§µ‡§ø‡§µ‡§∞‡§£ ‡§¶‡•á‡§ñ‡•á‡§Ç',
                    viewProduction: '‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§® ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§¶‡•á‡§ñ‡•á‡§Ç',
                    viewStorage: '‡§≠‡§Ç‡§°‡§æ‡§∞‡§£ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§¶‡•á‡§ñ‡•á‡§Ç',
                    viewProcessing: '‡§™‡•ç‡§∞‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§¶‡•á‡§ñ‡•á‡§Ç',
                    viewTransportation: '‡§™‡§∞‡§ø‡§µ‡§π‡§® ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§¶‡•á‡§ñ‡•á‡§Ç',
                    viewRetail: '‡§ñ‡•Å‡§¶‡§∞‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§¶‡•á‡§ñ‡•á‡§Ç',
                    viewConsumption: '‡§â‡§™‡§≠‡•ã‡§ó ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§¶‡•á‡§ñ‡•á‡§Ç',
                    viewWaste: '‡§Ö‡§™‡§∂‡§ø‡§∑‡•ç‡§ü ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§¶‡•á‡§ñ‡•á‡§Ç',
                    viewAllCrops: '‡§∏‡§≠‡•Ä ‡§´‡§∏‡§≤‡•á‡§Ç ‡§¶‡•á‡§ñ‡•á‡§Ç'
                },
                security: {
                    espcamConfig: 'ESPCam ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞‡•á‡§∂‡§®',
                    ipAddress: 'ESP32 ‡§ï‡•à‡§Æ‡§∞‡§æ IP ‡§™‡§§‡§æ',
                    port: '‡§™‡•ã‡§∞‡•ç‡§ü',
                    cameraFeed: '‡§ï‡•à‡§Æ‡§∞‡§æ ‡§´‡•Ä‡§°',
                    configureConnect: '‡§≤‡§æ‡§á‡§µ ‡§´‡•Ä‡§° ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§ï‡§®‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç',
                    securityAlerts: '‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§Ö‡§≤‡§∞‡•ç‡§ü',
                    enterIP: '‡§≤‡§æ‡§á‡§µ ‡§´‡•Ä‡§° ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§™‡§®‡§æ ESP32 ‡§ï‡•à‡§Æ‡§∞‡§æ IP ‡§™‡§§‡§æ ‡§î‡§∞ ‡§™‡•ã‡§∞‡•ç‡§ü ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç‡•§'
                },
                price: {
                    forecastTitle: '6-‡§Æ‡§π‡•Ä‡§®‡•á ‡§ï‡•Ä ‡§´‡§∏‡§≤ ‡§Æ‡•Ç‡§≤‡•ç‡§Ø ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§®‡•Å‡§Æ‡§æ‡§®',
                    forecastDescription: '‡§∏‡§≠‡•Ä ‡§™‡•ç‡§∞‡§∂‡§ø‡§ï‡•ç‡§∑‡§ø‡§§ ‡§´‡§∏‡§≤‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§Ö‡§Ç‡§§‡§∞‡§æ‡§≤ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§Æ‡•Ç‡§≤‡•ç‡§Ø ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§®‡•Å‡§Æ‡§æ‡§® ‡§¶‡•á‡§ñ‡•á‡§Ç',
                    selectCrop: '6-‡§Æ‡§π‡•Ä‡§®‡•á ‡§ï‡•á ‡§Æ‡•Ç‡§≤‡•ç‡§Ø ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§®‡•Å‡§Æ‡§æ‡§® ‡§ï‡•ã ‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§Ö‡§Ç‡§§‡§∞‡§æ‡§≤ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§´‡§∏‡§≤ ‡§ö‡•Å‡§®‡•á‡§Ç‡•§'
                },
                charts: {
                    yieldComparison: '‡§â‡§™‡§ú ‡§§‡•Å‡§≤‡§®‡§æ',
                    spoilageComparison: '‡§ñ‡§∞‡§æ‡§¨‡•Ä ‡§§‡•Å‡§≤‡§®‡§æ',
                    performanceScore: '‡§™‡•ç‡§∞‡§¶‡§∞‡•ç‡§∂‡§® ‡§∏‡•ç‡§ï‡•ã‡§∞',
                    defectRate: '‡§¶‡•ã‡§∑ ‡§¶‡§∞ ‡§§‡•Å‡§≤‡§®‡§æ',
                    averageYield: '‡§´‡§∏‡§≤ ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§î‡§∏‡§§ ‡§â‡§™‡§ú',
                    storageMetrics: '‡§≠‡§Ç‡§°‡§æ‡§∞‡§£ ‡§Æ‡•á‡§ü‡•ç‡§∞‡§ø‡§ï‡•ç‡§∏',
                    defectRateByProcess: '‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§¶‡•ã‡§∑ ‡§¶‡§∞',
                    transportationMetrics: '‡§™‡§∞‡§ø‡§µ‡§π‡§® ‡§Æ‡•á‡§ü‡•ç‡§∞‡§ø‡§ï‡•ç‡§∏',
                    inventorySales: '‡§á‡§®‡•ç‡§µ‡•á‡§Ç‡§ü‡§∞‡•Ä ‡§î‡§∞ ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä',
                    householdMetrics: '‡§ò‡§∞‡•á‡§≤‡•Ç ‡§Æ‡•á‡§ü‡•ç‡§∞‡§ø‡§ï‡•ç‡§∏',
                    wasteDistribution: '‡§Ö‡§™‡§∂‡§ø‡§∑‡•ç‡§ü ‡§µ‡§ø‡§§‡§∞‡§£'
                },
                recommendation: {
                    optimizedAllocation: '‡§Ö‡§®‡•Å‡§ï‡•Ç‡§≤‡§ø‡§§ ‡§´‡§∏‡§≤ ‡§Ü‡§µ‡§Ç‡§ü‡§®',
                    allocationDescription: '‡§≤‡§æ‡§≠ ‡§ï‡•ã ‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ ‡§ï‡§∞‡§®‡•á ‡§î‡§∞ ‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§∏‡§Ç‡§§‡•É‡§™‡•ç‡§§‡§ø ‡§ï‡•ã ‡§∞‡•ã‡§ï‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§´‡§æ‡§∞‡•ç‡§Æ ‡§ï‡•ã ‡§è‡§ï ‡§Ö‡§¶‡•ç‡§µ‡§ø‡§§‡•Ä‡§Ø ‡§´‡§∏‡§≤ ‡§∏‡•å‡§Ç‡§™‡•Ä ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à',
                    you: '‡§Ü‡§™',
                    recommendedCrop: '‡§Ö‡§®‡•Å‡§∂‡§Ç‡§∏‡§ø‡§§ ‡§´‡§∏‡§≤',
                    profitability: '‡§≤‡§æ‡§≠‡§™‡•ç‡§∞‡§¶‡§§‡§æ',
                    price: '‡§Æ‡•Ç‡§≤‡•ç‡§Ø',
                    perQuintal: '/‡§ï‡•ç‡§µ‡§ø‡§Ç‡§ü‡§≤',
                    viewDetails: '‡§µ‡§ø‡§µ‡§∞‡§£ ‡§¶‡•á‡§ñ‡•á‡§Ç ‚Üí',
                    backToAll: '‚Üê ‡§∏‡§≠‡•Ä ‡§´‡§æ‡§∞‡•ç‡§Æ ‡§™‡§∞ ‡§µ‡§æ‡§™‡§∏',
                    whyThisCrop: '‡§Ø‡§π ‡§´‡§∏‡§≤ ‡§ï‡•ç‡§Ø‡•ã‡§Ç?',
                    cropComparison: '‡§´‡§∏‡§≤ ‡§§‡•Å‡§≤‡§®‡§æ',
                    best: '‚úì ‡§∏‡§∞‡•ç‡§µ‡§∂‡•ç‡§∞‡•á‡§∑‡•ç‡§†',
                    marketStrategy: '‡§ï‡•ç‡§∞‡•â‡§∏-‡§´‡§æ‡§∞‡•ç‡§Æ ‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§∞‡§£‡§®‡•Ä‡§§‡§ø',
                    marketStrategyDesc: '‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§∏‡§Ç‡§§‡•É‡§™‡•ç‡§§‡§ø ‡§ï‡•ã ‡§∞‡•ã‡§ï‡§®‡•á ‡§î‡§∞ ‡§Æ‡•Ç‡§≤‡•ç‡§Ø‡•ã‡§Ç ‡§ï‡•ã ‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è, ‡§´‡§æ‡§∞‡•ç‡§Æ‡•ã‡§Ç ‡§ï‡•ã ‡§Ö‡§≤‡§ó-‡§Ö‡§≤‡§ó ‡§´‡§∏‡§≤‡•á‡§Ç ‡§Ü‡§µ‡§Ç‡§ü‡§ø‡§§ ‡§ï‡•Ä ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à‡§Ç:',
                    perHectare: '‡§™‡•ç‡§∞‡§§‡§ø ‡§ï‡•ç‡§µ‡§ø‡§Ç‡§ü‡§≤',
                    tonnesPerHectare: '‡§ü‡§®/‡§π‡•á‡§ï‡•ç‡§ü‡•á‡§Ø‡§∞',
                    estProfit: '‡§Ö‡§®‡•Å‡§Æ‡§æ‡§®‡§ø‡§§ ‡§≤‡§æ‡§≠/‡§π‡•á'
                },
                metrics: {
                    yield: '‡§â‡§™‡§ú',
                    spoilage: '‡§ñ‡§∞‡§æ‡§¨‡•Ä',
                    defects: '‡§¶‡•ã‡§∑',
                    delays: '‡§¶‡•á‡§∞‡•Ä',
                    waste: '‡§Ö‡§™‡§∂‡§ø‡§∑‡•ç‡§ü',
                    pestRisk: '‡§ï‡•Ä‡§ü ‡§ú‡•ã‡§ñ‡§ø‡§Æ',
                    machineryUptime: '‡§Æ‡§∂‡•Ä‡§®‡§∞‡•Ä ‡§Ö‡§™‡§ü‡§æ‡§á‡§Æ',
                    harvestUptime: '‡§ï‡§ü‡§æ‡§à ‡§Ö‡§™‡§ü‡§æ‡§á‡§Æ',
                    carbonFootprint: '‡§ï‡§æ‡§∞‡•ç‡§¨‡§® ‡§´‡•Å‡§ü‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü',
                    productionCarbon: '‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§® ‡§ï‡§æ‡§∞‡•ç‡§¨‡§®',
                    storageCarbon: '‡§≠‡§Ç‡§°‡§æ‡§∞‡§£ ‡§ï‡§æ‡§∞‡•ç‡§¨‡§®',
                    processingCarbon: '‡§™‡•ç‡§∞‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£ ‡§ï‡§æ‡§∞‡•ç‡§¨‡§®',
                    transportationCarbon: '‡§™‡§∞‡§ø‡§µ‡§π‡§® ‡§ï‡§æ‡§∞‡•ç‡§¨‡§®',
                    wasteCarbon: '‡§Ö‡§™‡§∂‡§ø‡§∑‡•ç‡§ü ‡§ï‡§æ‡§∞‡•ç‡§¨‡§®',
                    totalProduction: '‡§ï‡•Å‡§≤ ‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§®',
                    avgDefectRate: '‡§î‡§∏‡§§ ‡§¶‡•ã‡§∑ ‡§¶‡§∞',
                    avgSpoilage: '‡§î‡§∏‡§§ ‡§ñ‡§∞‡§æ‡§¨‡•Ä',
                    performanceScore: '‡§™‡•ç‡§∞‡§¶‡§∞‡•ç‡§∂‡§® ‡§∏‡•ç‡§ï‡•ã‡§∞'
                },
                status: {
                    excellent: '‡§â‡§§‡•ç‡§ï‡•É‡§∑‡•ç‡§ü',
                    good: '‡§Ö‡§ö‡•ç‡§õ‡§æ',
                    average: '‡§î‡§∏‡§§',
                    poor: '‡§ñ‡§∞‡§æ‡§¨'
                },
                units: {
                    tonnesPerHa: '‡§ü‡§®/‡§π‡•á',
                    percent: '%',
                    per10: '/10',
                    kgCO2e: '‡§ï‡§ø‡§ó‡•ç‡§∞‡§æ CO2e'
                },
                ai: {
                    insights: 'AI ‡§Ö‡§Ç‡§§‡§∞‡•ç‡§¶‡•É‡§∑‡•ç‡§ü‡§ø',
                    analysis: 'AI ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£',
                    comparison: 'AI ‡§§‡•Å‡§≤‡§®‡§æ',
                    recommendations: '‡§∏‡§ø‡§´‡§æ‡§∞‡§ø‡§∂‡•á‡§Ç',
                    allMetricsOptimal: '‡§∏‡§≠‡•Ä ‡§Æ‡•á‡§ü‡•ç‡§∞‡§ø‡§ï‡•ç‡§∏ ‡§á‡§∑‡•ç‡§ü‡§§‡§Æ ‡§∏‡•Ä‡§Æ‡§æ ‡§ï‡•á ‡§≠‡•Ä‡§§‡§∞',
                    allFarmsPerforming: '‡§∏‡§≠‡•Ä ‡§´‡§æ‡§∞‡•ç‡§Æ ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§™‡•ç‡§∞‡§¶‡§∞‡•ç‡§∂‡§® ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç'
                },
                report: {
                    downloadReport: '‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç',
                    selectLanguage: '‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡•á ‡§≤‡§ø‡§è ‡§≠‡§æ‡§∑‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç',
                    generating: '‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§ï‡•Ä ‡§ú‡§æ ‡§∞‡§π‡•Ä ‡§π‡•à...',
                    download: '‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§°',
                    cancel: '‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç'
                }
            },
            kn: {
                header: {
                    subtitle: 'AI-‡≤ö‡≤æ‡≤≤‡≤ø‡≤§ ‡≤µ‡≤ø‡≤∂‡≥ç‡≤≤‡≥á‡≤∑‡≤£‡≤æ ‡≤°‡≥ç‡≤Ø‡≤æ‡≤∂‡≥ç‡≤¨‡≥ã‡≤∞‡≥ç‡≤°‡≥ç',
                    aiEnabled: 'AI ‡≤í‡≤≥‡≤®‡≥ã‡≤ü‡≤ó‡≤≥‡≥Å ‡≤∏‡≤ï‡≥ç‡≤∞‡≤ø‡≤Ø‡≤ó‡≥ä‡≤Ç‡≤°‡≤ø‡≤µ‡≥Ü'
                },
                sidebar: {
                    overview: '‡≤Ö‡≤µ‡≤≤‡≥ã‡≤ï‡≤®',
                    production: '‡≤â‡≤§‡≥ç‡≤™‡≤æ‡≤¶‡≤®‡≥Ü',
                    storage: '‡≤∏‡≤Ç‡≤ó‡≥ç‡≤∞‡≤π‡≤£‡≥Ü',
                    processing: '‡≤∏‡≤Ç‡≤∏‡≥ç‡≤ï‡≤∞‡≤£‡≥Ü',
                    transport: '‡≤∏‡≤æ‡≤∞‡≤ø‡≤ó‡≥Ü',
                    retail: '‡≤ö‡≤ø‡≤≤‡≥ç‡≤≤‡≤∞‡≥Ü',
                    price: '‡≤¨‡≥Ü‡≤≤‡≥Ü ‡≤≠‡≤µ‡≤ø‡≤∑‡≥ç‡≤Ø‡≤µ‡≤æ‡≤£‡≤ø',
                    recommendation: '‡≤¨‡≥Ü‡≤≥‡≥Ü ‡≤∂‡≤ø‡≤´‡≤æ‡≤∞‡≤∏‡≥Å',
                    consumption: '‡≤¨‡≤≥‡≤ï‡≥Ü',
                    waste: '‡≤ï‡≤∏',
                    security: '‡≤≠‡≤¶‡≥ç‡≤∞‡≤§‡≥Ü'
                },
                farms: {
                    all: '‡≤é‡≤≤‡≥ç‡≤≤‡≤æ ‡≤´‡≤æ‡≤∞‡≥ç‡≤Æ‡≥ç‡≤ó‡≤≥‡≥Å',
                    farmA: '‡≤´‡≤æ‡≤∞‡≥ç‡≤Æ‡≥ç A',
                    farmB: '‡≤´‡≤æ‡≤∞‡≥ç‡≤Æ‡≥ç B',
                    farmC: '‡≤´‡≤æ‡≤∞‡≥ç‡≤Æ‡≥ç C',
                    farmD: '‡≤´‡≤æ‡≤∞‡≥ç‡≤Æ‡≥ç D'
                },
                sections: {
                    overview: '‡≤´‡≤æ‡≤∞‡≥ç‡≤Æ‡≥ç ‡≤π‡≥ã‡≤≤‡≤ø‡≤ï‡≥Ü ‡≤Ö‡≤µ‡≤≤‡≥ã‡≤ï‡≤®',
                    production: '‡≤â‡≤§‡≥ç‡≤™‡≤æ‡≤¶‡≤®‡≥Ü ‡≤π‡≤Ç‡≤§',
                    storage: '‡≤∏‡≤Ç‡≤ó‡≥ç‡≤∞‡≤π‡≤£‡≥Ü ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤ï‡≥ä‡≤Ø‡≥ç‡≤≤‡≥Å ‡≤®‡≤Ç‡≤§‡≤∞',
                    processing: '‡≤∏‡≤Ç‡≤∏‡≥ç‡≤ï‡≤∞‡≤£‡≥Ü ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤™‡≥ç‡≤Ø‡≤æ‡≤ï‡≥á‡≤ú‡≤ø‡≤Ç‡≤ó‡≥ç',
                    transportation: '‡≤µ‡≤ø‡≤§‡≤∞‡≤£‡≥Ü ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤∏‡≤æ‡≤∞‡≤ø‡≤ó‡≥Ü',
                    retail: '‡≤ö‡≤ø‡≤≤‡≥ç‡≤≤‡≤∞‡≥Ü ‡≤í‡≤≥‡≤®‡≥ã‡≤ü‡≤ó‡≤≥‡≥Å',
                    consumption: '‡≤¨‡≤≥‡≤ï‡≥Ü ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤Æ‡≤®‡≥Ü',
                    waste: '‡≤ï‡≤∏ ‡≤®‡≤ø‡≤∞‡≥ç‡≤µ‡≤π‡≤£‡≥Ü',
                    security: '‡≤≠‡≤¶‡≥ç‡≤∞‡≤§‡≤æ ‡≤ï‡≥ç‡≤Ø‡≤æ‡≤Æ‡≥Ü‡≤∞‡≤æ ‡≤´‡≥Ä‡≤°‡≥ç',
                    price: '‡≤¨‡≥Ü‡≤≤‡≥Ü ‡≤≠‡≤µ‡≤ø‡≤∑‡≥ç‡≤Ø‡≤µ‡≤æ‡≤£‡≤ø',
                    recommendation: '‡≤¨‡≥Ü‡≤≥‡≥Ü ‡≤∂‡≤ø‡≤´‡≤æ‡≤∞‡≤∏‡≥Å'
                },
                buttons: {
                    connect: '‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï‡≤ø‡≤∏‡≤ø',
                    disconnect: '‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï ‡≤ï‡≤°‡≤ø‡≤§‡≤ó‡≥ä‡≤≥‡≤ø‡≤∏‡≤ø',
                    viewDetails: '‡≤µ‡≤ø‡≤µ‡≤∞‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤µ‡≥Ä‡≤ï‡≥ç‡≤∑‡≤ø‡≤∏‡≤ø',
                    viewProduction: '‡≤â‡≤§‡≥ç‡≤™‡≤æ‡≤¶‡≤®‡≥Ü ‡≤µ‡≤ø‡≤µ‡≤∞‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤µ‡≥Ä‡≤ï‡≥ç‡≤∑‡≤ø‡≤∏‡≤ø',
                    viewStorage: '‡≤∏‡≤Ç‡≤ó‡≥ç‡≤∞‡≤π‡≤£‡≥Ü ‡≤µ‡≤ø‡≤µ‡≤∞‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤µ‡≥Ä‡≤ï‡≥ç‡≤∑‡≤ø‡≤∏‡≤ø',
                    viewProcessing: '‡≤∏‡≤Ç‡≤∏‡≥ç‡≤ï‡≤∞‡≤£‡≥Ü ‡≤µ‡≤ø‡≤µ‡≤∞‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤µ‡≥Ä‡≤ï‡≥ç‡≤∑‡≤ø‡≤∏‡≤ø',
                    viewTransportation: '‡≤∏‡≤æ‡≤∞‡≤ø‡≤ó‡≥Ü ‡≤µ‡≤ø‡≤µ‡≤∞‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤µ‡≥Ä‡≤ï‡≥ç‡≤∑‡≤ø‡≤∏‡≤ø',
                    viewRetail: '‡≤ö‡≤ø‡≤≤‡≥ç‡≤≤‡≤∞‡≥Ü ‡≤µ‡≤ø‡≤µ‡≤∞‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤µ‡≥Ä‡≤ï‡≥ç‡≤∑‡≤ø‡≤∏‡≤ø',
                    viewConsumption: '‡≤¨‡≤≥‡≤ï‡≥Ü ‡≤µ‡≤ø‡≤µ‡≤∞‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤µ‡≥Ä‡≤ï‡≥ç‡≤∑‡≤ø‡≤∏‡≤ø',
                    viewWaste: '‡≤ï‡≤∏ ‡≤µ‡≤ø‡≤µ‡≤∞‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤µ‡≥Ä‡≤ï‡≥ç‡≤∑‡≤ø‡≤∏‡≤ø',
                    viewAllCrops: '‡≤é‡≤≤‡≥ç‡≤≤‡≤æ ‡≤¨‡≥Ü‡≤≥‡≥Ü‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤µ‡≥Ä‡≤ï‡≥ç‡≤∑‡≤ø‡≤∏‡≤ø'
                },
                security: {
                    espcamConfig: 'ESPCam ‡≤∏‡≤Ç‡≤∞‡≤ö‡≤®‡≥Ü',
                    ipAddress: 'ESP32 ‡≤ï‡≥ç‡≤Ø‡≤æ‡≤Æ‡≥Ü‡≤∞‡≤æ IP ‡≤µ‡≤ø‡≤≥‡≤æ‡≤∏',
                    port: '‡≤™‡≥ã‡≤∞‡≥ç‡≤ü‡≥ç',
                    cameraFeed: '‡≤ï‡≥ç‡≤Ø‡≤æ‡≤Æ‡≥Ü‡≤∞‡≤æ ‡≤´‡≥Ä‡≤°‡≥ç',
                    configureConnect: '‡≤≤‡≥à‡≤µ‡≥ç ‡≤´‡≥Ä‡≤°‡≥ç ‡≤µ‡≥Ä‡≤ï‡≥ç‡≤∑‡≤ø‡≤∏‡≤≤‡≥Å ‡≤∏‡≤Ç‡≤∞‡≤ö‡≤ø‡≤∏‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï‡≤ø‡≤∏‡≤ø',
                    securityAlerts: '‡≤≠‡≤¶‡≥ç‡≤∞‡≤§‡≤æ ‡≤é‡≤ö‡≥ç‡≤ö‡≤∞‡≤ø‡≤ï‡≥Ü‡≤ó‡≤≥‡≥Å',
                    enterIP: '‡≤≤‡≥à‡≤µ‡≥ç ‡≤´‡≥Ä‡≤°‡≥ç ‡≤µ‡≥Ä‡≤ï‡≥ç‡≤∑‡≤ø‡≤∏‡≤≤‡≥Å ‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ESP32 ‡≤ï‡≥ç‡≤Ø‡≤æ‡≤Æ‡≥Ü‡≤∞‡≤æ IP ‡≤µ‡≤ø‡≤≥‡≤æ‡≤∏ ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤™‡≥ã‡≤∞‡≥ç‡≤ü‡≥ç ‡≤®‡≤Æ‡≥Ç‡≤¶‡≤ø‡≤∏‡≤ø.'
                },
                price: {
                    forecastTitle: '6-‡≤§‡≤ø‡≤Ç‡≤ó‡≤≥ ‡≤¨‡≥Ü‡≤≥‡≥Ü ‡≤¨‡≥Ü‡≤≤‡≥Ü ‡≤≠‡≤µ‡≤ø‡≤∑‡≥ç‡≤Ø‡≤µ‡≤æ‡≤£‡≤ø',
                    forecastDescription: '‡≤é‡≤≤‡≥ç‡≤≤‡≤æ ‡≤§‡≤∞‡≤¨‡≥á‡≤§‡≤ø ‡≤™‡≤°‡≥Ü‡≤¶ ‡≤¨‡≥Ü‡≤≥‡≥Ü‡≤ó‡≤≥‡≤ø‡≤ó‡≥Ü ‡≤µ‡≤ø‡≤∂‡≥ç‡≤µ‡≤æ‡≤∏‡≤æ‡≤∞‡≥ç‡≤π ‡≤Æ‡≤ß‡≥ç‡≤Ø‡≤Ç‡≤§‡≤∞‡≤ó‡≤≥‡≥ä‡≤Ç‡≤¶‡≤ø‡≤ó‡≥Ü ‡≤µ‡≤ø‡≤µ‡≤∞‡≤µ‡≤æ‡≤¶ ‡≤¨‡≥Ü‡≤≤‡≥Ü ‡≤≠‡≤µ‡≤ø‡≤∑‡≥ç‡≤Ø‡≤µ‡≤æ‡≤£‡≤ø‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤µ‡≥Ä‡≤ï‡≥ç‡≤∑‡≤ø‡≤∏‡≤ø',
                    selectCrop: '‡≤µ‡≤ø‡≤∂‡≥ç‡≤µ‡≤æ‡≤∏‡≤æ‡≤∞‡≥ç‡≤π ‡≤Æ‡≤ß‡≥ç‡≤Ø‡≤Ç‡≤§‡≤∞‡≤ó‡≤≥‡≥ä‡≤Ç‡≤¶‡≤ø‡≤ó‡≥Ü 6-‡≤§‡≤ø‡≤Ç‡≤ó‡≤≥ ‡≤¨‡≥Ü‡≤≤‡≥Ü ‡≤≠‡≤µ‡≤ø‡≤∑‡≥ç‡≤Ø‡≤µ‡≤æ‡≤£‡≤ø‡≤Ø‡≤®‡≥ç‡≤®‡≥Å ‡≤µ‡≥Ä‡≤ï‡≥ç‡≤∑‡≤ø‡≤∏‡≤≤‡≥Å ‡≤¨‡≥Ü‡≤≥‡≥Ü‡≤Ø‡≤®‡≥ç‡≤®‡≥Å ‡≤Ü‡≤Ø‡≥ç‡≤ï‡≥Ü‡≤Æ‡≤æ‡≤°‡≤ø.'
                },
                charts: {
                    yieldComparison: '‡≤â‡≤§‡≥ç‡≤™‡≤æ‡≤¶‡≤®‡≥Ü ‡≤π‡≥ã‡≤≤‡≤ø‡≤ï‡≥Ü',
                    spoilageComparison: '‡≤ï‡≥Ü‡≤°‡≥Å‡≤µ‡≤ø‡≤ï‡≥Ü ‡≤π‡≥ã‡≤≤‡≤ø‡≤ï‡≥Ü',
                    performanceScore: '‡≤™‡≥ç‡≤∞‡≤¶‡≤∞‡≥ç‡≤∂‡≤® ‡≤∏‡≥ç‡≤ï‡≥ã‡≤∞‡≥ç',
                    defectRate: '‡≤¶‡≥ã‡≤∑ ‡≤¶‡≤∞ ‡≤π‡≥ã‡≤≤‡≤ø‡≤ï‡≥Ü',
                    averageYield: '‡≤¨‡≥Ü‡≤≥‡≥Ü‡≤Ø‡≤ø‡≤Ç‡≤¶ ‡≤∏‡≤∞‡≤æ‡≤∏‡≤∞‡≤ø ‡≤â‡≤§‡≥ç‡≤™‡≤æ‡≤¶‡≤®‡≥Ü',
                    storageMetrics: '‡≤∏‡≤Ç‡≤ó‡≥ç‡≤∞‡≤π‡≤£‡≥Ü ‡≤Æ‡≥Ü‡≤ü‡≥ç‡≤∞‡≤ø‡≤ï‡≥ç‡≤∏‡≥ç',
                    defectRateByProcess: '‡≤™‡≥ç‡≤∞‡≤ï‡≥ç‡≤∞‡≤ø‡≤Ø‡≥Ü‡≤Ø‡≤ø‡≤Ç‡≤¶ ‡≤¶‡≥ã‡≤∑ ‡≤¶‡≤∞',
                    transportationMetrics: '‡≤∏‡≤æ‡≤∞‡≤ø‡≤ó‡≥Ü ‡≤Æ‡≥Ü‡≤ü‡≥ç‡≤∞‡≤ø‡≤ï‡≥ç‡≤∏‡≥ç',
                    inventorySales: '‡≤∏‡≥ç‡≤ü‡≤æ‡≤ï‡≥ç ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤Æ‡≤æ‡≤∞‡≤æ‡≤ü',
                    householdMetrics: '‡≤Æ‡≤®‡≥Ü ‡≤Æ‡≥Ü‡≤ü‡≥ç‡≤∞‡≤ø‡≤ï‡≥ç‡≤∏‡≥ç',
                    wasteDistribution: '‡≤ï‡≤∏ ‡≤µ‡≤ø‡≤§‡≤∞‡≤£‡≥Ü'
                },
                recommendation: {
                    optimizedAllocation: '‡≤Ö‡≤®‡≥Å‡≤ï‡≥Ç‡≤≤‡≤ï‡≤∞ ‡≤¨‡≥Ü‡≤≥‡≥Ü ‡≤π‡≤Ç‡≤ö‡≤ø‡≤ï‡≥Ü',
                    allocationDescription: '‡≤≤‡≤æ‡≤≠‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤ó‡≤∞‡≤ø‡≤∑‡≥ç‡≤†‡≤ó‡≥ä‡≤≥‡≤ø‡≤∏‡≤≤‡≥Å ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤Æ‡≤æ‡≤∞‡≥Å‡≤ï‡≤ü‡≥ç‡≤ü‡≥Ü ‡≤∏‡≤Ç‡≤§‡≥É‡≤™‡≥ç‡≤§‡≤ø‡≤Ø‡≤®‡≥ç‡≤®‡≥Å ‡≤§‡≤°‡≥Ü‡≤Ø‡≤≤‡≥Å ‡≤™‡≥ç‡≤∞‡≤§‡≤ø ‡≤´‡≤æ‡≤∞‡≥ç‡≤Æ‡≥ç‡≤ó‡≥Ü ‡≤í‡≤Ç‡≤¶‡≥Å ‡≤Ö‡≤®‡≤®‡≥ç‡≤Ø ‡≤¨‡≥Ü‡≤≥‡≥Ü ‡≤®‡≤ø‡≤ó‡≤¶‡≤ø‡≤™‡≤°‡≤ø‡≤∏‡≤≤‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü',
                    you: '‡≤®‡≥Ä‡≤µ‡≥Å',
                    recommendedCrop: '‡≤∂‡≤ø‡≤´‡≤æ‡≤∞‡≤∏‡≥Å ‡≤Æ‡≤æ‡≤°‡≤ø‡≤¶ ‡≤¨‡≥Ü‡≤≥‡≥Ü',
                    profitability: '‡≤≤‡≤æ‡≤≠‡≤¶‡≤æ‡≤Ø‡≤ï‡≤§‡≥Ü',
                    price: '‡≤¨‡≥Ü‡≤≤‡≥Ü',
                    perQuintal: '/‡≤ï‡≥ç‡≤µ‡≤ø‡≤Ç‡≤ü‡≤≤‡≥ç',
                    viewDetails: '‡≤µ‡≤ø‡≤µ‡≤∞‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤µ‡≥Ä‡≤ï‡≥ç‡≤∑‡≤ø‡≤∏‡≤ø ‚Üí',
                    backToAll: '‚Üê ‡≤é‡≤≤‡≥ç‡≤≤‡≤æ ‡≤´‡≤æ‡≤∞‡≥ç‡≤Æ‡≥ç‡≤ó‡≤≥‡≤ø‡≤ó‡≥Ü ‡≤π‡≤ø‡≤Ç‡≤¶‡≤ø‡≤∞‡≥Å‡≤ó‡≤ø',
                    whyThisCrop: '‡≤à ‡≤¨‡≥Ü‡≤≥‡≥Ü ‡≤è‡≤ï‡≥Ü?',
                    cropComparison: '‡≤¨‡≥Ü‡≤≥‡≥Ü ‡≤π‡≥ã‡≤≤‡≤ø‡≤ï‡≥Ü',
                    best: '‚úì ‡≤Ö‡≤§‡≥ç‡≤Ø‡≥Å‡≤§‡≥ç‡≤§‡≤Æ',
                    marketStrategy: '‡≤ï‡≥ç‡≤∞‡≤æ‡≤∏‡≥ç-‡≤´‡≤æ‡≤∞‡≥ç‡≤Æ‡≥ç ‡≤Æ‡≤æ‡≤∞‡≥Å‡≤ï‡≤ü‡≥ç‡≤ü‡≥Ü ‡≤§‡≤Ç‡≤§‡≥ç‡≤∞',
                    marketStrategyDesc: '‡≤Æ‡≤æ‡≤∞‡≥Å‡≤ï‡≤ü‡≥ç‡≤ü‡≥Ü ‡≤∏‡≤Ç‡≤§‡≥É‡≤™‡≥ç‡≤§‡≤ø‡≤Ø‡≤®‡≥ç‡≤®‡≥Å ‡≤§‡≤°‡≥Ü‡≤Ø‡≤≤‡≥Å ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤¨‡≥Ü‡≤≤‡≥Ü‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤ó‡≤∞‡≤ø‡≤∑‡≥ç‡≤†‡≤ó‡≥ä‡≤≥‡≤ø‡≤∏‡≤≤‡≥Å, ‡≤´‡≤æ‡≤∞‡≥ç‡≤Æ‡≥ç‡≤ó‡≤≥‡≤ø‡≤ó‡≥Ü ‡≤µ‡≤ø‡≤≠‡≤ø‡≤®‡≥ç‡≤® ‡≤¨‡≥Ü‡≤≥‡≥Ü‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤®‡≤ø‡≤ó‡≤¶‡≤ø‡≤™‡≤°‡≤ø‡≤∏‡≤≤‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü:',
                    perHectare: '‡≤™‡≥ç‡≤∞‡≤§‡≤ø ‡≤ï‡≥ç‡≤µ‡≤ø‡≤Ç‡≤ü‡≤≤‡≥ç',
                    tonnesPerHectare: '‡≤ü‡≤®‡≥ç/‡≤π‡≥Ü‡≤ï‡≥ç‡≤ü‡≥á‡≤∞‡≥ç',
                    estProfit: '‡≤Ö‡≤Ç‡≤¶‡≤æ‡≤ú‡≥Å ‡≤≤‡≤æ‡≤≠/‡≤π‡≥Ü'
                },
                metrics: {
                    yield: '‡≤â‡≤§‡≥ç‡≤™‡≤æ‡≤¶‡≤®‡≥Ü',
                    spoilage: '‡≤ï‡≥Ü‡≤°‡≥Å‡≤µ‡≤ø‡≤ï‡≥Ü',
                    defects: '‡≤¶‡≥ã‡≤∑‡≤ó‡≤≥‡≥Å',
                    delays: '‡≤µ‡≤ø‡≤≥‡≤Ç‡≤¨‡≤ó‡≤≥‡≥Å',
                    waste: '‡≤ï‡≤∏',
                    pestRisk: '‡≤ï‡≥Ä‡≤ü ‡≤Ö‡≤™‡≤æ‡≤Ø',
                    machineryUptime: '‡≤Ø‡≤Ç‡≤§‡≥ç‡≤∞‡≥ã‡≤™‡≤ï‡≤∞‡≤£ ‡≤Ö‡≤™‡≥ç‡≤ü‡≥à‡≤Æ‡≥ç',
                    harvestUptime: '‡≤ï‡≥ä‡≤Ø‡≥ç‡≤≤‡≥Å ‡≤Ö‡≤™‡≥ç‡≤ü‡≥à‡≤Æ‡≥ç',
                    carbonFootprint: '‡≤ï‡≤æ‡≤∞‡≥ç‡≤¨‡≤®‡≥ç ‡≤´‡≥Å‡≤ü‡≥ç‡≤™‡≥ç‡≤∞‡≤ø‡≤Ç‡≤ü‡≥ç',
                    productionCarbon: '‡≤â‡≤§‡≥ç‡≤™‡≤æ‡≤¶‡≤®‡≥Ü ‡≤ï‡≤æ‡≤∞‡≥ç‡≤¨‡≤®‡≥ç',
                    storageCarbon: '‡≤∏‡≤Ç‡≤ó‡≥ç‡≤∞‡≤π‡≤£‡≥Ü ‡≤ï‡≤æ‡≤∞‡≥ç‡≤¨‡≤®‡≥ç',
                    processingCarbon: '‡≤∏‡≤Ç‡≤∏‡≥ç‡≤ï‡≤∞‡≤£‡≥Ü ‡≤ï‡≤æ‡≤∞‡≥ç‡≤¨‡≤®‡≥ç',
                    transportationCarbon: '‡≤∏‡≤æ‡≤∞‡≤ø‡≤ó‡≥Ü ‡≤ï‡≤æ‡≤∞‡≥ç‡≤¨‡≤®‡≥ç',
                    wasteCarbon: '‡≤ï‡≤∏ ‡≤ï‡≤æ‡≤∞‡≥ç‡≤¨‡≤®‡≥ç',
                    totalProduction: '‡≤í‡≤ü‡≥ç‡≤ü‡≥Å ‡≤â‡≤§‡≥ç‡≤™‡≤æ‡≤¶‡≤®‡≥Ü',
                    avgDefectRate: '‡≤∏‡≤∞‡≤æ‡≤∏‡≤∞‡≤ø ‡≤¶‡≥ã‡≤∑ ‡≤¶‡≤∞',
                    avgSpoilage: '‡≤∏‡≤∞‡≤æ‡≤∏‡≤∞‡≤ø ‡≤ï‡≥Ü‡≤°‡≥Å‡≤µ‡≤ø‡≤ï‡≥Ü',
                    performanceScore: '‡≤™‡≥ç‡≤∞‡≤¶‡≤∞‡≥ç‡≤∂‡≤® ‡≤∏‡≥ç‡≤ï‡≥ã‡≤∞‡≥ç'
                },
                status: {
                    excellent: '‡≤Ö‡≤§‡≥ç‡≤Ø‡≥Å‡≤§‡≥ç‡≤§‡≤Æ',
                    good: '‡≤í‡≤≥‡≥ç‡≤≥‡≥Ü‡≤Ø‡≤¶‡≥Å',
                    average: '‡≤∏‡≤∞‡≤æ‡≤∏‡≤∞‡≤ø',
                    poor: '‡≤ï‡≤≥‡≤™‡≥Ü'
                },
                units: {
                    tonnesPerHa: '‡≤ü‡≤®‡≥ç/‡≤π‡≥Ü',
                    percent: '%',
                    per10: '/10',
                    kgCO2e: '‡≤ï‡≥Ü‡≤ú‡≤ø CO2e'
                },
                ai: {
                    insights: 'AI ‡≤í‡≤≥‡≤®‡≥ã‡≤ü‡≤ó‡≤≥‡≥Å',
                    analysis: 'AI ‡≤µ‡≤ø‡≤∂‡≥ç‡≤≤‡≥á‡≤∑‡≤£‡≥Ü',
                    comparison: 'AI ‡≤π‡≥ã‡≤≤‡≤ø‡≤ï‡≥Ü',
                    recommendations: '‡≤∂‡≤ø‡≤´‡≤æ‡≤∞‡≤∏‡≥Å‡≤ó‡≤≥‡≥Å',
                    allMetricsOptimal: '‡≤é‡≤≤‡≥ç‡≤≤‡≤æ ‡≤Æ‡≥Ü‡≤ü‡≥ç‡≤∞‡≤ø‡≤ï‡≥ç‡≤∏‡≥ç ‡≤∏‡≥Ç‡≤ï‡≥ç‡≤§ ‡≤µ‡≥ç‡≤Ø‡≤æ‡≤™‡≥ç‡≤§‡≤ø‡≤Ø‡≤≤‡≥ç‡≤≤‡≤ø‡≤µ‡≥Ü',
                    allFarmsPerforming: '‡≤é‡≤≤‡≥ç‡≤≤‡≤æ ‡≤´‡≤æ‡≤∞‡≥ç‡≤Æ‡≥ç‡≤ó‡≤≥‡≥Å ‡≤ö‡≥Ü‡≤®‡≥ç‡≤®‡≤æ‡≤ó‡≤ø ‡≤ï‡≤æ‡≤∞‡≥ç‡≤Ø‡≤®‡≤ø‡≤∞‡≥ç‡≤µ‡≤π‡≤ø‡≤∏‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤µ‡≥Ü'
                },
                report: {
                    downloadReport: '‡≤µ‡≤ø‡≤µ‡≤∞‡≤µ‡≤æ‡≤¶ ‡≤µ‡≤ø‡≤∂‡≥ç‡≤≤‡≥á‡≤∑‡≤£‡≥Ü ‡≤µ‡≤∞‡≤¶‡≤ø‡≤Ø‡≤®‡≥ç‡≤®‡≥Å ‡≤°‡≥å‡≤®‡≥ç‡≤≤‡≥ã‡≤°‡≥ç ‡≤Æ‡≤æ‡≤°‡≤ø',
                    selectLanguage: '‡≤µ‡≤∞‡≤¶‡≤ø‡≤ó‡≤æ‡≤ó‡≤ø ‡≤≠‡≤æ‡≤∑‡≥Ü‡≤Ø‡≤®‡≥ç‡≤®‡≥Å ‡≤Ü‡≤Ø‡≥ç‡≤ï‡≥Ü‡≤Æ‡≤æ‡≤°‡≤ø',
                    generating: '‡≤µ‡≤∞‡≤¶‡≤ø ‡≤∞‡≤ö‡≤ø‡≤∏‡≤≤‡≤æ‡≤ó‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤¶‡≥Ü...',
                    download: '‡≤°‡≥å‡≤®‡≥ç‡≤≤‡≥ã‡≤°‡≥ç',
                    cancel: '‡≤∞‡≤¶‡≥ç‡≤¶‡≥Å‡≤Æ‡≤æ‡≤°‡≤ø'
                }
            }
        };
        
        // Helper function to get translation
        function t(key) {
            const keys = key.split('.');
            let value = translations[currentLanguage];
            for (const k of keys) {
                value = value?.[k];
            }
            return value || key;
        }
        
        function translatePage() {
            const lang = translations[currentLanguage];
            if (!lang) return;
            
            // Translate elements with data-translate attribute
            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                const keys = key.split('.');
                let value = lang;
                for (const k of keys) {
                    value = value?.[k];
                }
                if (value) {
                    if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                        element.placeholder = value;
                    } else {
                        element.innerText = value;
                    }
                }
            });
            
            // Update language button
            const langNames = { en: 'English', hi: '‡§π‡§ø‡§Ç‡§¶‡•Ä', kn: '‡≤ï‡≤®‡≥ç‡≤®‡≤°' };
            const currentLangEl = document.getElementById('current-language');
            if (currentLangEl) {
                currentLangEl.textContent = langNames[currentLanguage] || 'English';
            }
            
            // Update language dropdown active state
            document.querySelectorAll('.language-option').forEach(opt => {
                opt.classList.remove('active');
                if (opt.getAttribute('data-lang') === currentLanguage) {
                    opt.classList.add('active');
                }
            });
            
            // Re-translate dynamically generated content if farm is selected
            if (currentFarm && currentFarm !== 'all') {
                loadFarmData(currentFarm);
            } else if (currentFarm === 'all') {
                loadOverviewData();
            }
        }
        
        function toggleLanguageDropdown() {
            const dropdown = document.getElementById('language-dropdown');
            if (dropdown) {
                dropdown.classList.toggle('show');
            }
        }
        
        function changeLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('appLanguage', lang);
            translatePage();
            toggleLanguageDropdown();
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function closeDropdown(e) {
                const dropdown = document.getElementById('language-dropdown');
                const btn = document.getElementById('language-btn');
                if (dropdown && btn && !dropdown.contains(e.target) && !btn.contains(e.target)) {
                    dropdown.classList.remove('show');
                    document.removeEventListener('click', closeDropdown);
                }
            });
        }
        
        // Initialize translation on page load
        document.addEventListener('DOMContentLoaded', () => {
            translatePage();
        });
        
        let currentFarm = 'all';
        const charts = {};
        
        // Load AI insights from backend
        async function loadAIInsights(section) {
            try {
                const response = await fetch(`/api/ai-insights/${currentFarm}/${section}`);
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error loading AI insights:', error);
                return { insights: ['Unable to load AI insights'], recommendations: [] };
            }
        }

        function switchFarm(farmName, eventElement) {
            currentFarm = farmName;
            document.querySelectorAll('.farm-tab').forEach(tab => tab.classList.remove('active'));
            if (eventElement) {
                eventElement.classList.add('active');
            } else {
                // Find the tab by text content
                document.querySelectorAll('.farm-tab').forEach(tab => {
                    if (farmName === 'all' && tab.textContent.trim() === 'All Farms') {
                        tab.classList.add('active');
                    } else if (farmName === 'FarmA' && tab.textContent.trim() === 'Farm A') {
                        tab.classList.add('active');
                    } else if (farmName === 'FarmB' && tab.textContent.trim() === 'Farm B') {
                        tab.classList.add('active');
                    } else if (farmName === 'FarmC' && tab.textContent.trim() === 'Farm C') {
                        tab.classList.add('active');
                    } else if (farmName === 'FarmD' && tab.textContent.trim() === 'Farm D') {
                        tab.classList.add('active');
                    }
                });
            }
            
            // Get current active section
            const activeSection = document.querySelector('.section.active');
            const sectionId = activeSection ? activeSection.id : 'overview';
            
            // Show overview section and reload data based on filter
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            document.querySelectorAll('.sidebar-item').forEach(s => s.classList.remove('active'));
            
            // Set active sidebar item using data-section attribute for reliable matching
            const sidebarItem = document.querySelector(`.sidebar-item[data-section="${sectionId}"]`);
            if (sidebarItem) {
                sidebarItem.classList.add('active');
            }
            
            // Handle Overview AI Insights box visibility
            const overviewSuggestionBox = document.getElementById('overviewSuggestion');
            if (overviewSuggestionBox) {
                if (sectionId !== 'overview') {
                    // Hide for non-overview sections
                    overviewSuggestionBox.style.setProperty('display', 'none', 'important');
                    overviewSuggestionBox.innerHTML = '';
                }
                // For overview section, visibility will be handled in loadOverviewData/loadFarmData
            }
            
            // Remove any farm-specific AI analysis boxes when switching farms in Overview
            if (sectionId === 'overview') {
                const farmAnalysisBox = document.getElementById('overviewFarmAnalysis');
                if (farmAnalysisBox) {
                    farmAnalysisBox.remove();
                }
            }
            
            // Reload data for the current section with new farm filter
            if (sectionId === 'overview') {
                if (farmName === 'all') {
                    loadOverviewData();
                } else {
                    loadFarmData(farmName);
                }
            } else {
                // Reload the current section with the new farm selection
                showSection(sectionId);
            }
        }

        function showSection(sectionId, event) {
            // Remove active class from all sections and sidebar items
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.sidebar-item').forEach(s => s.classList.remove('active'));
            
            // Toggle security-active class on body to prevent page scrolling
            if (sectionId === 'security') {
                document.body.classList.add('security-active');
            } else {
                document.body.classList.remove('security-active');
            }
            
            // Activate the selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Set active sidebar item using data-section attribute for reliable matching
            const sidebarItem = document.querySelector(`.sidebar-item[data-section="${sectionId}"]`);
            if (sidebarItem) {
                sidebarItem.classList.add('active');
            }
            // If Price tab selected, load forecast
            if (sectionId === 'price') {
                // Default crop is 'wheat' for now; could add crop selector later
                loadPricePrediction('wheat');
            }

            // Handle Overview AI Insights box visibility
            const overviewSuggestionBox = document.getElementById('overviewSuggestion');
            if (overviewSuggestionBox) {
                if (sectionId !== 'overview') {
                    // Hide for non-overview sections
                    overviewSuggestionBox.style.setProperty('display', 'none', 'important');
                    overviewSuggestionBox.innerHTML = '';
                }
                // For overview section, visibility will be handled in loadOverviewData/loadFarmData
            }
            
            // Remove any farm-specific AI analysis boxes when switching away from overview
            if (sectionId !== 'overview') {
                const farmAnalysisBox = document.getElementById('overviewFarmAnalysis');
                if (farmAnalysisBox) {
                    farmAnalysisBox.remove();
                }
            }

            // Load appropriate data based on current farm selection
            if (currentFarm === 'all') {
                if (sectionId === 'overview') {
                    loadOverviewData();
                } else if (sectionId === 'production') {
                    loadComparisonProduction();
                } else if (sectionId === 'storage') {
                    loadComparisonStorage();
                } else if (sectionId === 'processing') {
                    loadComparisonProcessing();
                } else if (sectionId === 'transportation') {
                    loadComparisonTransportation();
                } else if (sectionId === 'retail') {
                    loadComparisonRetail();
                } else if (sectionId === 'consumption') {
                    loadComparisonConsumption();
                } else if (sectionId === 'waste') {
                    loadComparisonWaste();
                } else if (sectionId === 'recommendation') {
                    loadCropRecommendations();
                } else if (sectionId === 'security') {
                    // Security section doesn't need farm data loading
                    initializeSecuritySection();
                }
            } else {
                if (sectionId === 'overview') {
                    loadFarmData(currentFarm);
                } else if (sectionId === 'production') {
                    loadProductionData();
                } else if (sectionId === 'storage') {
                    loadStorageData();
                } else if (sectionId === 'processing') {
                    loadProcessingData();
                } else if (sectionId === 'transportation') {
                    loadTransportationData();
                } else if (sectionId === 'retail') {
                    loadRetailData();
                } else if (sectionId === 'waste') {
                    loadWasteData();
                } else if (sectionId === 'recommendation') {
                    loadCropRecommendations();
                } else if (sectionId === 'security') {
                    // Security section doesn't need farm data loading
                    initializeSecuritySection();
                }
            }
        }

        // ESPCam stream management
        let espcamStreamInterval = null;
        let isESPCamConnected = false;
        let isConnecting = false;

        function updateConnectionButtons() {
            const connectBtn = document.getElementById('espcam-connect-btn');
            const disconnectBtn = document.getElementById('espcam-disconnect-btn');
            
            if (connectBtn && disconnectBtn) {
                if (isESPCamConnected) {
                    // Connected state - green button, disabled
                    connectBtn.disabled = true;
                    connectBtn.style.background = '#27ae60';
                    connectBtn.style.opacity = '1';
                    connectBtn.style.cursor = 'not-allowed';
                    connectBtn.style.pointerEvents = 'none';
                    connectBtn.textContent = 'Connected';
                    disconnectBtn.disabled = false;
                    disconnectBtn.style.opacity = '1';
                    disconnectBtn.style.cursor = 'pointer';
                    disconnectBtn.style.pointerEvents = 'auto';
                } else if (isConnecting) {
                    // Connecting state - disabled, showing connecting
                    connectBtn.disabled = true;
                    connectBtn.style.background = '#1a5f7a';
                    connectBtn.style.opacity = '0.7';
                    connectBtn.style.cursor = 'not-allowed';
                    connectBtn.style.pointerEvents = 'none';
                    connectBtn.textContent = 'Connecting...';
                    disconnectBtn.disabled = false;
                    disconnectBtn.style.opacity = '1';
                    disconnectBtn.style.cursor = 'pointer';
                    disconnectBtn.style.pointerEvents = 'auto';
                } else {
                    // Disconnected state - enable connect button
                    connectBtn.disabled = false;
                    connectBtn.style.background = '#1a5f7a';
                    connectBtn.style.opacity = '1';
                    connectBtn.style.cursor = 'pointer';
                    connectBtn.style.pointerEvents = 'auto';
                    connectBtn.textContent = 'Connect';
                    disconnectBtn.disabled = true;
                    disconnectBtn.style.opacity = '0.6';
                    disconnectBtn.style.cursor = 'not-allowed';
                    disconnectBtn.style.pointerEvents = 'none';
                }
            }
        }

        // Notification system
        let notifications = [];
        
        function formatTimestamp(date) {
            const now = new Date(date);
            const dateStr = now.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
            const timeStr = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit',
                hour12: true 
            });
            return `${dateStr} ${timeStr}`;
        }
        
        function addNotification(type, message) {
            const notification = {
                id: Date.now(),
                type: type, // 'motion', 'infrared', 'system'
                message: message,
                timestamp: new Date()
            };
            
            notifications.unshift(notification); // Add to beginning
            
            // Keep only last 50 notifications
            if (notifications.length > 50) {
                notifications = notifications.slice(0, 50);
            }
            
            renderNotifications();
        }
        
        function renderNotifications() {
            const listContainer = document.getElementById('notifications-list');
            if (!listContainer) return;
            
            // Filter to show only motion alerts
            const motionNotifications = notifications.filter(n => n.type === 'motion');
            
            if (motionNotifications.length === 0) {
                listContainer.innerHTML = `
                    <div class="notification-empty">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="width: 48px; height: 48px; margin: 0 auto 10px; opacity: 0.3;">
                            <path d="M12 2C8.13 2 5 5.13 5 9C5 14.25 12 22 12 22C12 22 19 14.25 19 9C19 5.13 15.87 2 12 2ZM12 11.5C10.62 11.5 9.5 10.38 9.5 9C9.5 7.62 10.62 6.5 12 6.5C13.38 6.5 14.5 7.62 14.5 9C14.5 10.38 13.38 11.5 12 11.5Z" fill="#95a5a6"/>
                        </svg>
                        <p>No motion alerts yet</p>
                        <p style="font-size: 12px;">Motion alerts will appear here when detected</p>
                    </div>
                `;
                return;
            }
            
            listContainer.innerHTML = motionNotifications.map(notif => {
                // Determine notification type based on message
                const isPerson = notif.message.toLowerCase().includes('person');
                const isAnimal = !isPerson && (notif.message.toLowerCase().includes('elephant') || 
                              notif.message.toLowerCase().includes('bear') ||
                              notif.message.toLowerCase().includes('cow') ||
                              notif.message.toLowerCase().includes('horse') ||
                              notif.message.toLowerCase().includes('sheep') ||
                              notif.message.toLowerCase().includes('dog') ||
                              notif.message.toLowerCase().includes('cat') ||
                              notif.message.toLowerCase().includes('bird') ||
                              notif.message.toLowerCase().includes('zebra') ||
                              notif.message.toLowerCase().includes('giraffe'));
                
                const notificationType = isPerson ? 'Person Detected' : (isAnimal ? 'Animal Detected' : 'Motion Detected');
                
                return `
                    <div class="notification-item motion" onclick="removeNotification(${notif.id})">
                        <div class="notification-header">
                            <span class="notification-type">${notificationType}</span>
                            <span class="notification-time">${formatTimestamp(notif.timestamp)}</span>
                        </div>
                        <div class="notification-message">${notif.message}</div>
                    </div>
                `;
            }).join('');
        }
        
        function removeNotification(id) {
            notifications = notifications.filter(n => n.id !== id);
            renderNotifications();
        }
        
        function loadDemoNotifications() {
            // Clear existing notifications - don't load demo data
            notifications = [];
            renderNotifications();
        }
        
        // Poll for real detections
        let detectionPollInterval = null;
        let lastDetectionTime = null;
        let lastDetectedObjects = new Set();
        
        function startDetectionPolling() {
            if (detectionPollInterval) {
                clearInterval(detectionPollInterval);
            }
            
            // Reset tracking when starting
            lastDetectionTime = null;
            lastDetectedObjects = new Set();
            
            detectionPollInterval = setInterval(async () => {
                try {
                    const response = await fetch('/api/security/stats');
                    if (!response.ok) return;
                    
                    const stats = await response.json();
                    
                    // Check for new detections
                    if (stats.last_detection && stats.last_detection !== "None" && stats.last_detection_time) {
                        const detectionTime = new Date(stats.last_detection_time);
                        const detectedObjects = stats.detected_objects || [];
                        const currentObjectsSet = new Set(detectedObjects);
                        
                        // Only add if this is a new detection (not already shown)
                        if (!lastDetectionTime || detectionTime > lastDetectionTime) {
                            // Check for new objects that weren't in the last detection
                            const newObjects = detectedObjects.filter(obj => !lastDetectedObjects.has(obj));
                            
                            if (newObjects.length > 0) {
                                lastDetectionTime = detectionTime;
                                lastDetectedObjects = currentObjectsSet;
                                
                                // Create alert for each newly detected object
                                newObjects.forEach(obj => {
                                    const objName = obj.charAt(0).toUpperCase() + obj.slice(1);
                                    const message = `${objName} detected in camera view`;
                                    addNotification('motion', message);
                                });
                            } else {
                                // Update the set even if no new objects (to track current state)
                                lastDetectedObjects = currentObjectsSet;
                            }
                        }
                    }
                } catch (error) {
                    console.error('Error polling detection stats:', error);
                }
            }, 2000); // Poll every 2 seconds
        }
        
        function stopDetectionPolling() {
            if (detectionPollInterval) {
                clearInterval(detectionPollInterval);
                detectionPollInterval = null;
            }
        }
        
        // Function to be called by sensors in the future
        function triggerSecurityAlert(type, message) {
            addNotification(type, message);
        }

        function initializeSecuritySection() {
            // Load saved ESPCam configuration from localStorage if available
            const savedIP = localStorage.getItem('espcam_ip');
            const savedPort = localStorage.getItem('espcam_port');
            if (savedIP) {
                document.getElementById('espcam-ip').value = savedIP;
            }
            if (savedPort) {
                document.getElementById('espcam-port').value = savedPort;
            }
            // Update button states on initialization
            updateConnectionButtons();
            // Clear notifications (no demo data)
            loadDemoNotifications();
        }

        function connectESPCam() {
            // Check if already connected or connecting
            if (isESPCamConnected) {
                return; // Already connected, do nothing
            }
            
            if (isConnecting) {
                return; // Connection in progress, do nothing
            }

            const ip = document.getElementById('espcam-ip').value.trim();
            const port = document.getElementById('espcam-port').value.trim() || '81';
            const statusDiv = document.getElementById('espcam-status');
            const streamIframe = document.getElementById('espcam-stream');
            const streamImg = document.getElementById('espcam-stream-img');

            if (!ip) {
                alert('Please enter ESP32 camera IP address');
                return;
            }

            // Validate IP address format (basic validation)
            const ipPattern = /^(\d{1,3}\.){3}\d{1,3}$/;
            if (!ipPattern.test(ip)) {
                alert('Please enter a valid IP address');
                return;
            }

            // Set connecting state and update buttons
            isConnecting = true;
            updateConnectionButtons();

            // Save configuration to localStorage
            localStorage.setItem('espcam_ip', ip);
            localStorage.setItem('espcam_port', port);

            // Hide status and show loading
            statusDiv.style.display = 'block';
            statusDiv.innerHTML = `
                <p style="font-size: 18px; margin-bottom: 10px;">üîÑ Connecting...</p>
                <p style="font-size: 14px; color: #95a5a6;">Starting detection system...</p>
            `;
            streamIframe.style.display = 'none';
            streamImg.style.display = 'none';
            
            // Start detection on backend
            fetch('/api/security/start_detection', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ ip: ip, port: port })
            }).then(response => response.json())
            .then(data => {
                if (data.error) {
                    statusDiv.innerHTML = `
                        <p style="font-size: 18px; margin-bottom: 10px;">‚ùå Error</p>
                        <p style="font-size: 14px; color: #e74c3c;">${data.error}</p>
                    `;
                    isConnecting = false;
                    updateConnectionButtons();
                    return;
                }
                
                // Use detection video feed
                streamImg.src = '/api/security/video_feed';
                streamImg.style.display = 'block';
                streamIframe.style.display = 'none';
                statusDiv.style.display = 'none';
                isESPCamConnected = true;
                isConnecting = false;
                updateConnectionButtons();
                
                // Start polling for detections
                startDetectionPolling();
            }).catch(error => {
                console.error('Error starting detection:', error);
                statusDiv.innerHTML = `
                    <p style="font-size: 18px; margin-bottom: 10px;">‚ùå Connection Failed</p>
                    <p style="font-size: 14px; color: #e74c3c;">Failed to start detection system</p>
                `;
                isConnecting = false;
                updateConnectionButtons();
            });
            
        }

        function disconnectESPCam() {
            const statusDiv = document.getElementById('espcam-status');
            const streamIframe = document.getElementById('espcam-stream');
            const streamImg = document.getElementById('espcam-stream-img');
            
            // Stop detection on backend
            fetch('/api/security/stop_detection', {
                method: 'POST'
            }).catch(error => {
                console.error('Error stopping detection:', error);
            });
            
            // Stop polling for detections
            stopDetectionPolling();
            
            streamIframe.src = '';
            streamImg.src = '';
            streamIframe.style.display = 'none';
            streamImg.style.display = 'none';
            streamIframe.removeAttribute('style');
            streamImg.removeAttribute('style');
            statusDiv.style.display = 'block';
            statusDiv.innerHTML = `
                <p style="font-size: 24px; margin-bottom: 12px;">üìπ Camera Feed</p>
                <p style="font-size: 16px; color: #7f8c8d;">Configure and connect to view live feed with detection</p>
            `;
            isESPCamConnected = false;
            isConnecting = false;

            if (espcamStreamInterval) {
                clearInterval(espcamStreamInterval);
                espcamStreamInterval = null;
            }
            
            // Reset detection tracking
            lastDetectionTime = null;
            lastDetectedObjects = new Set();
            
            // Update button states after disconnecting
            updateConnectionButtons();
        }

        function getSectionEmoji(sectionId) {
            const emojis = {
                'overview': 'üìä',
                'production': 'üå±',
                'storage': '‚ùÑÔ∏è',
                'processing': '‚öôÔ∏è',
                'transportation': 'üöö',
                'retail': 'üè™',
                'consumption': 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶',
                'waste': '‚ôªÔ∏è',
                'security': 'üîí'
            };
            return emojis[sectionId] || '';
        }

        function createKPICard(label, value, unit, type = '', aiTip = '') {
            const typeClass = type ? ` ${type}` : '';
            // Truncate AI tip to one line if too long
            const shortTip = aiTip && aiTip.length > 60 ? aiTip.substring(0, 57) + '...' : aiTip;
            return `<div class="kpi-card${typeClass}"><div class="kpi-label">‚ú® ${label}</div><div class="kpi-value">${parseFloat(value).toFixed(2)}</div><div class="kpi-unit">${unit}</div>${shortTip ? `<div class="ai-insight">üí° ${shortTip}</div>` : ''}</div>`;
        }

        function createAISuggestion(title, insightsArray, recommendationsArray = [], sideBySide = false) {
            let insightsContent = '';
            let recommendationsContent = '';
            
            // Format insights as separate items
            if (Array.isArray(insightsArray) && insightsArray.length > 0) {
                insightsContent = insightsArray.map(insight => `<div class="ai-insight-item">${insight}</div>`).join('');
            } else if (typeof insightsArray === 'string') {
                // Handle string format (backward compatibility)
                if (insightsArray.includes('<br>')) {
                    insightsContent = `<p>${insightsArray}</p>`;
                } else {
                    const items = insightsArray.split(' | ').filter(item => item.trim());
                    insightsContent = items.map(item => `<div class="ai-insight-item">${item.trim()}</div>`).join('');
                }
            }
            
            // Format recommendations
            if (Array.isArray(recommendationsArray) && recommendationsArray.length > 0) {
                recommendationsContent = recommendationsArray.map(rec => `<div class="ai-insight-item" style="margin-left: 8px;">‚Ä¢ ${rec}</div>`).join('');
            }
            
            const aiIcon = getIcon('ai', 'lg');
            const sideBySideClass = sideBySide ? ' side-by-side' : '';
            
            if (sideBySide && recommendationsContent) {
                // Side-by-side layout for comparison views
                return `<div class="icon">${aiIcon}</div><div class="content"><h4>${title}</h4><div class="sections-grid"><div class="insights-section"><h5>Insights:</h5><div>${insightsContent}</div></div><div class="recommendations-section"><h5>Recommendations:</h5><div>${recommendationsContent}</div></div></div></div>`;
            } else {
                // Stacked layout for farm-specific views
                let content = insightsContent;
                if (recommendationsContent) {
                    content += '<div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.2);"><strong>Recommendations:</strong><br>';
                    content += recommendationsContent;
                    content += '</div>';
                }
                return `<div class="icon">${aiIcon}</div><div class="content"><h4>${title}</h4><div>${content}</div></div>`;
            }
        }

        function getPerformanceClass(score) {
            if (score >= 80) return 'excellent';
            if (score >= 65) return 'good';
            if (score >= 50) return 'average';
            return 'poor';
        }

        function getStatusText(score) {
            if (score >= 80) return t('status.excellent');
            if (score >= 65) return t('status.good');
            if (score >= 50) return t('status.average');
            return t('status.poor');
        }

        function loadOverviewData() {
            // Hide download button when viewing all farms
            const downloadSection = document.getElementById('overview-download-section');
            if (downloadSection) {
                downloadSection.style.display = 'none';
            }
            
            // Only show AI Insights in Overview when viewing "All Farms"
            if (currentFarm !== 'all') {
                const mainAIBox = document.getElementById('overviewSuggestion');
                if (mainAIBox) {
                    mainAIBox.style.display = 'none';
                }
                return;
            }
            
            fetch('/api/overview').then(r => r.json()).then(data => {
                const farms = Object.keys(data);
                let html = '';
                
                const farmIcon = getIcon('farm', 'lg');
                const yieldIcon = getIcon('yield', 'sm');
                const spoilageIcon = getIcon('spoilage', 'sm');
                const defectsIcon = getIcon('defects', 'sm');
                const transportationIcon = getIcon('transportation', 'sm');
                const wasteIcon = getIcon('waste_icon', 'sm');
               
                farms.forEach(farm => {
                    const farmData = data[farm];
                    const perfClass = getPerformanceClass(farmData.performance_score);
                    const statusClass = getPerformanceClass(farmData.performance_score);
                    
                    html += `
                        <div class="farm-card ${perfClass}">
                            <div class="farm-card-header">
                                <h3>${farmIcon} ${farm}</h3>
                                <div class="performance-score-container">
                                    <span class="performance-score">${farmData.performance_score.toFixed(0)}</span>
                                    <span class="performance-score-label">/100</span>
                                </div>
                                <span class="status-badge ${statusClass}">${getStatusText(farmData.performance_score)}</span>
                            </div>
                            <div class="farm-card-body">
                                <div class="metric-row">
                                    <span class="metric-label">${yieldIcon} ${t('metrics.yield')}</span>
                                    <span class="metric-value">${farmData.yield.toFixed(2)} ${t('units.tonnesPerHa')}</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">${spoilageIcon} ${t('metrics.spoilage')}</span>
                                    <span class="metric-value">${farmData.spoilage.toFixed(2)}${t('units.percent')}</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">${defectsIcon} ${t('metrics.defects')}</span>
                                    <span class="metric-value">${farmData.defects.toFixed(2)}${t('units.percent')}</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">${transportationIcon} ${t('metrics.delays')}</span>
                                    <span class="metric-value">${farmData.delays.toFixed(1)}${t('units.percent')}</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">${wasteIcon} ${t('metrics.waste')}</span>
                                    <span class="metric-value">${farmData.waste.toFixed(2)}${t('units.percent')}</span>
                                </div>
                                <div class="metric-row" style="border-top: 2px solid #ecf0f1; padding-top: 10px; margin-top: 10px;">
                                    <span class="metric-label">üå± ${t('metrics.carbonFootprint')}</span>
                                    <span class="metric-value" style="color: #27ae60; font-weight: bold;">${farmData.carbon_footprint ? farmData.carbon_footprint.total.toFixed(2) : '0.00'} ${t('units.kgCO2e')}</span>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                const container = document.getElementById('farm-comparison-container');
                container.className = 'farm-comparison';
                container.innerHTML = html;
                
                // Show comparison charts when viewing all farms
                document.querySelectorAll('#overviewChart1, #overviewChart2, #overviewChart3, #overviewChart4').forEach(chart => {
                    chart.closest('.chart-container').style.display = 'block';
                });
                
                // Remove any inline AI boxes that might be leftover from farm-specific views
                const inlineBox = document.getElementById('overviewSuggestionInline');
                if (inlineBox) {
                    inlineBox.remove();
                }
                
                // Remove any farm-specific AI analysis boxes from individual farm views
                const farmAnalysisBox = document.getElementById('overviewFarmAnalysis');
                if (farmAnalysisBox) {
                    farmAnalysisBox.remove();
                }
                
                // Show the main AI suggestion box ONLY when viewing all farms in Overview section
                const mainAIBox = document.getElementById('overviewSuggestion');
                if (mainAIBox) {
                    if (currentFarm === 'all') {
                        // Force show the box using setProperty with important flag to override CSS
                        mainAIBox.style.setProperty('display', 'flex', 'important');
                        mainAIBox.innerHTML = ''; // Clear any previous content
                        
                        // Load smart AI insights
                        loadAIInsights('overview').then(aiData => {
                            const insights = aiData.insights && aiData.insights.length > 0 ? aiData.insights : [t('ai.allMetricsOptimal')];
                            const recommendations = aiData.recommendations || [];
                            mainAIBox.innerHTML = createAISuggestion(t('ai.insights'), insights, recommendations);
                        }).catch(err => {
                            console.error('Error loading AI insights:', err);
                            mainAIBox.innerHTML = createAISuggestion(t('ai.insights'), [t('ai.allMetricsOptimal')], []);
                        });
                    } else {
                        // Hide for individual farms
                        mainAIBox.style.setProperty('display', 'none', 'important');
                        mainAIBox.innerHTML = '';
                    }
                }
                
                loadOverviewCharts(data);
            }).catch(err => {
                console.error('Error loading overview:', err);
                document.getElementById('farm-comparison-container').innerHTML = '<p>Error loading farm data. Please ensure all farm CSV files are present.</p>';
            });
        }

        function loadOverviewCharts(data) {
            const farms = Object.keys(data);
            
            // Yield Comparison
                const ctx1 = document.getElementById('overviewChart1').getContext('2d');
                if (charts.overviewChart1) charts.overviewChart1.destroy();
                charts.overviewChart1 = new Chart(ctx1, {
                    type: 'bar',
                    data: {
                    labels: farms,
                    datasets: [{
                        label: 'Average Yield (tonnes/ha)',
                        data: farms.map(f => data[f].yield),
                        backgroundColor: ['#27ae60', '#3498db', '#e74c3c', '#f39c12']
                    }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
            });

            // Spoilage Comparison
                const ctx2 = document.getElementById('overviewChart2').getContext('2d');
                if (charts.overviewChart2) charts.overviewChart2.destroy();
                charts.overviewChart2 = new Chart(ctx2, {
                    type: 'bar',
                    data: {
                    labels: farms,
                    datasets: [{
                        label: 'Spoilage Rate (%)',
                        data: farms.map(f => data[f].spoilage),
                        backgroundColor: ['#27ae60', '#3498db', '#e74c3c', '#f39c12']
                    }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
            });

            // Performance Score
                const ctx3 = document.getElementById('overviewChart3').getContext('2d');
                if (charts.overviewChart3) charts.overviewChart3.destroy();
                charts.overviewChart3 = new Chart(ctx3, {
                type: 'bar',
                    data: {
                    labels: farms,
                    datasets: [{
                        label: 'Performance Score',
                        data: farms.map(f => data[f].performance_score),
                        backgroundColor: farms.map(f => {
                            const score = data[f].performance_score;
                            if (score >= 80) return '#27ae60';
                            if (score >= 65) return '#3498db';
                            if (score >= 50) return '#f39c12';
                            return '#e74c3c';
                        })
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, max: 100 } } }
            });
            
            // Defect Rate Comparison
            const ctx4 = document.getElementById('overviewChart4').getContext('2d');
            if (charts.overviewChart4) charts.overviewChart4.destroy();
            charts.overviewChart4 = new Chart(ctx4, {
                type: 'bar',
                    data: {
                    labels: farms,
                    datasets: [{
                        label: 'Defect Rate (%)',
                        data: farms.map(f => data[f].defects),
                        backgroundColor: ['#27ae60', '#3498db', '#e74c3c', '#f39c12']
                    }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
        }

        function loadFarmData(farmName) {
            currentFarm = farmName;
            // Load KPIs for the selected farm and show in overview section
            Promise.all([
                fetch(`/api/farm/${currentFarm}/kpis`).then(r => r.json()),
                loadAIInsights('overview')
            ]).then(([data, aiData]) => {
                const score = calculatePerformanceScore(data);
                const perfClass = getPerformanceClass(score);
                
                // Update the overview section to show farm-specific data with AI Analysis
                const container = document.getElementById('farm-comparison-container');
                container.className = 'overview-single-farm-container';
                
                // Hide the main AI suggestion box when viewing single farm (force hide)
                const mainAIBox = document.getElementById('overviewSuggestion');
                if (mainAIBox) {
                    mainAIBox.style.setProperty('display', 'none', 'important');
                    mainAIBox.innerHTML = ''; // Clear content to prevent any visibility
                }
                
                const farmIcon = getIcon('farm', 'lg');
                const yieldIcon = getIcon('yield', 'sm');
                const spoilageIcon = getIcon('spoilage', 'sm');
                const defectsIcon = getIcon('defects', 'sm');
                const transportationIcon = getIcon('transportation', 'sm');
                const wasteIcon = getIcon('waste_icon', 'sm');
                const pestIcon = getIcon('pest', 'sm');
                const machineryIcon = getIcon('machinery', 'sm');
                
                const insights = aiData.insights && aiData.insights.length > 0 ? aiData.insights : [t('ai.allMetricsOptimal')];
                const recommendations = aiData.recommendations || [];
                const aiSuggestionHTML = createAISuggestion(t('ai.analysis'), insights, recommendations);
                
                // Create side-by-side layout: Farm card and AI Analysis box
                container.innerHTML = `
                    <div class="farm-stage-container">
                        <div class="farm-stage-cards">
                            <div class="farm-card ${perfClass}">
                                <div class="farm-card-header">
                                    <h3>${farmIcon} ${farmName}</h3>
                                    <div class="performance-score-container">
                                        <span class="performance-score">${score.toFixed(0)}</span>
                                        <span class="performance-score-label">/100</span>
                                    </div>
                                    <span class="status-badge ${perfClass}">${getStatusText(score)}</span>
                                </div>
                                <div class="farm-card-body">
                                    <div class="metric-row">
                                        <span class="metric-label">${yieldIcon} ${t('metrics.yield')}</span>
                                        <span class="metric-value">${data.total_production.toFixed(2)} ${t('units.tonnesPerHa')}</span>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">${spoilageIcon} ${t('metrics.spoilage')}</span>
                                        <span class="metric-value">${data.storage_spoilage.toFixed(2)}${t('units.percent')}</span>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">${defectsIcon} ${t('metrics.defects')}</span>
                                        <span class="metric-value">${data.processing_defects.toFixed(2)}${t('units.percent')}</span>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">${transportationIcon} ${t('metrics.delays')}</span>
                                        <span class="metric-value">${data.transport_delays.toFixed(1)}${t('units.percent')}</span>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">${wasteIcon} ${t('metrics.waste')}</span>
                                        <span class="metric-value">${data.waste_percentage.toFixed(2)}${t('units.percent')}</span>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">${pestIcon} ${t('metrics.pestRisk')}</span>
                                        <span class="metric-value">${data.pest_risk.toFixed(1)}</span>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">${machineryIcon} ${t('metrics.machineryUptime')}</span>
                                        <span class="metric-value">${data.machinery_uptime.toFixed(1)}${t('units.percent')}</span>
                                    </div>
                                    <div class="metric-row" style="border-top: 2px solid #ecf0f1; padding-top: 10px; margin-top: 10px;">
                                        <span class="metric-label">üå± ${t('metrics.carbonFootprint')}</span>
                                        <span class="metric-value" style="color: #27ae60; font-weight: bold;">${data.carbon_footprint ? data.carbon_footprint.total.toFixed(2) : '0.00'} ${t('units.kgCO2e')}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="ai-suggestion-box" id="overviewFarmAnalysis">${aiSuggestionHTML}</div>
                        </div>
                    </div>
                `;
                
                // Show download button for individual farms
                const downloadSection = document.getElementById('overview-download-section');
                if (downloadSection) {
                    downloadSection.style.display = 'block';
                }
                
                // Hide comparison charts when viewing single farm
                document.querySelectorAll('#overviewChart1, #overviewChart2, #overviewChart3, #overviewChart4').forEach(chart => {
                    chart.closest('.chart-container').style.display = 'none';
                });
            }).catch(err => {
                console.error('Error loading farm data:', err);
                document.getElementById('farm-comparison-container').innerHTML = '<p>Error loading farm data. Please ensure the farm CSV file exists.</p>';
            });
        }
        
        // Language selection modal for PDF download
        function showReportLanguageModal() {
            const modal = document.createElement('div');
            modal.id = 'report-language-modal';
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;';
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 12px; max-width: 400px; width: 90%; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
                    <h3 style="margin: 0 0 20px 0; color: #1a5f7a; text-align: center;">${t('report.selectLanguage')}</h3>
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <button onclick="downloadReport('en')" style="padding: 15px; background: #1a5f7a; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; transition: all 0.3s;">
                            üá¨üáß English
                        </button>
                        <button onclick="downloadReport('hi')" style="padding: 15px; background: #1a5f7a; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; transition: all 0.3s;">
                            üáÆüá≥ ‡§π‡§ø‡§Ç‡§¶‡•Ä (Hindi)
                        </button>
                        <button onclick="downloadReport('kn')" style="padding: 15px; background: #1a5f7a; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; transition: all 0.3s;">
                            üáÆüá≥ ‡≤ï‡≤®‡≥ç‡≤®‡≤° (Kannada)
                        </button>
                        <button onclick="closeReportModal()" style="padding: 12px; background: #e74c3c; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; margin-top: 10px;">
                            ${t('report.cancel')}
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function closeReportModal() {
            const modal = document.getElementById('report-language-modal');
            if (modal) modal.remove();
        }
        
        function downloadReport(lang) {
            closeReportModal();
            if (!currentFarm || currentFarm === 'all') {
                alert('Please select a specific farm to download the report.');
                return;
            }
            
            // Show loading state
            const btn = document.getElementById('download-report-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = `<span>‚è≥</span> ${t('report.generating')}`;
            btn.disabled = true;
            
            // Download the report
            const url = `/api/farm/${currentFarm}/report?lang=${lang}`;
            const link = document.createElement('a');
            link.href = url;
            link.download = `${currentFarm}_Report_${lang}.pdf`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Reset button after a delay
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }, 2000);
        }

        function calculatePerformanceScore(data) {
            // Performance score without satisfaction metric; rescaled to 0-100
            const rawScore = (
                (data.total_production / 10 * 20) +
                ((1 - data.storage_spoilage / 30) * 15) +
                ((1 - data.processing_defects / 15) * 15) +
                ((1 - data.transport_delays / 30) * 10) +
                ((1 - data.waste_percentage / 25) * 10) +
                ((1 - data.pest_risk / 100) * 10) +
                (data.machinery_uptime / 100 * 5)
            );
            // Remaining weights sum to 85; scale up to 100
            const scaledScore = rawScore * (100 / 85);
            return Math.min(100, Math.max(0, scaledScore));
        }

        async function loadComparisonProduction() {
            try {
                const [comparisonData, aiData] = await Promise.all([
                    fetch('/api/comparison/production').then(r => {
                        if (!r.ok) throw new Error(`HTTP error! status: ${r.status}`);
                        return r.json();
                    }),
                    loadAIInsights('production').catch(() => ({ insights: [], recommendations: [], farm_insights: {} }))
                ]);

                const farms = Object.keys(comparisonData);
                // Fetch carbon footprint for all farms
                const carbonFootprints = {};
                await Promise.all(farms.map(async (farm) => {
                    try {
                        const kpis = await fetch(`/api/farm/${farm}/kpis`).then(r => r.json());
                        carbonFootprints[farm] = kpis.carbon_footprint || { total: 0, fertilizer: 0 };
                    } catch (e) {
                        carbonFootprints[farm] = { total: 0, fertilizer: 0 };
                    }
                }));

                let html = '';
                const farmIcon = getIcon('farm', 'lg');
                const yieldIcon = getIcon('yield', 'sm');
                const pestIcon = getIcon('pest', 'sm');
                const machineryIcon = getIcon('machinery', 'sm');
                
                farms.forEach(farm => {
                    const data = comparisonData[farm];
                    if (!data) {
                        console.error(`No data for farm: ${farm}`);
                        return;
                    }
                    const yield_val = data.yield || 0;
                    const pest_risk = data.pest_risk || 0;
                    const harvest_uptime = data.harvest_uptime || 0;
                    const machinery_uptime = data.machinery_uptime || 0;
                    const perfScore = yield_val > 7 && pest_risk < 50 ? 80 : yield_val > 5 && pest_risk < 70 ? 65 : 50;
                    const perfClass = getPerformanceClass(perfScore);
                    const farmInsight = aiData.farm_insights && aiData.farm_insights[farm] ? aiData.farm_insights[farm] : '';
                    const carbonFootprint = carbonFootprints[farm] || { total: 0, fertilizer: 0 };
                    html += `
                        <div class="farm-card ${perfClass}">
                            <div class="farm-card-header">
                                <h3>${farmIcon} ${farm}</h3>
                                <div class="performance-score-container">
                                    <span class="performance-score">${perfScore.toFixed(0)}</span>
                                    <span class="performance-score-label">/100</span>
                                </div>
                                <span class="status-badge ${perfClass}">${getStatusText(perfScore)}</span>
                            </div>
                            <div class="farm-card-body">
                                <div class="metric-row">
                                    <span class="metric-label">${yieldIcon} Yield</span>
                                    <span class="metric-value">${yield_val.toFixed(2)} tonnes/ha</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">${pestIcon} Pest Risk</span>
                                    <span class="metric-value">${pest_risk.toFixed(2)}</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">${machineryIcon} Harvest Uptime</span>
                                    <span class="metric-value">${harvest_uptime.toFixed(2)}%</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">${machineryIcon} Machinery Uptime</span>
                                    <span class="metric-value">${machinery_uptime.toFixed(2)}%</span>
                                </div>
                                <div class="metric-row" style="border-top: 2px solid #ecf0f1; padding-top: 10px; margin-top: 10px;">
                                    <span class="metric-label">üå± Production Carbon</span>
                                    <span class="metric-value" style="color: #27ae60; font-weight: bold;">${carbonFootprint.fertilizer ? carbonFootprint.fertilizer.toFixed(2) : '0.00'} kg CO2e</span>
                                </div>
                                ${farmInsight ? `<div class="ai-insight">üí° ${farmInsight}</div>` : ''}
                            </div>
                        </div>
                `;
                });
                
                const insights = aiData.insights && aiData.insights.length > 0 ? aiData.insights : ['All farms performing well'];
                const recommendations = aiData.recommendations || [];
                const aiSuggestionHTML = createAISuggestion('AI Comparison', insights, recommendations, true);
                
                document.getElementById('production-container').innerHTML = `
                    <div class="farm-comparison">
                        ${html}
                    </div>
                    <div class="ai-suggestion-box side-by-side" id="productionSuggestion">${aiSuggestionHTML}</div>
                `;
                
                // Create comparison chart
                const ctx = document.getElementById('productionChart1').getContext('2d');
                if (charts.productionChart1) charts.productionChart1.destroy();
                const allCrops = new Set();
                farms.forEach(farm => {
                    if (comparisonData[farm] && comparisonData[farm].yield_by_crop) {
                        Object.keys(comparisonData[farm].yield_by_crop).forEach(crop => allCrops.add(crop));
                    }
                });
                const cropLabels = Array.from(allCrops);
                
                charts.productionChart1 = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: cropLabels,
                        datasets: farms.map((farm, idx) => ({
                            label: farm,
                            data: cropLabels.map(crop => (comparisonData[farm] && comparisonData[farm].yield_by_crop && comparisonData[farm].yield_by_crop[crop]) || 0),
                            backgroundColor: ['#27ae60', '#3498db', '#e74c3c', '#f39c12'][idx]
                        }))
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            } catch (err) {
                console.error('Error loading comparison data:', err);
                document.getElementById('production-container').innerHTML = `<p style="color: red; padding: 20px;">Error loading data: ${err.message}. Please check the console for details.</p>`;
            }
        }

        async function loadProductionData() {
            if (currentFarm === 'all') {
                loadComparisonProduction();
                return;
            }
            
            try {
                const [kpisData, productionData, aiData] = await Promise.all([
                    fetch(`/api/farm/${currentFarm}/kpis`).then(r => r.json()),
                    fetch(`/api/farm/${currentFarm}/production`).then(r => r.json()),
                    loadAIInsights('production')
                ]);
                const carbonFootprint = kpisData.carbon_footprint || { total: 0, fertilizer: 0 };

                const score = calculatePerformanceScore(kpisData);
                const perfClass = getPerformanceClass(score);
                const farmIcon = getIcon('farm', 'lg');
                const yieldIcon = getIcon('yield', 'sm');
                const pestIcon = getIcon('pest', 'sm');
                const machineryIcon = getIcon('machinery', 'sm');

                const insights = aiData.insights && aiData.insights.length > 0 ? aiData.insights : ['All metrics optimal'];
                const recommendations = aiData.recommendations || [];
                const aiSuggestionHTML = createAISuggestion('AI Analysis', insights, recommendations);

                // Create side-by-side layout: Farm card and AI box
                document.getElementById('production-container').innerHTML = `
                    <div class="farm-stage-container">
                        <div class="farm-stage-cards">
                            <div class="farm-card ${perfClass}">
                                <div class="farm-card-header">
                                    <h3>${farmIcon} ${currentFarm}</h3>
                                    <div class="performance-score-container">
                                        <span class="performance-score">${score.toFixed(0)}</span>
                                        <span class="performance-score-label">/100</span>
                                    </div>
                                    <span class="status-badge ${perfClass}">${getStatusText(score)}</span>
                                </div>
                                <div class="farm-card-body">
                                    <div class="metric-row">
                                        <span class="metric-label">${yieldIcon} Yield</span>
                                        <span class="metric-value">${kpisData.total_production.toFixed(2)} tonnes/ha</span>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">${pestIcon} Pest Risk</span>
                                        <span class="metric-value">${kpisData.pest_risk.toFixed(2)}</span>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">${yieldIcon} Harvest Uptime</span>
                                        <span class="metric-value">${kpisData.harvest_uptime.toFixed(2)}%</span>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">${machineryIcon} Machinery Uptime</span>
                                        <span class="metric-value">${kpisData.machinery_uptime.toFixed(2)}%</span>
                                    </div>
                                    <div class="metric-row" style="border-top: 2px solid #ecf0f1; padding-top: 10px; margin-top: 10px;">
                                        <span class="metric-label">üå± Production Carbon</span>
                                        <span class="metric-value" style="color: #27ae60; font-weight: bold;">${carbonFootprint.fertilizer ? carbonFootprint.fertilizer.toFixed(2) : '0.00'} kg CO2e</span>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">üå± Total Carbon Footprint</span>
                                        <span class="metric-value" style="color: #27ae60; font-weight: bold;">${carbonFootprint.total ? carbonFootprint.total.toFixed(2) : '0.00'} kg CO2e</span>
                                    </div>
                                </div>
                            </div>
                            <div class="ai-suggestion-box" id="productionSuggestion">${aiSuggestionHTML}</div>
                        </div>
                    </div>
                `;
                
                const ctx = document.getElementById('productionChart1').getContext('2d');
                if (charts.productionChart1) charts.productionChart1.destroy();
                charts.productionChart1 = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(productionData.yield_by_crop),
                        datasets: [{
                            label: 'Average Yield (tonnes/ha)',
                            data: Object.values(productionData.yield_by_crop),
                            backgroundColor: '#27ae60'
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            } catch (err) {
                console.error('Error loading production data:', err);
                document.getElementById('production-container').innerHTML = '<p>Error loading data. Please ensure the farm CSV file exists.</p>';
            }
        }

        async function loadComparisonStorage() {
            try {
                const [comparisonData, aiData] = await Promise.all([
                    fetch('/api/comparison/storage').then(r => {
                        if (!r.ok) throw new Error(`HTTP error! status: ${r.status}`);
                        return r.json();
                    }),
                    loadAIInsights('storage').catch(() => ({ insights: [], recommendations: [], farm_insights: {} }))
                ]);

                const farms = Object.keys(comparisonData);
                // Fetch carbon footprint for all farms
                const carbonFootprints = {};
                await Promise.all(farms.map(async (farm) => {
                    try {
                        const kpis = await fetch(`/api/farm/${farm}/kpis`).then(r => r.json());
                        carbonFootprints[farm] = kpis.carbon_footprint || { total: 0, storage: 0 };
                    } catch (e) {
                        carbonFootprints[farm] = { total: 0, storage: 0 };
                    }
                }));

                let html = '';
                
                farms.forEach(farm => {
                    const data = comparisonData[farm];
                    if (!data) {
                        console.error(`No data for farm: ${farm}`);
                        return;
                    }
                    const avg_temp = data.avg_temp || 0;
                    const avg_humidity = data.avg_humidity || 0;
                    const avg_spoilage = data.avg_spoilage || 0;
                    const avg_shelf_life = data.avg_shelf_life || 0;
                    const perfScore = avg_spoilage < 10 ? 80 : avg_spoilage < 15 ? 65 : 50;
                    const perfClass = getPerformanceClass(perfScore);
                    const farmIcon = getIcon('farm', 'lg');
                    const tempIcon = getIcon('temperature', 'sm');
                    const spoilageIcon = getIcon('spoilage', 'sm');
                    const humidityIcon = getIcon('temperature', 'sm'); // Using temperature icon for humidity
                    const shelfLifeIcon = getIcon('processing', 'sm'); // Using processing icon for shelf life
                    const carbonFootprint = carbonFootprints[farm] || { total: 0, storage: 0 };
                    
                    html += `
                        <div class="farm-card ${perfClass}">
                            <div class="farm-card-header">
                                <h3>${farmIcon} ${farm}</h3>
                                <div class="performance-score-container">
                                    <span class="performance-score">${perfScore.toFixed(0)}</span>
                                    <span class="performance-score-label">/100</span>
                                </div>
                                <span class="status-badge ${perfClass}">${getStatusText(perfScore)}</span>
                            </div>
                            <div class="farm-card-body">
                                <div class="metric-row">
                                    <span class="metric-label">${tempIcon} Temperature</span>
                                    <span class="metric-value">${avg_temp.toFixed(2)}¬∞C</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">${humidityIcon} Humidity</span>
                                    <span class="metric-value">${avg_humidity.toFixed(2)}%</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">${spoilageIcon} Spoilage</span>
                                    <span class="metric-value">${avg_spoilage.toFixed(2)}%</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">${shelfLifeIcon} Shelf Life</span>
                                    <span class="metric-value">${avg_shelf_life.toFixed(1)} days</span>
                                </div>
                                <div class="metric-row" style="border-top: 2px solid #ecf0f1; padding-top: 10px; margin-top: 10px;">
                                    <span class="metric-label">üå± Storage Carbon</span>
                                    <span class="metric-value" style="color: #27ae60; font-weight: bold;">${carbonFootprint.storage ? carbonFootprint.storage.toFixed(2) : '0.00'} kg CO2e</span>
                                </div>
                            </div>
                        </div>
                `;
                });
                
                const insights = aiData.insights && aiData.insights.length > 0 ? aiData.insights : ['All farms performing well'];
                const recommendations = aiData.recommendations || [];
                const aiSuggestionHTML = createAISuggestion('AI Comparison', insights, recommendations, true);
                
                document.getElementById('storage-container').innerHTML = `
                    <div class="farm-comparison">
                        ${html}
                    </div>
                    <div class="ai-suggestion-box side-by-side" id="storageSuggestion">${aiSuggestionHTML}</div>
                `;
                
                // Comparison chart
                const ctx = document.getElementById('storageChart1').getContext('2d');
                if (charts.storageChart1) charts.storageChart1.destroy();
                charts.storageChart1 = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: farms,
                        datasets: [
                            { label: 'Temp (¬∞C)', data: farms.map(f => comparisonData[f].avg_temp), backgroundColor: '#3498db' },
                            { label: 'Spoilage (%)', data: farms.map(f => comparisonData[f].avg_spoilage), backgroundColor: '#e74c3c' }
                        ]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            } catch (err) {
                console.error('Error loading comparison data:', err);
                document.getElementById('storage-container').innerHTML = '<p>Error loading data.</p>';
            }
        }

        async function loadStorageData() {
            if (currentFarm === 'all') {
                loadComparisonStorage();
                return;
            }
            
            try {
                const [data, kpisData, aiData] = await Promise.all([
                    fetch(`/api/farm/${currentFarm}/storage`).then(r => r.json()),
                    fetch(`/api/farm/${currentFarm}/kpis`).then(r => r.json()),
                    loadAIInsights('storage')
                ]);
                const carbonFootprint = kpisData.carbon_footprint || { total: 0, storage: 0 };
                
                const perfScore = data.avg_spoilage < 10 ? 85 : data.avg_spoilage < 15 ? 70 : data.avg_spoilage < 20 ? 55 : 40;
                const perfClass = getPerformanceClass(perfScore);
                const farmIcon = getIcon('farm', 'lg');
                const tempIcon = getIcon('temperature', 'sm');
                const spoilageIcon = getIcon('spoilage', 'sm');
                const humidityIcon = getIcon('temperature', 'sm');
                const shelfLifeIcon = getIcon('processing', 'sm');
                
                const insights = aiData.insights && aiData.insights.length > 0 ? aiData.insights : ['All metrics optimal'];
                const recommendations = aiData.recommendations || [];
                const aiSuggestionHTML = createAISuggestion('AI Analysis', insights, recommendations);
                
                // Create side-by-side layout: Farm card and AI box
                document.getElementById('storage-container').innerHTML = `
                    <div class="farm-stage-container">
                        <div class="farm-stage-cards">
                            <div class="farm-card ${perfClass}">
                                <div class="farm-card-header">
                                    <h3>${farmIcon} ${currentFarm}</h3>
                                    <div class="performance-score-container">
                                        <span class="performance-score">${perfScore.toFixed(0)}</span>
                                        <span class="performance-score-label">/100</span>
                                    </div>
                                    <span class="status-badge ${perfClass}">${getStatusText(perfScore)}</span>
                                </div>
                                <div class="farm-card-body">
                                    <div class="metric-row">
                                        <span class="metric-label">${tempIcon} Temperature</span>
                                        <span class="metric-value">${data.avg_temp.toFixed(2)}¬∞C</span>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">${humidityIcon} Humidity</span>
                                        <span class="metric-value">${data.avg_humidity.toFixed(2)}%</span>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">${spoilageIcon} Spoilage</span>
                                        <span class="metric-value">${data.avg_spoilage.toFixed(2)}%</span>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">${shelfLifeIcon} Shelf Life</span>
                                        <span class="metric-value">${data.avg_shelf_life.toFixed(1)} days</span>
                                    </div>
                                    <div class="metric-row" style="border-top: 2px solid #ecf0f1; padding-top: 10px; margin-top: 10px;">
                                        <span class="metric-label">üå± Storage Carbon</span>
                                        <span class="metric-value" style="color: #27ae60; font-weight: bold;">${carbonFootprint.storage ? carbonFootprint.storage.toFixed(2) : '0.00'} kg CO2e</span>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">üå± Total Carbon Footprint</span>
                                        <span class="metric-value" style="color: #27ae60; font-weight: bold;">${carbonFootprint.total ? carbonFootprint.total.toFixed(2) : '0.00'} kg CO2e</span>
                                    </div>
                                </div>
                            </div>
                            <div class="ai-suggestion-box" id="storageSuggestion">${aiSuggestionHTML}</div>
                        </div>
                    </div>
                `;
                
                const ctx = document.getElementById('storageChart1').getContext('2d');
                if (charts.storageChart1) charts.storageChart1.destroy();
                charts.storageChart1 = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Temperature (¬∞C)', 'Humidity (%)', 'Spoilage (%)', 'Shelf Life (days)'],
                        datasets: [{
                            label: 'Storage Metrics',
                            data: [data.avg_temp, data.avg_humidity, data.avg_spoilage, data.avg_shelf_life],
                            backgroundColor: ['#3498db', '#9b59b6', '#e74c3c', '#27ae60']
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            } catch (err) {
                console.error('Error loading storage data:', err);
                document.getElementById('storage-container').innerHTML = '<p>Error loading data. Please ensure the farm CSV file exists.</p>';
            }
        }

        async function loadComparisonProcessing() {
            try {
                const [comparisonData, aiData] = await Promise.all([
                    fetch('/api/comparison/processing').then(r => {
                        if (!r.ok) throw new Error(`HTTP error! status: ${r.status}`);
                        return r.json();
                    }),
                    loadAIInsights('processing').catch(() => ({ insights: [], recommendations: [], farm_insights: {} }))
                ]);

                const farms = Object.keys(comparisonData);
                // Fetch carbon footprint for all farms
                const carbonFootprints = {};
                await Promise.all(farms.map(async (farm) => {
                    try {
                        const kpis = await fetch(`/api/farm/${farm}/kpis`).then(r => r.json());
                        carbonFootprints[farm] = kpis.carbon_footprint || { total: 0, processing: 0 };
                    } catch (e) {
                        carbonFootprints[farm] = { total: 0, processing: 0 };
                    }
                }));

                let html = '';
                const farmIcon = getIcon('farm', 'lg');
                const defectsIcon = getIcon('defects', 'sm');
                const machineryIcon = getIcon('machinery', 'sm');
                const processingIcon = getIcon('processing', 'sm');
                
                farms.forEach(farm => {
                    const data = comparisonData[farm];
                    if (!data) {
                        console.error(`No data for farm: ${farm}`);
                        return;
                    }
                    const farmInsight = aiData.farm_insights && aiData.farm_insights[farm] ? aiData.farm_insights[farm] : '';
                    const avg_defect_rate = data.avg_defect_rate || 0;
                    const avg_uptime = data.avg_uptime || 0;
                    const avg_packaging_speed = data.avg_packaging_speed || 0;
                    const perfScore = avg_defect_rate < 3 && avg_uptime > 90 ? 80 : avg_defect_rate < 5 && avg_uptime > 85 ? 65 : 50;
                    const perfClass = getPerformanceClass(perfScore);
                    const carbonFootprint = carbonFootprints[farm] || { total: 0, processing: 0 };
                    html += `
                        <div class="farm-card ${perfClass}">
                            <div class="farm-card-header">
                                <h3>${farmIcon} ${farm}</h3>
                                <div class="performance-score-container">
                                    <span class="performance-score">${perfScore.toFixed(0)}</span>
                                    <span class="performance-score-label">/100</span>
                                </div>
                                <span class="status-badge ${perfClass}">${getStatusText(perfScore)}</span>
                            </div>
                            <div class="farm-card-body">
                                <div class="metric-row">
                                    <span class="metric-label">${defectsIcon} Defect Rate</span>
                                    <span class="metric-value">${avg_defect_rate.toFixed(2)}%</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">${machineryIcon} Machinery Uptime</span>
                                    <span class="metric-value">${avg_uptime.toFixed(2)}%</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">${processingIcon} Packaging Speed</span>
                                    <span class="metric-value">${avg_packaging_speed.toFixed(1)} units/min</span>
                                </div>
                                <div class="metric-row" style="border-top: 2px solid #ecf0f1; padding-top: 10px; margin-top: 10px;">
                                    <span class="metric-label">üå± Processing Carbon</span>
                                    <span class="metric-value" style="color: #27ae60; font-weight: bold;">${carbonFootprint.processing ? carbonFootprint.processing.toFixed(2) : '0.00'} kg CO2e</span>
                                </div>
                            </div>
                        </div>`;
                });
                
                const insights = aiData.insights && aiData.insights.length > 0 ? aiData.insights : ['All farms performing well'];
                const recommendations = aiData.recommendations || [];
                const aiSuggestionHTML = createAISuggestion('AI Comparison', insights, recommendations, true);
                
                document.getElementById('processing-container').innerHTML = `
                    <div class="farm-comparison">
                        ${html}
                    </div>
                    <div class="ai-suggestion-box side-by-side" id="processingSuggestion">${aiSuggestionHTML}</div>
                `;
                
                const ctx = document.getElementById('processingChart1').getContext('2d');
                if (charts.processingChart1) charts.processingChart1.destroy();
                const allProcesses = new Set();
                farms.forEach(farm => {
                    if (comparisonData[farm] && comparisonData[farm].defect_by_process) {
                        Object.keys(comparisonData[farm].defect_by_process).forEach(proc => allProcesses.add(proc));
                    }
                });
                const processLabels = Array.from(allProcesses);
                
                if (processLabels.length > 0) {
                    charts.processingChart1 = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: processLabels,
                            datasets: farms.map((farm, idx) => ({
                                label: farm,
                                data: processLabels.map(proc => (comparisonData[farm] && comparisonData[farm].defect_by_process && comparisonData[farm].defect_by_process[proc]) || 0),
                                backgroundColor: ['#27ae60', '#3498db', '#e74c3c', '#f39c12'][idx]
                            }))
                        },
                        options: { responsive: true, maintainAspectRatio: false }
                    });
                } else {
                    charts.processingChart1 = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: farms,
                            datasets: [{
                                label: 'Defect Rate (%)',
                                data: farms.map(f => comparisonData[f].avg_defect_rate),
                                backgroundColor: ['#27ae60', '#3498db', '#e74c3c', '#f39c12']
                            }]
                        },
                        options: { responsive: true, maintainAspectRatio: false }
                    });
                }
            } catch (err) {
                console.error('Error loading comparison data:', err);
                document.getElementById('processing-container').innerHTML = '<p>Error loading data.</p>';
            }
        }

        async function loadProcessingData() {
            if (currentFarm === 'all') {
                loadComparisonProcessing();
                return;
            }
            
            try {
                const [data, kpisData, aiData] = await Promise.all([
                    fetch(`/api/farm/${currentFarm}/processing`).then(r => r.json()),
                    fetch(`/api/farm/${currentFarm}/kpis`).then(r => r.json()),
                    loadAIInsights('processing')
                ]);
                const carbonFootprint = kpisData.carbon_footprint || { total: 0, processing: 0 };
                
                const perfScore = data.avg_defect_rate < 3 && data.avg_uptime > 90 ? 85 : data.avg_defect_rate < 5 && data.avg_uptime > 85 ? 70 : data.avg_defect_rate < 7 ? 55 : 40;
                const perfClass = getPerformanceClass(perfScore);
                const farmIcon = getIcon('farm', 'lg');
                const defectsIcon = getIcon('defects', 'sm');
                const machineryIcon = getIcon('machinery', 'sm');
                const processingIcon = getIcon('processing', 'sm');
                
                const insights = aiData.insights && aiData.insights.length > 0 ? aiData.insights : ['All metrics optimal'];
                const recommendations = aiData.recommendations || [];
                const aiSuggestionHTML = createAISuggestion('AI Analysis', insights, recommendations);
                
                // Create side-by-side layout: Farm card and AI box
                document.getElementById('processing-container').innerHTML = `
                    <div class="farm-stage-container">
                        <div class="farm-stage-cards">
                            <div class="farm-card ${perfClass}">
                                <div class="farm-card-header">
                                    <h3>${farmIcon} ${currentFarm}</h3>
                                    <div class="performance-score-container">
                                        <span class="performance-score">${perfScore.toFixed(0)}</span>
                                        <span class="performance-score-label">/100</span>
                                    </div>
                                    <span class="status-badge ${perfClass}">${getStatusText(perfScore)}</span>
                                </div>
                                <div class="farm-card-body">
                                    <div class="metric-row">
                                        <span class="metric-label">${defectsIcon} Defect Rate</span>
                                        <span class="metric-value">${data.avg_defect_rate.toFixed(2)}%</span>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">${machineryIcon} Machinery Uptime</span>
                                        <span class="metric-value">${data.avg_uptime.toFixed(2)}%</span>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">${processingIcon} Packaging Speed</span>
                                        <span class="metric-value">${data.avg_packaging_speed.toFixed(1)} units/min</span>
                                    </div>
                                    <div class="metric-row" style="border-top: 2px solid #ecf0f1; padding-top: 10px; margin-top: 10px;">
                                        <span class="metric-label">üå± Processing Carbon</span>
                                        <span class="metric-value" style="color: #27ae60; font-weight: bold;">${carbonFootprint.processing ? carbonFootprint.processing.toFixed(2) : '0.00'} kg CO2e</span>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">üå± Total Carbon Footprint</span>
                                        <span class="metric-value" style="color: #27ae60; font-weight: bold;">${carbonFootprint.total ? carbonFootprint.total.toFixed(2) : '0.00'} kg CO2e</span>
                                    </div>
                                </div>
                            </div>
                            <div class="ai-suggestion-box" id="processingSuggestion">${aiSuggestionHTML}</div>
                        </div>
                    </div>
                `;
                
                const ctx = document.getElementById('processingChart1').getContext('2d');
                if (charts.processingChart1) charts.processingChart1.destroy();
                charts.processingChart1 = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(data.defect_by_process),
                        datasets: [{
                            label: 'Defect Rate (%)',
                            data: Object.values(data.defect_by_process),
                            backgroundColor: '#e74c3c'
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            } catch (err) {
                console.error('Error loading processing data:', err);
                document.getElementById('processing-kpis').innerHTML = '<p>Error loading data. Please ensure the farm CSV file exists.</p>';
            }
        }

        async function loadComparisonTransportation() {
            try {
                const [comparisonData, aiData] = await Promise.all([
                    fetch('/api/comparison/transportation').then(r => {
                        if (!r.ok) throw new Error(`HTTP error! status: ${r.status}`);
                        return r.json();
                    }),
                    loadAIInsights('transportation').catch(() => ({ insights: [], recommendations: [], farm_insights: {} }))
                ]);

                const farms = Object.keys(comparisonData);
                // Fetch carbon footprint for all farms
                const carbonFootprints = {};
                await Promise.all(farms.map(async (farm) => {
                    try {
                        const kpis = await fetch(`/api/farm/${farm}/kpis`).then(r => r.json());
                        carbonFootprints[farm] = kpis.carbon_footprint || { total: 0, transportation: 0 };
                    } catch (e) {
                        carbonFootprints[farm] = { total: 0, transportation: 0 };
                    }
                }));

                let html = '';
                
                farms.forEach(farm => {
                    const data = comparisonData[farm];
                    if (!data) {
                        console.error(`No data for farm: ${farm}`);
                        return;
                    }
                    const insight = aiData.farm_insights && aiData.farm_insights[farm] ? aiData.farm_insights[farm] : 'All metrics optimal';
                    const delay_percentage = data.delay_percentage || 0;
                    const avg_distance = data.avg_distance || 0;
                    const avg_fuel = data.avg_fuel || 0;
                    const avg_delivery_time = data.avg_delivery_time || 0;
                    const perfScore = delay_percentage < 10 ? 80 : delay_percentage < 15 ? 65 : 50;
                    const perfClass = getPerformanceClass(perfScore);
                    const farmIcon = getIcon('farm', 'lg');
                    const transportationIcon = getIcon('transportation', 'sm');
                    const delaysIcon = getIcon('delays', 'sm');
                    const fuelIcon = getIcon('fuel', 'sm');
                    const distanceIcon = getIcon('distance', 'sm');
                    const carbonFootprint = carbonFootprints[farm] || { total: 0, transportation: 0 };
                    
                    html += `
                        <div class="farm-card ${perfClass}">
                            <div class="farm-card-header">
                                <h3>${farmIcon} ${farm}</h3>
                                <div class="performance-score-container">
                                    <span class="performance-score">${perfScore.toFixed(0)}</span>
                                    <span class="performance-score-label">/100</span>
                                </div>
                                <span class="status-badge ${perfClass}">${getStatusText(perfScore)}</span>
                            </div>
                            <div class="farm-card-body">
                                <div class="metric-row">
                                    <span class="metric-label">${transportationIcon} Delays</span>
                                    <span class="metric-value">${delay_percentage.toFixed(1)}%</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">${distanceIcon} Distance</span>
                                    <span class="metric-value">${avg_distance.toFixed(0)} km</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">${fuelIcon} Fuel Usage</span>
                                    <span class="metric-value">${avg_fuel.toFixed(1)} L/100km</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">${delaysIcon} Delivery Time</span>
                                    <span class="metric-value">${avg_delivery_time.toFixed(1)} hrs</span>
                                </div>
                                <div class="metric-row" style="border-top: 2px solid #ecf0f1; padding-top: 10px; margin-top: 10px;">
                                    <span class="metric-label">üå± Transportation Carbon</span>
                                    <span class="metric-value" style="color: #27ae60; font-weight: bold;">${carbonFootprint.transportation ? carbonFootprint.transportation.toFixed(2) : '0.00'} kg CO2e</span>
                                </div>
                            </div>
                        </div>`;
                });
                
                const insights = aiData.insights && aiData.insights.length > 0 ? aiData.insights : ['All farms performing well'];
                const recommendations = aiData.recommendations || [];
                const aiSuggestionHTML = createAISuggestion('AI Comparison', insights, recommendations, true);
                
                document.getElementById('transportation-container').innerHTML = `
                    <div class="farm-comparison">
                        ${html}
                    </div>
                    <div class="ai-suggestion-box side-by-side" id="transportationSuggestion">${aiSuggestionHTML}</div>
                `;
                
                const ctx = document.getElementById('transChart1').getContext('2d');
                if (charts.transChart1) charts.transChart1.destroy();
                charts.transChart1 = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: farms,
                        datasets: [{
                            label: 'Delay %',
                            data: farms.map(f => comparisonData[f].delay_percentage),
                            backgroundColor: ['#27ae60', '#3498db', '#e74c3c', '#f39c12']
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            } catch (err) {
                console.error('Error loading comparison data:', err);
                document.getElementById('transportation-container').innerHTML = '<p>Error loading data.</p>';
            }
        }

        async function loadTransportationData() {
            if (currentFarm === 'all') {
                loadComparisonTransportation();
                return;
            }
            
            try {
                const [data, kpisData, aiData] = await Promise.all([
                    fetch(`/api/farm/${currentFarm}/transportation`).then(r => r.json()),
                    fetch(`/api/farm/${currentFarm}/kpis`).then(r => r.json()),
                    loadAIInsights('transportation')
                ]);
                const carbonFootprint = kpisData.carbon_footprint || { total: 0, transportation: 0 };
                
                const perfScore = data.delay_percentage < 10 ? 85 : data.delay_percentage < 15 ? 70 : data.delay_percentage < 20 ? 55 : 40;
                const perfClass = getPerformanceClass(perfScore);
                const farmIcon = getIcon('farm', 'lg');
                const transportationIcon = getIcon('transportation', 'sm');
                const delaysIcon = getIcon('delays', 'sm');
                const fuelIcon = getIcon('fuel', 'sm');
                const distanceIcon = getIcon('distance', 'sm');
                
                const insights = aiData.insights && aiData.insights.length > 0 ? aiData.insights : ['All metrics optimal'];
                const recommendations = aiData.recommendations || [];
                const aiSuggestionHTML = createAISuggestion('AI Analysis', insights, recommendations);
                
                // Create side-by-side layout: Farm card and AI box
                document.getElementById('transportation-container').innerHTML = `
                    <div class="farm-stage-container">
                        <div class="farm-stage-cards">
                            <div class="farm-card ${perfClass}">
                                <div class="farm-card-header">
                                    <h3>${farmIcon} ${currentFarm}</h3>
                                    <div class="performance-score-container">
                                        <span class="performance-score">${perfScore.toFixed(0)}</span>
                                        <span class="performance-score-label">/100</span>
                                    </div>
                                    <span class="status-badge ${perfClass}">${getStatusText(perfScore)}</span>
                                </div>
                                <div class="farm-card-body">
                                    <div class="metric-row">
                                        <span class="metric-label">${transportationIcon} Delays</span>
                                        <span class="metric-value">${data.delay_percentage.toFixed(1)}%</span>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">${distanceIcon} Distance</span>
                                        <span class="metric-value">${data.avg_distance.toFixed(0)} km</span>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">${fuelIcon} Fuel Usage</span>
                                        <span class="metric-value">${data.avg_fuel.toFixed(1)} L/100km</span>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">${delaysIcon} Delivery Time</span>
                                        <span class="metric-value">${data.avg_delivery_time.toFixed(1)} hrs</span>
                                    </div>
                                    <div class="metric-row" style="border-top: 2px solid #ecf0f1; padding-top: 10px; margin-top: 10px;">
                                        <span class="metric-label">üå± Transportation Carbon</span>
                                        <span class="metric-value" style="color: #27ae60; font-weight: bold;">${carbonFootprint.transportation ? carbonFootprint.transportation.toFixed(2) : '0.00'} kg CO2e</span>
                                    </div>
                                </div>
                            </div>
                            <div class="ai-suggestion-box" id="transportationSuggestion">${aiSuggestionHTML}</div>
                        </div>
                    </div>
                `;
                
                const ctx = document.getElementById('transChart1').getContext('2d');
                if (charts.transChart1) charts.transChart1.destroy();
                charts.transChart1 = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Distance (km)', 'Fuel (L/100km)', 'Delivery Time (hrs)', 'Delays (%)'],
                        datasets: [{
                            label: 'Transportation Metrics',
                            data: [data.avg_distance / 10, data.avg_fuel, data.avg_delivery_time, data.delay_percentage],
                            backgroundColor: ['#3498db', '#f39c12', '#27ae60', '#e74c3c']
                        }]
                    },
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            } catch (err) {
                console.error('Error loading transportation data:', err);
                document.getElementById('transportation-container').innerHTML = '<p>Error loading data. Please ensure the farm CSV file exists.</p>';
            }
        }

        async function loadComparisonRetail() {
            try {
                const [comparisonData, aiData] = await Promise.all([
                    fetch('/api/comparison/retail').then(r => {
                        if (!r.ok) throw new Error(`HTTP error! status: ${r.status}`);
                        return r.json();
                    }),
                    loadAIInsights('retail').catch(() => ({ insights: [], recommendations: [], farm_insights: {} }))
                ]);

                const farms = Object.keys(comparisonData);
                // Fetch carbon footprint for all farms
                const carbonFootprints = {};
                await Promise.all(farms.map(async (farm) => {
                    try {
                        const kpis = await fetch(`/api/farm/${farm}/kpis`).then(r => r.json());
                        carbonFootprints[farm] = kpis.carbon_footprint || { total: 0 };
                    } catch (e) {
                        carbonFootprints[farm] = { total: 0 };
                    }
                }));

                let html = '';
                
                farms.forEach(farm => {
                    const data = comparisonData[farm];
                    if (!data) {
                        console.error(`No data for farm: ${farm}`);
                        return;
                    }
                    const insight = aiData.farm_insights && aiData.farm_insights[farm] ? aiData.farm_insights[farm] : 'All metrics optimal';
                    const avg_waste = data.avg_waste || 0;
                    const total_inventory = data.total_inventory || 0;
                    const avg_sales_velocity = data.avg_sales_velocity || 0;
                    const avg_pricing_index = data.avg_pricing_index || 0;
                    const perfScore = avg_waste < 10 ? 80 : avg_waste < 12 ? 65 : 50;
                    const perfClass = getPerformanceClass(perfScore);
                    const farmIcon = getIcon('farm', 'lg');
                    const wasteIcon = getIcon('waste_icon', 'sm');
                    const inventoryIcon = getIcon('inventory', 'sm');
                    const salesIcon = getIcon('sales', 'sm');
                    const carbonFootprint = carbonFootprints[farm] || { total: 0 };
                    
                    html += `
                        <div class="farm-card ${perfClass}">
                            <div class="farm-card-header">
                                <h3>${farmIcon} ${farm}</h3>
                                <div class="performance-score-container">
                                    <span class="performance-score">${perfScore.toFixed(0)}</span>
                                    <span class="performance-score-label">/100</span>
                                </div>
                                <span class="status-badge ${perfClass}">${getStatusText(perfScore)}</span>
                            </div>
                            <div class="farm-card-body">
                                <div class="metric-row">
                                    <span class="metric-label">${wasteIcon} Waste</span>
                                    <span class="metric-value">${avg_waste.toFixed(2)}%</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">${inventoryIcon} Inventory</span>
                                    <span class="metric-value">${(total_inventory/1000).toFixed(0)}k units</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">${salesIcon} Sales Velocity</span>
                                    <span class="metric-value">${avg_sales_velocity.toFixed(1)} units/day</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">${salesIcon} Pricing Index</span>
                                    <span class="metric-value">${avg_pricing_index.toFixed(2)}</span>
                                </div>
                            </div>
                        </div>`;
                });
                
                const insights = aiData.insights && aiData.insights.length > 0 ? aiData.insights : ['All farms performing well'];
                const recommendations = aiData.recommendations || [];
                const aiSuggestionHTML = createAISuggestion('AI Comparison', insights, recommendations, true);
                
                document.getElementById('retail-container').innerHTML = `
                    <div class="farm-comparison">
                        ${html}
                    </div>
                    <div class="ai-suggestion-box side-by-side" id="retailSuggestion">${aiSuggestionHTML}</div>
                `;
                
                const ctx = document.getElementById('retailChart1').getContext('2d');
                if (charts.retailChart1) charts.retailChart1.destroy();
                charts.retailChart1 = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: farms,
                        datasets: [{
                            label: 'Waste %',
                            data: farms.map(f => comparisonData[f].avg_waste),
                            backgroundColor: ['#27ae60', '#3498db', '#e74c3c', '#f39c12']
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            } catch (err) {
                console.error('Error loading comparison data:', err);
                document.getElementById('retail-container').innerHTML = '<p>Error loading data.</p>';
            }
        }

        async function loadRetailData() {
            if (currentFarm === 'all') {
                loadComparisonRetail();
                return;
            }
            
            try {
                const [data, kpisData, aiData] = await Promise.all([
                    fetch(`/api/farm/${currentFarm}/retail`).then(r => r.json()),
                    fetch(`/api/farm/${currentFarm}/kpis`).then(r => r.json()),
                    loadAIInsights('retail')
                ]);
                const carbonFootprint = kpisData.carbon_footprint || { total: 0 };
                
                const perfScore = data.avg_waste < 10 ? 85 : data.avg_waste < 12 ? 70 : data.avg_waste < 15 ? 55 : 40;
                const perfClass = getPerformanceClass(perfScore);
                const farmIcon = getIcon('farm', 'lg');
                const wasteIcon = getIcon('waste_icon', 'sm');
                const inventoryIcon = getIcon('inventory', 'sm');
                const salesIcon = getIcon('sales', 'sm');
                
                const insights = aiData.insights && aiData.insights.length > 0 ? aiData.insights : ['All metrics optimal'];
                const recommendations = aiData.recommendations || [];
                const aiSuggestionHTML = createAISuggestion('AI Analysis', insights, recommendations);
                
                // Create side-by-side layout: Farm card and AI box
                document.getElementById('retail-container').innerHTML = `
                    <div class="farm-stage-container">
                        <div class="farm-stage-cards">
                            <div class="farm-card ${perfClass}">
                                <div class="farm-card-header">
                                    <h3>${farmIcon} ${currentFarm}</h3>
                                    <div class="performance-score-container">
                                        <span class="performance-score">${perfScore.toFixed(0)}</span>
                                        <span class="performance-score-label">/100</span>
                                    </div>
                                    <span class="status-badge ${perfClass}">${getStatusText(perfScore)}</span>
                                </div>
                                <div class="farm-card-body">
                                    <div class="metric-row">
                                        <span class="metric-label">${wasteIcon} Waste</span>
                                        <span class="metric-value">${data.avg_waste.toFixed(2)}%</span>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">${inventoryIcon} Inventory</span>
                                        <span class="metric-value">${data.total_inventory.toFixed(0)} units</span>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">${salesIcon} Sales Velocity</span>
                                        <span class="metric-value">${data.avg_sales_velocity.toFixed(1)} units/day</span>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">${salesIcon} Pricing Index</span>
                                        <span class="metric-value">${data.avg_pricing_index.toFixed(2)}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="ai-suggestion-box" id="retailSuggestion">${aiSuggestionHTML}</div>
                        </div>
                    </div>
                `;
                
                const ctx = document.getElementById('retailChart1').getContext('2d');
                if (charts.retailChart1) charts.retailChart1.destroy();
                charts.retailChart1 = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Inventory (units)', 'Sales Velocity (units/day)', 'Pricing Index', 'Waste (%)'],
                        datasets: [{
                            label: 'Retail Metrics',
                            data: [data.total_inventory / 1000, data.avg_sales_velocity, data.avg_pricing_index * 100, data.avg_waste],
                            backgroundColor: ['#3498db', '#27ae60', '#f39c12', '#e74c3c']
                        }]
                    },
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            } catch (err) {
                console.error('Error loading retail data:', err);
                document.getElementById('retail-container').innerHTML = '<p>Error loading data. Please ensure the farm CSV file exists.</p>';
            }
        }

        // Consumption-specific charts and views have been removed

        async function loadComparisonWaste() {
            try {
                const [comparisonData, aiData] = await Promise.all([
                    fetch('/api/comparison/waste').then(r => {
                        if (!r.ok) throw new Error(`HTTP error! status: ${r.status}`);
                        return r.json();
                    }),
                    loadAIInsights('waste').catch(() => ({ insights: [], recommendations: [], farm_insights: {} }))
                ]);

                const farms = Object.keys(comparisonData);
                // Fetch carbon footprint for all farms
                const carbonFootprints = {};
                await Promise.all(farms.map(async (farm) => {
                    try {
                        const kpis = await fetch(`/api/farm/${farm}/kpis`).then(r => r.json());
                        carbonFootprints[farm] = kpis.carbon_footprint || { total: 0, waste: 0 };
                    } catch (e) {
                        carbonFootprints[farm] = { total: 0, waste: 0 };
                    }
                }));

                let html = '';
                
                farms.forEach(farm => {
                    const data = comparisonData[farm];
                    if (!data) {
                        console.error(`No data for farm: ${farm}`);
                        return;
                    }
                    const insight = aiData.farm_insights && aiData.farm_insights[farm] ? aiData.farm_insights[farm] : 'All metrics optimal';
                    const avg_segregation = data.avg_segregation || 0;
                    const avg_upcycling = data.avg_upcycling || 0;
                    const avg_biogas = data.avg_biogas || 0;
                    const perfScore = avg_segregation > 85 && avg_upcycling > 60 ? 80 : avg_segregation > 75 && avg_upcycling > 50 ? 65 : 50;
                    const perfClass = getPerformanceClass(perfScore);
                    const farmIcon = getIcon('farm', 'lg');
                    const wasteIcon = getIcon('waste', 'sm');
                    const processingIcon = getIcon('processing', 'sm');
                    const carbonFootprint = carbonFootprints[farm] || { total: 0, waste: 0 };
                    
                    html += `
                        <div class="farm-card ${perfClass}">
                            <div class="farm-card-header">
                                <h3>${farmIcon} ${farm}</h3>
                                <div class="performance-score-container">
                                    <span class="performance-score">${perfScore.toFixed(0)}</span>
                                    <span class="performance-score-label">/100</span>
                                </div>
                                <span class="status-badge ${perfClass}">${getStatusText(perfScore)}</span>
                            </div>
                            <div class="farm-card-body">
                                <div class="metric-row">
                                    <span class="metric-label">${wasteIcon} Segregation</span>
                                    <span class="metric-value">${avg_segregation.toFixed(2)}%</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">${wasteIcon} Upcycling Rate</span>
                                    <span class="metric-value">${avg_upcycling.toFixed(2)}%</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">${processingIcon} Biogas Output</span>
                                    <span class="metric-value">${avg_biogas.toFixed(1)} m¬≥</span>
                                </div>
                                <div class="metric-row" style="border-top: 2px solid #ecf0f1; padding-top: 10px; margin-top: 10px;">
                                    <span class="metric-label">üå± Waste Carbon</span>
                                    <span class="metric-value" style="color: #27ae60; font-weight: bold;">${carbonFootprint.waste ? carbonFootprint.waste.toFixed(2) : '0.00'} kg CO2e</span>
                                </div>
                            </div>
                        </div>`;
                });
                
                const insights = aiData.insights && aiData.insights.length > 0 ? aiData.insights : ['All farms performing well'];
                const recommendations = aiData.recommendations || [];
                const aiSuggestionHTML = createAISuggestion('AI Comparison', insights, recommendations, true);
                
                document.getElementById('waste-container').innerHTML = `
                    <div class="farm-comparison">
                        ${html}
                    </div>
                    <div class="ai-suggestion-box side-by-side" id="wasteSuggestion">${aiSuggestionHTML}</div>
                `;
                
                const ctx = document.getElementById('wasteChart1').getContext('2d');
                if (charts.wasteChart1) charts.wasteChart1.destroy();
                charts.wasteChart1 = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: farms,
                        datasets: [{
                            label: 'Segregation %',
                            data: farms.map(f => comparisonData[f].avg_segregation),
                            backgroundColor: ['#27ae60', '#3498db', '#e74c3c', '#f39c12']
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            } catch (err) {
                console.error('Error loading comparison data:', err);
                document.getElementById('waste-container').innerHTML = '<p>Error loading data.</p>';
            }
        }

        async function loadWasteData() {
            if (currentFarm === 'all') {
                loadComparisonWaste();
                return;
            }
            
            try {
                const [data, kpisData, aiData] = await Promise.all([
                    fetch(`/api/farm/${currentFarm}/waste`).then(r => r.json()),
                    fetch(`/api/farm/${currentFarm}/kpis`).then(r => r.json()),
                    loadAIInsights('waste')
                ]);
                const carbonFootprint = kpisData.carbon_footprint || { total: 0, waste: 0 };
                
                const perfScore = data.avg_segregation > 85 && data.avg_upcycling > 60 ? 85 : data.avg_segregation > 75 && data.avg_upcycling > 50 ? 70 : data.avg_segregation > 65 ? 55 : 40;
                const perfClass = getPerformanceClass(perfScore);
                const farmIcon = getIcon('farm', 'lg');
                const wasteIcon = getIcon('waste', 'sm');
                const processingIcon = getIcon('processing', 'sm');
                
                const insights = aiData.insights && aiData.insights.length > 0 ? aiData.insights : ['All metrics optimal'];
                const recommendations = aiData.recommendations || [];
                const aiSuggestionHTML = createAISuggestion('AI Analysis', insights, recommendations);
                
                // Create side-by-side layout: Farm card and AI box
                document.getElementById('waste-container').innerHTML = `
                    <div class="farm-stage-container">
                        <div class="farm-stage-cards">
                            <div class="farm-card ${perfClass}">
                                <div class="farm-card-header">
                                    <h3>${farmIcon} ${currentFarm}</h3>
                                    <div class="performance-score-container">
                                        <span class="performance-score">${perfScore.toFixed(0)}</span>
                                        <span class="performance-score-label">/100</span>
                                    </div>
                                    <span class="status-badge ${perfClass}">${getStatusText(perfScore)}</span>
                                </div>
                                <div class="farm-card-body">
                                    <div class="metric-row">
                                        <span class="metric-label">${wasteIcon} Segregation</span>
                                        <span class="metric-value">${data.avg_segregation.toFixed(2)}%</span>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">${wasteIcon} Upcycling Rate</span>
                                        <span class="metric-value">${data.avg_upcycling.toFixed(2)}%</span>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">${processingIcon} Biogas Output</span>
                                        <span class="metric-value">${data.avg_biogas.toFixed(1)} m¬≥</span>
                                    </div>
                                    <div class="metric-row" style="border-top: 2px solid #ecf0f1; padding-top: 10px; margin-top: 10px;">
                                        <span class="metric-label">üå± Waste Carbon</span>
                                        <span class="metric-value" style="color: #27ae60; font-weight: bold;">${carbonFootprint.waste ? carbonFootprint.waste.toFixed(2) : '0.00'} kg CO2e</span>
                                    </div>
                                </div>
                            </div>
                            <div class="ai-suggestion-box" id="wasteSuggestion">${aiSuggestionHTML}</div>
                        </div>
                    </div>
                `;
                
                const ctx = document.getElementById('wasteChart1').getContext('2d');
                if (charts.wasteChart1) charts.wasteChart1.destroy();
                charts.wasteChart1 = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: Object.keys(data.waste_dist),
                        datasets: [{
                            data: Object.values(data.waste_dist),
                            backgroundColor: ['#27ae60', '#3498db', '#f39c12']
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            } catch (err) {
                console.error('Error loading waste data:', err);
                document.getElementById('waste-container').innerHTML = '<p>Error loading data. Please ensure the farm CSV file exists.</p>';
            }
        }

        function viewFarmDetails(stage) {
            if (currentFarm === 'all') {
                // Show comparison details for all farms
                window.location.href = `/details/all/${stage}`;
            } else {
                // Show details for specific farm
                window.location.href = `/details/${currentFarm}/${stage}`;
            }
        }

        // Initialize icons
        function initializeIcons() {
            // Sidebar icons
            document.getElementById('sidebar-overview-icon').innerHTML = getIcon('overview', 'lg');
            document.getElementById('sidebar-production-icon').innerHTML = getIcon('production', 'lg');
            document.getElementById('sidebar-storage-icon').innerHTML = getIcon('storage', 'lg');
            document.getElementById('sidebar-processing-icon').innerHTML = getIcon('processing', 'lg');
            document.getElementById('sidebar-transportation-icon').innerHTML = getIcon('transportation', 'lg');
            document.getElementById('sidebar-retail-icon').innerHTML = getIcon('retail', 'lg');
            document.getElementById('sidebar-price-icon').innerHTML = getIcon('sales', 'lg');
            document.getElementById('sidebar-waste-icon').innerHTML = getIcon('waste', 'lg');
            document.getElementById('sidebar-security-icon').innerHTML = getIcon('security', 'lg');
            
            // Section title icons
            document.getElementById('overview-title-icon').innerHTML = getIcon('overview', 'xl');
            document.getElementById('production-title-icon').innerHTML = getIcon('production', 'xl');
            document.getElementById('storage-title-icon').innerHTML = getIcon('storage', 'xl');
            document.getElementById('processing-title-icon').innerHTML = getIcon('processing', 'xl');
            document.getElementById('transportation-title-icon').innerHTML = getIcon('transportation', 'xl');
            document.getElementById('retail-title-icon').innerHTML = getIcon('retail', 'xl');
            document.getElementById('price-title-icon').innerHTML = getIcon('sales', 'xl');
            document.getElementById('waste-title-icon').innerHTML = getIcon('waste', 'xl');
            document.getElementById('security-title-icon').innerHTML = getIcon('security', 'xl');
            
            // Sparkle icons
            const sparkleIcon = getIcon('sparkle', 'sm');
            document.getElementById('overview-sparkle-icon').innerHTML = sparkleIcon;
            document.getElementById('production-sparkle-icon').innerHTML = sparkleIcon;
            document.getElementById('storage-sparkle-icon').innerHTML = sparkleIcon;
            document.getElementById('processing-sparkle-icon').innerHTML = sparkleIcon;
            document.getElementById('transportation-sparkle-icon').innerHTML = sparkleIcon;
            document.getElementById('retail-sparkle-icon').innerHTML = sparkleIcon;
            document.getElementById('price-sparkle-icon').innerHTML = sparkleIcon;
            document.getElementById('waste-sparkle-icon').innerHTML = sparkleIcon;
            document.getElementById('security-sparkle-icon').innerHTML = sparkleIcon;
            
            // Chart sparkle icons
            document.getElementById('chart1-sparkle-icon').innerHTML = sparkleIcon;
            document.getElementById('chart2-sparkle-icon').innerHTML = sparkleIcon;
            document.getElementById('chart3-sparkle-icon').innerHTML = sparkleIcon;
            document.getElementById('chart4-sparkle-icon').innerHTML = sparkleIcon;
            document.getElementById('production-chart-sparkle-icon').innerHTML = sparkleIcon;
            document.getElementById('storage-chart-sparkle-icon').innerHTML = sparkleIcon;
            document.getElementById('processing-chart-sparkle-icon').innerHTML = sparkleIcon;
            document.getElementById('transportation-chart-sparkle-icon').innerHTML = sparkleIcon;
            document.getElementById('retail-chart-sparkle-icon').innerHTML = sparkleIcon;
            document.getElementById('waste-chart-sparkle-icon').innerHTML = sparkleIcon;
            document.getElementById('price-chart-sparkle-icon').innerHTML = sparkleIcon;
            
            // Button icons
            document.getElementById('production-button-icon').innerHTML = sparkleIcon;
            document.getElementById('storage-button-icon').innerHTML = sparkleIcon;
            document.getElementById('processing-button-icon').innerHTML = sparkleIcon;
            document.getElementById('transportation-button-icon').innerHTML = sparkleIcon;
            document.getElementById('retail-button-icon').innerHTML = sparkleIcon;
            document.getElementById('waste-button-icon').innerHTML = sparkleIcon;
            
            // Header AI icon
            document.getElementById('header-ai-icon').innerHTML = getIcon('ai', 'sm');
        }
        
        // Initialize - set "All Farms" as active by default
        initializeIcons();
        document.querySelector('.farm-tab').classList.add('active');
        loadOverviewData();
        
        // Check if security section is active on page load and set body class
        if (document.getElementById('security') && document.getElementById('security').classList.contains('active')) {
            document.body.classList.add('security-active');
        }
    </script>

    <!-- Chatbot UI - Must be before the initialization script -->
    <div class="chatbot-toggle" id="chatbotToggle">
        <svg viewBox="0 0 24 24">
            <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/>
        </svg>
    </div>
    <div class="chatbot-container" id="chatbotContainer">
        <div class="chatbot-header">
            <h3>ü§ñ AI Assistant</h3>
            <div class="chatbot-header-right">
                <button class="chatbot-audio-btn" id="chatbotAudioBtn" title="Toggle audio responses">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
                    </svg>
                </button>
                <div class="chatbot-language-selector">
                    <button class="chatbot-language-btn" id="chatbotLanguageBtn">üåê English</button>
                    <div class="chatbot-language-dropdown" id="chatbotLanguageDropdown">
                        <div class="chatbot-language-option selected" data-lang="en">English</div>
                        <div class="chatbot-language-option" data-lang="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä (Hindi)</div>
                        <div class="chatbot-language-option" data-lang="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤° (Kannada)</div>
                    </div>
                </div>
            <button class="chatbot-close" id="chatbotClose">√ó</button>
            </div>
        </div>
        <div class="chatbot-messages" id="chatbotMessages"></div>
        <div class="chatbot-input-container">
            <div class="chatbot-input-wrapper">
            <input type="text" class="chatbot-input" id="chatbotInput" placeholder="Ask me anything about the farms...">
                <button class="chatbot-mic-btn" id="chatbotMicBtn" title="Click to speak">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                        <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                    </svg>
                </button>
            </div>
            <button class="chatbot-send" id="chatbotSend">Send</button>
        </div>
    </div>

    <script>
        // Chatbot functionality - initialize after elements are in DOM
        function initializeChatbot() {
            let chatbotOpen = false;
            const chatbotToggle = document.getElementById('chatbotToggle');
            const chatbotContainer = document.getElementById('chatbotContainer');
            const chatbotClose = document.getElementById('chatbotClose');
            const chatbotInput = document.getElementById('chatbotInput');
            const chatbotSend = document.getElementById('chatbotSend');
            const chatbotMessages = document.getElementById('chatbotMessages');

            if (!chatbotToggle || !chatbotContainer) {
                console.error('Chatbot elements not found', { chatbotToggle, chatbotContainer });
                return;
            }
            
            console.log('Chatbot initialized successfully');

            function addMessage(text, isUser = false) {
                if (!chatbotMessages) return;
                const messageDiv = document.createElement('div');
                messageDiv.className = `chatbot-message ${isUser ? 'user' : 'bot'}`;
                const contentDiv = document.createElement('div');
                contentDiv.className = 'chatbot-message-content';
                
                // For bot messages, render HTML (for markdown formatting)
                // For user messages, use plain text to prevent XSS
                if (isUser) {
                    contentDiv.textContent = text;
                } else {
                    contentDiv.innerHTML = text;
                }
                
                messageDiv.appendChild(contentDiv);
                chatbotMessages.appendChild(messageDiv);
                chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
            }

            function addTypingIndicator() {
                if (!chatbotMessages) return;
                const typingDiv = document.createElement('div');
                typingDiv.className = 'chatbot-message bot';
                typingDiv.id = 'typingIndicator';
                typingDiv.innerHTML = '<div class="chatbot-typing"><span></span><span></span><span></span></div>';
                chatbotMessages.appendChild(typingDiv);
                chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
            }

            function removeTypingIndicator() {
                const indicator = document.getElementById('typingIndicator');
                if (indicator) indicator.remove();
            }

            // Language selection functionality
            let selectedLanguage = localStorage.getItem('chatbotLanguage') || 'en';
            const languageNames = {
                'en': 'English',
                'hi': '‡§π‡§ø‡§Ç‡§¶‡•Ä',
                'kn': '‡≤ï‡≤®‡≥ç‡≤®‡≤°'
            };
            
            // Audio (Text-to-Speech) functionality - Automatic based on input method
            const chatbotAudioBtn = document.getElementById('chatbotAudioBtn');
            
            // Map languages to speech synthesis voices
            const speechSynthesisLanguages = {
                'en': 'en-US',
                'hi': 'hi-IN',
                'kn': 'kn-IN'
            };
            
            // Function to speak using API TTS - optimized for fastest response
            async function speakTextAPI(text, lang) {
                try {
                    // Clean text immediately
                    const cleanText = text.replace(/<[^>]*>/g, ' ').replace(/\s+/g, ' ').trim();
                    if (!cleanText) return;
                    
                    // Pre-create audio element BEFORE making request
                    const audio = new Audio();
                    let audioUrl = null;
                    
                    audio.onended = () => {
                        if (audioUrl) {
                            URL.revokeObjectURL(audioUrl);
                        }
                    };
                    
                    audio.onerror = (e) => {
                        console.error('Audio playback error:', e);
                        if (audioUrl) {
                            URL.revokeObjectURL(audioUrl);
                        }
                    };
                    
                    // Start request immediately - measure time for debugging
                    const startTime = Date.now();
                    
                    // Make request with timeout to avoid hanging (increased for model loading on first request)
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 30000); // 30s timeout (first request may load models)
                    
                    try {
                        const response = await fetch('/api/tts', {
                            method: 'POST',
                            headers: { 
                                'Content-Type': 'application/json',
                                'Accept': 'audio/*'  // Accept any audio format (wav, mp3, etc.)
                            },
                            body: JSON.stringify({ 
                                text: cleanText, 
                                language: lang 
                            }),
                            signal: controller.signal
                        });
                        
                        clearTimeout(timeoutId);
                        
                        if (response.ok) {
                            // Get blob stream and start playing as soon as possible
                            const audioBlob = await response.blob();
                            const requestTime = Date.now() - startTime;
                            console.log(`TTS request completed in ${requestTime}ms`);
                            
                            audioUrl = URL.createObjectURL(audioBlob);
                            audio.src = audioUrl;
                            
                            // Set up audio for immediate playback
                            audio.preload = 'auto';
                            
                            // Try to play immediately
                            try {
                                await audio.play();
                                const totalTime = Date.now() - startTime;
                                console.log(`TTS playing in ${totalTime}ms total`);
                            } catch (playError) {
                                console.error('Audio play error:', playError);
                                // Try loading first then playing
                                audio.load();
                                setTimeout(() => audio.play().catch(e => console.error(e)), 100);
                            }
                        } else {
                            console.error('TTS API error:', await response.text());
                        }
                    } catch (fetchError) {
                        clearTimeout(timeoutId);
                        if (fetchError.name === 'AbortError') {
                            console.error('TTS request timed out after 10s');
                        } else {
                            console.error('TTS fetch error:', fetchError);
                        }
                    }
                } catch (error) {
                    console.error('TTS API request failed:', error);
                }
            }
            
            // Function to speak using browser TTS (for English)
            function speakTextBrowser(text, lang) {
                if (!('speechSynthesis' in window)) return;
                
                // Stop any ongoing speech
                window.speechSynthesis.cancel();
                
                // Remove HTML tags for clean speech
                const cleanText = text.replace(/<[^>]*>/g, ' ').replace(/\s+/g, ' ').trim();
                if (!cleanText) return;
                
                const utterance = new SpeechSynthesisUtterance(cleanText);
                const speechLang = speechSynthesisLanguages[lang] || 'en-US';
                utterance.lang = speechLang;
                utterance.rate = 0.9; // Slightly slower for clarity
                utterance.pitch = 1;
                utterance.volume = 1;
                
                // Get available voices
                const voices = window.speechSynthesis.getVoices();
                
                // Try to find a voice matching the language with better matching logic
                let preferredVoice = null;
                
                if (lang === 'hi') {
                    // For Hindi, try multiple patterns
                    preferredVoice = voices.find(voice => 
                        voice.lang.toLowerCase().includes('hi-in') || 
                        voice.lang.toLowerCase().includes('hindi') ||
                        voice.lang.toLowerCase().startsWith('hi')
                    );
                    // Fallback: try any Indian voice
                    if (!preferredVoice) {
                        preferredVoice = voices.find(voice => 
                            voice.lang.toLowerCase().includes('-in') && 
                            (voice.name.toLowerCase().includes('hindi') || voice.name.toLowerCase().includes('india'))
                        );
                    }
                } else if (lang === 'kn') {
                    // For Kannada, try multiple patterns
                    preferredVoice = voices.find(voice => 
                        voice.lang.toLowerCase().includes('kn-in') || 
                        voice.lang.toLowerCase().includes('kannada') ||
                        voice.lang.toLowerCase().startsWith('kn')
                    );
                    // Fallback: try any Indian voice
                    if (!preferredVoice) {
                        preferredVoice = voices.find(voice => 
                            voice.lang.toLowerCase().includes('-in') && 
                            (voice.name.toLowerCase().includes('kannada') || voice.name.toLowerCase().includes('india'))
                        );
                    }
                } else {
                    // For English
                    preferredVoice = voices.find(voice => 
                        voice.lang.toLowerCase().startsWith('en') && voice.localService
                    );
                }
                
                // If still no voice found, try any voice with matching language code
                if (!preferredVoice && lang !== 'en') {
                    preferredVoice = voices.find(voice => 
                        voice.lang.toLowerCase().includes(lang)
                    );
                }
                
                // If we found a voice, use it
                if (preferredVoice) {
                    utterance.voice = preferredVoice;
                    console.log(`Using voice: ${preferredVoice.name} (${preferredVoice.lang}) for ${lang}`);
                } else {
                    // Log available voices for debugging
                    console.log('Available voices:', voices.map(v => `${v.name} (${v.lang})`));
                    console.log(`No specific voice found for language: ${lang} (${speechLang})`);
                    console.log('Attempting to speak with language code only - browser will try to find a matching voice');
                    // Still try to speak with the language code set - browser may have a fallback
                }
                
                // Add error handler
                utterance.onerror = function(event) {
                    console.error('Speech synthesis error:', event.error);
                    if (lang === 'hi' || lang === 'kn') {
                        console.warn(`Note: Hindi/Kannada voices may not be available in your browser. Please check your system's installed voices.`);
                    }
                };
                
                utterance.onend = function() {
                    console.log('Speech finished');
                };
                
                window.speechSynthesis.speak(utterance);
            }
            
            // Main speak function - browser TTS for English/Hindi, AI4Bharat API for Kannada
            function speakText(text, lang) {
                if (lang === 'kn') {
                    // Use AI4Bharat Indic-TTS API for Kannada only
                    speakTextAPI(text, lang);
                } else {
                    // Use browser TTS for English and Hindi
                    speakTextBrowser(text, lang);
                }
            }
            
            // Load voices when available - ensure voices are loaded before speaking
            let voicesLoaded = false;
            function ensureVoicesLoaded() {
                if (voicesLoaded) return;
                const voices = window.speechSynthesis.getVoices();
                if (voices.length > 0) {
                    voicesLoaded = true;
                    console.log('Voices loaded:', voices.length);
                }
            }
            
            if ('speechSynthesis' in window) {
                // Some browsers load voices asynchronously
                ensureVoicesLoaded();
                speechSynthesis.onvoiceschanged = () => {
                    ensureVoicesLoaded();
                };
            }
            
            // Speaker button - read the last bot message aloud
            if (chatbotAudioBtn) {
                chatbotAudioBtn.title = 'Read last response aloud';
                chatbotAudioBtn.addEventListener('click', () => {
                    // Find the last bot message
                    const botMessages = chatbotMessages.querySelectorAll('.chatbot-message.bot .chatbot-message-content');
                    if (botMessages.length > 0) {
                        const lastMessage = botMessages[botMessages.length - 1];
                        const messageText = lastMessage.innerHTML || lastMessage.textContent;
                        
                        if (messageText && messageText.trim()) {
                            // Ensure voices are loaded
                            ensureVoicesLoaded();
                            // Read the message in the selected language
                            setTimeout(() => {
                                speakText(messageText, selectedLanguage);
                            }, 100);
                        } else {
                            console.log('No message to read');
                        }
                    } else {
                        console.log('No bot messages found');
                    }
                });
            }
            
            const chatbotLanguageBtn = document.getElementById('chatbotLanguageBtn');
            const chatbotLanguageDropdown = document.getElementById('chatbotLanguageDropdown');
            const languageOptions = chatbotLanguageDropdown.querySelectorAll('.chatbot-language-option');
            
            // Update placeholder based on language
            function updatePlaceholder(lang) {
                const placeholders = {
                    'en': 'Ask me anything about the farms...',
                    'hi': '‡§Æ‡•Å‡§ù‡§∏‡•á ‡§´‡§æ‡§∞‡•ç‡§Æ‡•ã‡§Ç ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§ï‡•Å‡§õ ‡§≠‡•Ä ‡§™‡•Ç‡§õ‡•á‡§Ç...',
                    'kn': '‡≤®‡≤®‡≤ó‡≥Ü ‡≤´‡≤æ‡≤∞‡≥ç‡≤Æ‡≥ç‡≤ó‡≤≥ ‡≤¨‡≤ó‡≥ç‡≤ó‡≥Ü ‡≤è‡≤®‡≤æ‡≤¶‡≤∞‡≥Ç ‡≤ï‡≥á‡≤≥‡≤ø...'
                };
                if (chatbotInput) {
                    chatbotInput.placeholder = placeholders[lang] || placeholders['en'];
                }
            }
            
            function updateLanguageButton(lang) {
                const langName = languageNames[lang] || 'English';
                if (chatbotLanguageBtn) {
                    chatbotLanguageBtn.textContent = `üåê ${langName}`;
                }
                selectedLanguage = lang;
                localStorage.setItem('chatbotLanguage', lang);
                
                // Update selected state
                languageOptions.forEach(opt => {
                    if (opt.dataset.lang === lang) {
                        opt.classList.add('selected');
                    } else {
                        opt.classList.remove('selected');
                    }
                });
                
                // Update placeholder
                updatePlaceholder(lang);
            }
            
            // Initialize language button
            updateLanguageButton(selectedLanguage);
            
            // Voice recognition functionality
            const chatbotMicBtn = document.getElementById('chatbotMicBtn');
            let recognition = null;
            let isRecording = false;
            
            // Map our language codes to Speech Recognition API language codes
            const speechRecognitionLanguages = {
                'en': 'en-US',
                'hi': 'hi-IN',
                'kn': 'kn-IN'
            };
            
            // Initialize Speech Recognition if available
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                
                // Set initial language
                const initialSpeechLang = speechRecognitionLanguages[selectedLanguage] || 'en-US';
                recognition.lang = initialSpeechLang;
                
                recognition.onstart = function() {
                    isRecording = true;
                    chatbotMicBtn.classList.add('recording');
                    chatbotMicBtn.title = 'Recording... Click to stop';
                };
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    if (chatbotInput) {
                        chatbotInput.value = transcript;
                        // Focus the input so user can review/edit before sending
                        chatbotInput.focus();
                        // Auto-send after voice input (user can still edit if needed)
                        setTimeout(() => {
                            if (chatbotInput.value.trim()) {
                                sendMessage('voice'); // Mark as voice input
                            }
                        }, 300);
                    }
                };
                
                recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);
                    isRecording = false;
                    chatbotMicBtn.classList.remove('recording');
                    chatbotMicBtn.title = 'Click to speak';
                    
                    let errorMsg = 'Speech recognition error. Please try again.';
                    if (event.error === 'no-speech') {
                        errorMsg = 'No speech detected. Please try again.';
                    } else if (event.error === 'not-allowed') {
                        errorMsg = 'Microphone permission denied. Please allow microphone access.';
                    }
                    addMessage(errorMsg);
                };
                
                recognition.onend = function() {
                    isRecording = false;
                    chatbotMicBtn.classList.remove('recording');
                    chatbotMicBtn.title = 'Click to speak';
                };
                
                // Handle mic button click
                if (chatbotMicBtn) {
                    chatbotMicBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        
                        if (!recognition) {
                            addMessage('Speech recognition is not supported in your browser. Please type your message.');
                            return;
                        }
                        
                        if (isRecording) {
                            recognition.stop();
                        } else {
                            // Set language based on selected language
                            const speechLang = speechRecognitionLanguages[selectedLanguage] || 'en-US';
                            recognition.lang = speechLang;
                            recognition.start();
                        }
                    });
                }
            } else {
                // Speech recognition not supported
                if (chatbotMicBtn) {
                    chatbotMicBtn.style.display = 'none';
                }
            }
            
            // Toggle dropdown
            if (chatbotLanguageBtn && chatbotLanguageDropdown) {
                chatbotLanguageBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    chatbotLanguageDropdown.classList.toggle('active');
                });
                
                // Select language
                languageOptions.forEach(option => {
                    option.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const lang = option.dataset.lang;
                        updateLanguageButton(lang);
                        chatbotLanguageDropdown.classList.remove('active');
                        
                        // Update speech recognition language if available
                        if (recognition && !isRecording) {
                            const speechLang = speechRecognitionLanguages[lang] || 'en-US';
                            recognition.lang = speechLang;
                        }
                    });
                });
                
                // Close dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    if (!chatbotLanguageBtn.contains(e.target) && !chatbotLanguageDropdown.contains(e.target)) {
                        chatbotLanguageDropdown.classList.remove('active');
                    }
                });
            }

            // Track input method (text or voice)
            let lastInputMethod = 'text'; // 'text' or 'voice'
            
            async function sendMessage(inputMethod = 'text') {
                if (!chatbotInput || !chatbotSend) return;
                const message = chatbotInput.value.trim();
                if (!message) return;

                // Track how the message was input
                lastInputMethod = inputMethod;

                addMessage(message, true);
                chatbotInput.value = '';
                chatbotSend.disabled = true;
                addTypingIndicator();

                try {
                    const response = await fetch('/api/chatbot', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            message: message,
                            language: selectedLanguage
                        })
                    });

                    const data = await response.json();
                    
                    // Start TTS request IMMEDIATELY before UI updates (parallel processing)
                    if (inputMethod === 'voice' && data.response) {
                        // Start TTS request immediately - don't wait for UI
                        speakText(data.response, selectedLanguage);
                    }
                    
                    removeTypingIndicator();
                    addMessage(data.response);
                } catch (error) {
                    removeTypingIndicator();
                    addMessage("Sorry, I encountered an error. Please try again.");
                    console.error('Chatbot error:', error);
                } finally {
                    if (chatbotSend) chatbotSend.disabled = false;
                    if (chatbotInput) chatbotInput.focus();
                }
            }

            chatbotToggle.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                console.log('Chatbot toggle clicked');
                chatbotOpen = !chatbotOpen;
                chatbotContainer.classList.toggle('active', chatbotOpen);
                console.log('Chatbot open:', chatbotOpen);
                if (chatbotOpen) {
                    if (chatbotInput) chatbotInput.focus();
                    if (chatbotMessages && chatbotMessages.children.length === 0) {
                        const initialMessages = {
                            'en': "Hello! I'm your AI assistant for the Food Supply Chain Platform. I can answer questions about any farm, metrics, performance, and insights. What would you like to know?",
                            'hi': "‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•à‡§Ç ‡§ñ‡§æ‡§¶‡•ç‡§Ø ‡§Ü‡§™‡•Ç‡§∞‡•ç‡§§‡§ø ‡§∂‡•ç‡§∞‡•É‡§Ç‡§ñ‡§≤‡§æ ‡§™‡•ç‡§≤‡•á‡§ü‡§´‡•â‡§∞‡•ç‡§Æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§™‡§ï‡§æ AI ‡§∏‡§π‡§æ‡§Ø‡§ï ‡§π‡•Ç‡§Å‡•§ ‡§Æ‡•à‡§Ç ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§´‡§æ‡§∞‡•ç‡§Æ, ‡§Æ‡•á‡§ü‡•ç‡§∞‡§ø‡§ï‡•ç‡§∏, ‡§™‡•ç‡§∞‡§¶‡§∞‡•ç‡§∂‡§® ‡§î‡§∞ ‡§Ö‡§Ç‡§§‡§∞‡•ç‡§¶‡•É‡§∑‡•ç‡§ü‡§ø ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡•ã‡§Ç ‡§ï‡§æ ‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡•á ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Å‡•§ ‡§Ü‡§™ ‡§ï‡•ç‡§Ø‡§æ ‡§ú‡§æ‡§®‡§®‡§æ ‡§ö‡§æ‡§π‡•á‡§Ç‡§ó‡•á?",
                            'kn': "‡≤®‡≤Æ‡≤∏‡≥ç‡≤ï‡≤æ‡≤∞! ‡≤®‡≤æ‡≤®‡≥Å ‡≤Ü‡≤π‡≤æ‡≤∞ ‡≤∏‡≤∞‡≤¨‡≤∞‡≤æ‡≤ú‡≥Å ‡≤∏‡≤∞‡≤™‡≤≥‡≤ø ‡≤µ‡≥á‡≤¶‡≤ø‡≤ï‡≥Ü‡≤ó‡≤æ‡≤ó‡≤ø ‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ AI ‡≤∏‡≤π‡≤æ‡≤Ø‡≤ï. ‡≤®‡≤æ‡≤®‡≥Å ‡≤Ø‡≤æ‡≤µ‡≥Å‡≤¶‡≥á ‡≤´‡≤æ‡≤∞‡≥ç‡≤Æ‡≥ç, ‡≤Æ‡≥Ü‡≤ü‡≥ç‡≤∞‡≤ø‡≤ï‡≥ç‡≤∏‡≥ç, ‡≤ï‡≤æ‡≤∞‡≥ç‡≤Ø‡≤ï‡≥ç‡≤∑‡≤Æ‡≤§‡≥Ü ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤í‡≤≥‡≤®‡≥ã‡≤ü‡≤ó‡≤≥ ‡≤¨‡≤ó‡≥ç‡≤ó‡≥Ü ‡≤™‡≥ç‡≤∞‡≤∂‡≥ç‡≤®‡≥Ü‡≤ó‡≤≥‡≤ø‡≤ó‡≥Ü ‡≤â‡≤§‡≥ç‡≤§‡≤∞‡≤ø‡≤∏‡≤¨‡≤π‡≥Å‡≤¶‡≥Å. ‡≤®‡≥Ä‡≤µ‡≥Å ‡≤è‡≤®‡≥Å ‡≤§‡≤ø‡≤≥‡≤ø‡≤Ø‡≤≤‡≥Å ‡≤¨‡≤Ø‡≤∏‡≥Å‡≤§‡≥ç‡≤§‡≥Ä‡≤∞‡≤ø?"
                        };
                        const greeting = initialMessages[selectedLanguage] || initialMessages['en'];
                        addMessage(greeting);
                        // Don't speak the initial greeting automatically
                    }
                }
            });

            if (chatbotClose) {
                chatbotClose.addEventListener('click', () => {
                    chatbotOpen = false;
                    chatbotContainer.classList.remove('active');
                });
            }

            if (chatbotSend) {
                chatbotSend.addEventListener('click', () => {
                    sendMessage('text'); // Mark as text input
                });
            }

            if (chatbotInput) {
                chatbotInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage('text'); // Mark as text input
                    }
                });
            }
        }

        // Initialize chatbot - try multiple times to ensure elements exist
        function tryInitializeChatbot() {
            const chatbotToggle = document.getElementById('chatbotToggle');
            if (chatbotToggle) {
                initializeChatbot();
            } else {
                // Elements not ready yet, try again after a short delay
                setTimeout(tryInitializeChatbot, 50);
            }
        }

        // Start initialization
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', tryInitializeChatbot);
        } else {
            // DOM is already loaded or loading
            tryInitializeChatbot();
        }
    </script>
    <script>
    // Global variable to hold the chart instance
    let priceChartInstance = null;

    // Function to handle fetching and rendering the specific crop forecast
    async function loadPricePrediction(cropName) {
        // 1. Update Tab State (Visual feedback)
        document.querySelectorAll('#cropForecastTabs button').forEach(button => {
            button.classList.remove('active');
            if (button.getAttribute('data-crop') === cropName) {
                button.classList.add('active');
            }
        });

        const endpoint = `/api/prediction/price/${cropName}`;
        const insightElement = document.getElementById('aiPriceInsight');
        insightElement.innerText = `Fetching forecast for ${cropName.toUpperCase()}...`;

        try {
            const response = await fetch(endpoint);
            if (!response.ok) {
                insightElement.innerText = `Error: Model for ${cropName.toUpperCase()} not found or API failed.`;
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const data = await response.json();
            
            // Extract data
            const currency = data.currency || '‚Çπ';
            const forecastDates = data.forecast_data.map(item => item.date.substring(0, 7)); // YYYY-MM
            const predictedPrices = data.forecast_data.map(item => item.predicted_price);
            const lowerCI = data.forecast_data.map(item => item.lower_ci);
            const upperCI = data.forecast_data.map(item => item.upper_ci);
            
            // Render the chart
            renderPriceChart(cropName.toUpperCase(), forecastDates, predictedPrices, lowerCI, upperCI, currency);
            
            // Update Insight
            insightElement.innerText = `Forecast successful. Predicted price for the next ${data.forecast_months} months shown below.`;
            
        } catch (error) {
            console.error(`Failed to load price prediction for ${cropName}:`, error);
        }
    }

    // Function to create/update the Chart.js visualization
    function renderPriceChart(cropName, dates, prices, lowerCI, upperCI, currency) {
        const ctx = document.getElementById('pricePredictionChart').getContext('2d');
        
        // Destroy existing chart if it exists
        if (priceChartInstance) {
            priceChartInstance.destroy();
        }

        priceChartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: dates,
                datasets: [
                    // Predicted Price Line
                    {
                        label: `Predicted Price (${currency})`,
                        data: prices,
                        borderColor: 'rgb(54, 162, 235)', // Blue
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderWidth: 2,
                        fill: false,
                        tension: 0.2
                    },
                    // Confidence Interval Area (Lower bound defines the start of the fill)
                    {
                        label: '95% CI Lower',
                        data: lowerCI,
                        borderColor: 'rgba(0, 0, 0, 0)',
                        backgroundColor: 'rgba(173, 216, 230, 0.3)', // Light blue fill
                        pointRadius: 0,
                        tension: 0.2,
                        fill: '-1' // Fill up to the next dataset (Predicted Price line)
                    },
                    // Confidence Interval Area (Upper bound defines the end of the fill)
                    {
                        label: '95% CI Upper',
                        data: upperCI,
                        borderColor: 'rgba(0, 0, 0, 0)',
                        backgroundColor: 'rgba(173, 216, 230, 0.3)', 
                        pointRadius: 0,
                        tension: 0.2,
                        fill: 'start' // Fill starts from the line below it
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false, // Respects the 350px height set in HTML
                scales: {
                    y: {
                        title: {
                            display: true,
                            text: `Price (${currency}/unit)`
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: true
                    },
                    title: {
                        display: true,
                        text: `${cropName} Price Forecast using SARIMA`
                    }
                }
            }
        });
    }

    // 3. Initial Load: Load the Tomato forecast when the page loads
    document.addEventListener('DOMContentLoaded', () => {
        loadPricePrediction('tomato');
        loadCropRecommendations();
    });

    // Crop Recommendation Functions
    async function loadCropRecommendations() {
        const container = document.getElementById('recommendation-container');
        container.innerHTML = '<div style="text-align: center; padding: 20px;"><p>Loading crop recommendations...</p></div>';

        try {
            const response = await fetch('/api/farm/crop-recommendations-all');
            if (!response.ok) throw new Error('Failed to fetch recommendations');
            
            const data = await response.json();
            displayCropRecommendations(data);
        } catch (error) {
            console.error('Error loading crop recommendations:', error);
            container.innerHTML = '<div style="color: #e74c3c; padding: 20px;"><p>‚ö†Ô∏è Error loading recommendations. Please try again.</p></div>';
        }
    }

    function displayCropRecommendations(data) {
        const container = document.getElementById('recommendation-container');
        let html = `
            <div style="max-width: 1200px; margin: 0 auto;">
                <div style="background: linear-gradient(135deg, #1a5f7a 0%, #0f3a4f 100%); color: white; padding: 30px; border-radius: 12px; margin-bottom: 30px;">
                    <h3 style="margin: 0 0 10px 0; font-size: 20px; display: flex; align-items: center; gap: 8px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="starGrad3" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#FFD700;stop-opacity:1" /><stop offset="50%" style="stop-color:#FFA500;stop-opacity:1" /><stop offset="100%" style="stop-color:#FF6347;stop-opacity:1" /></linearGradient><linearGradient id="badgeGrad3" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#FFD700;stop-opacity:0.8" /><stop offset="100%" style="stop-color:#FF6347;stop-opacity:0.8" /></linearGradient></defs><circle cx="12" cy="12" r="11" fill="url(#badgeGrad3)" stroke="#fff" stroke-width="1"/><path d="M12 2L14.09 8.26L20 9.27L15 13.14L16.18 19.02L12 15.77L7.82 19.02L9 13.14L4 9.27L9.91 8.26L12 2Z" fill="url(#starGrad3)" stroke="#fff" stroke-width="0.5"/><path d="M10 12L11.5 13.5L14 11" stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg> Optimized Crop Allocation</h3>
                    <p style="margin: 0; opacity: 0.9;">Each farm is assigned a unique crop to maximize profit and prevent market saturation</p>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
        `;

        // Get current farm from header
        const currentFarmTab = document.querySelector('.farm-tab.active');
        const currentFarm = currentFarmTab ? currentFarmTab.textContent.trim().replace(' ', '') : 'all';

        // Create cards for each farm
        for (const [farm, rec] of Object.entries(data.recommendations)) {
            const cropEmojis = {
                'Wheat': 'üåæ',
                'Corn': 'üåΩ',
                'Lettuce': 'ü•¨',
                'Tomato': 'üçÖ'
            };
            const emoji = cropEmojis[rec.recommended_crop] || 'üå±';
            const isCurrentFarm = farm.replace('Farm', '') === currentFarm.replace('Farm', '');
            const highlight = isCurrentFarm ? 'border: 3px solid #667eea; box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);' : '';

            html += `
                <div style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 2px 12px rgba(0,0,0,0.1); ${highlight} cursor: pointer; transition: all 0.3s;" onclick="loadFarmRecommendation('${farm}')">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                        <h4 style="margin: 0; color: #1a5f7a; font-size: 18px;">${farm}</h4>
                        <span style="font-size: 16px; color: #7f8c8d;">${isCurrentFarm ? 'üëà You' : ''}</span>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, ${getGradientColor(rec.recommended_crop)}); border-radius: 8px; padding: 20px; text-align: center; color: white; margin-bottom: 15px;">
                        <div style="font-size: 40px; margin-bottom: 10px;">${emoji}</div>
                        <h3 style="margin: 0 0 5px 0; font-size: 24px; font-weight: bold;">${rec.recommended_crop}</h3>
                        <p style="margin: 0; opacity: 0.9; font-size: 12px;">RECOMMENDED CROP</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div style="background: #f5f7fa; padding: 12px; border-radius: 8px;">
                            <div style="font-size: 12px; color: #7f8c8d; margin-bottom: 5px; text-transform: uppercase;">Profitability</div>
                            <div style="font-size: 20px; font-weight: bold; color: #1a5f7a;">${rec.profitability_score}</div>
                        </div>
                        <div style="background: #f5f7fa; padding: 12px; border-radius: 8px;">
                            <div style="font-size: 12px; color: #7f8c8d; margin-bottom: 5px; text-transform: uppercase;">Price</div>
                            <div style="font-size: 20px; font-weight: bold; color: #27ae60;">‚Çπ${rec.predicted_price.toFixed(2)}</div>
                            <div style="font-size: 10px; color: #95a5a6;">/quintal</div>
                        </div>
                    </div>
                    
                    <button style="width: 100%; padding: 12px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;" onclick="loadFarmRecommendation('${farm}'); event.stopPropagation();">
                        View Details ‚Üí
                    </button>
                </div>
            `;
        }

        html += `</div></div>`;
        container.innerHTML = html;
    }

    function getGradientColor(crop) {
        const gradients = {
            'Wheat': '#1e8449, #27ae60',
            'Corn': '#f39c12, #e67e22',
            'Lettuce': '#16a085, #1abc9c',
            'Tomato': '#c0392b, #e74c3c'
        };
        return gradients[crop] || '#667eea, #764ba2';
    }

    async function loadFarmRecommendation(farmName) {
        const container = document.getElementById('recommendation-container');
        container.innerHTML = '<div style="text-align: center; padding: 20px;"><p>Loading detailed recommendation...</p></div>';

        try {
            const response = await fetch(`/api/farm/${farmName}/crop-recommendation`);
            if (!response.ok) throw new Error('Failed to fetch recommendation');
            
            const data = await response.json();
            displayDetailedRecommendation(data);
        } catch (error) {
            console.error('Error loading farm recommendation:', error);
            container.innerHTML = '<div style="color: #e74c3c; padding: 20px;"><p>‚ö†Ô∏è Error loading recommendation. Please try again.</p></div>';
        }
    }

    function displayDetailedRecommendation(data) {
        const container = document.getElementById('recommendation-container');
        const cropEmojis = {
            'Wheat': 'üåæ',
            'Corn': 'üåΩ',
            'Lettuce': 'ü•¨',
            'Tomato': 'üçÖ'
        };
        const emoji = cropEmojis[data.recommended_crop] || 'üå±';
        const cropLower = data.recommended_crop.toLowerCase();

        const gradients = {
            'wheat': '#1e8449, #27ae60',
            'corn': '#f39c12, #e67e22',
            'lettuce': '#16a085, #1abc9c',
            'tomato': '#c0392b, #e74c3c'
        };
        const gradient = gradients[cropLower] || '#667eea, #764ba2';

        let html = `
            <div style="max-width: 1000px; margin: 0 auto;">
                <button onclick="loadCropRecommendations()" style="padding: 10px 16px; background: #ecf0f1; color: #1a5f7a; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; margin-bottom: 20px;">‚Üê Back to All Farms</button>
                
                <div style="background: linear-gradient(135deg, ${gradient}); color: white; border-radius: 12px; padding: 40px; text-align: center; margin-bottom: 30px;">
                    <div style="font-size: 60px; margin-bottom: 15px;">${emoji}</div>
                    <h2 style="margin: 0 0 10px 0; font-size: 36px;">${data.recommended_crop}</h2>
                    <p style="margin: 0; font-size: 16px; opacity: 0.9;">${data.farm} - Recommended Crop for Maximum Profit</p>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 30px;">
                    <div style="background: white; padding: 20px; border-radius: 12px; border-left: 4px solid #667eea; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="font-size: 12px; color: #7f8c8d; margin-bottom: 8px; text-transform: uppercase;">Profitability Score</div>
                        <div style="font-size: 28px; font-weight: bold; color: #667eea;">${data.recommendation_score}</div>
                    </div>

                    <div style="background: white; padding: 20px; border-radius: 12px; border-left: 4px solid #27ae60; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="font-size: 12px; color: #7f8c8d; margin-bottom: 8px; text-transform: uppercase;">Predicted Price</div>
                        <div style="font-size: 28px; font-weight: bold; color: #27ae60;">‚Çπ${data.predicted_price.toFixed(2)}</div>
                        <div style="font-size: 11px; color: #95a5a6; margin-top: 5px;">per quintal</div>
                    </div>

                    <div style="background: white; padding: 20px; border-radius: 12px; border-left: 4px solid #e67e22; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="font-size: 12px; color: #7f8c8d; margin-bottom: 8px; text-transform: uppercase;">Expected Yield</div>
                        <div style="font-size: 28px; font-weight: bold; color: #e67e22;">${data.expected_yield_tonnes_per_ha.toFixed(1)}</div>
                        <div style="font-size: 11px; color: #95a5a6; margin-top: 5px;">tonnes/hectare</div>
                    </div>

                    <div style="background: white; padding: 20px; border-radius: 12px; border-left: 4px solid #1a5f7a; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="font-size: 12px; color: #7f8c8d; margin-bottom: 8px; text-transform: uppercase;">Est. Profit/ha</div>
                        <div style="font-size: 28px; font-weight: bold; color: #1a5f7a;">‚Çπ${data.estimated_profit_per_ha.toFixed(0)}</div>
                        <div style="font-size: 11px; color: #95a5a6; margin-top: 5px;">${data.profit_confidence}</div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <h3 style="color: #1a5f7a; margin: 0 0 15px 0; font-size: 18px;">üí° Why This Crop?</h3>
                        <ul style="margin: 0; padding-left: 20px; color: #2c3e50; font-size: 14px; line-height: 1.8;">
                            ${data.reasoning.map(r => `<li style="margin-bottom: 10px;">${r}</li>`).join('')}
                        </ul>
                    </div>

                    <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <h3 style="color: #1a5f7a; margin: 0 0 15px 0; font-size: 18px;">üìä Crop Comparison</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            ${Object.entries(data.crop_comparison.profitability_scores).map(([crop, score]) => {
                                const icon = cropEmojis[crop.charAt(0).toUpperCase() + crop.slice(1)] || 'üå±';
                                const isBest = crop.toLowerCase() === cropLower;
                                const bgColor = isBest ? 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' : '#f5f7fa';
                                const textColor = isBest ? 'white' : '#1a5f7a';
                                return `
                                    <div style="background: ${bgColor}; padding: 12px; border-radius: 8px; text-align: center;">
                                        <div style="font-size: 24px; margin-bottom: 5px;">${icon}</div>
                                        <div style="font-size: 12px; color: ${isBest ? 'rgba(255,255,255,0.8)' : '#7f8c8d'}; margin-bottom: 5px;">${crop.toUpperCase()}</div>
                                        <div style="font-size: 16px; font-weight: bold; color: ${textColor};">${score.toFixed(1)}</div>
                                        ${isBest ? '<div style="font-size: 10px; color: #ffd700; margin-top: 5px;">‚úì BEST</div>' : ''}
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 12px; margin-bottom: 30px;">
                    <h3 style="margin: 0 0 15px 0; font-size: 18px;">üåç Cross-Farm Market Strategy</h3>
                    <p style="margin: 0 0 15px 0; font-size: 14px;">To prevent market saturation and maximize prices, farms are allocated different crops:</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px;">
                        ${Object.entries(data.other_farm_recommendations).map(([farm, crop]) => {
                            const icon = cropEmojis[crop] || 'üå±';
                            return `<div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 24px; margin-bottom: 5px;">${icon}</div>
                                <div style="font-size: 12px; opacity: 0.8; margin-bottom: 3px;">${farm}</div>
                                <div style="font-size: 13px; font-weight: 600;">${crop}</div>
                            </div>`;
                        }).join('')}
                    </div>
                </div>

                <button onclick="loadCropRecommendations()" style="padding: 12px 24px; background: #1a5f7a; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s; width: 100%; font-size: 16px;">Back to All Farms</button>
            </div>
        `;
        
        container.innerHTML = html;
    }

</script>
</body>
</html>
